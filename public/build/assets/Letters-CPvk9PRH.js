import{a as t,V as Te,j as z,c as ve,M as ze,F as P}from"./app-ixx7qJ5s.js";import{r as l,R as q,P as De,_ as Ie,w as L,z as xe,A as Ce,J as Ee,u as ye,ad as Fe,B as G,g as Pe,e as je,h as Me,c as Z,f as ae,a as ne,G as oe,t as Be}from"./vendor-CAwIk-m4.js";import{g as We,h as se,r as Se,i as Ae,c as Ne,b as le,B,G as $e,A as Oe}from"./App-CPe1nS65.js";import{X as Ye,m as Ve,A as Ge}from"./minMax-DrZH9waJ.js";import{d as qe}from"./Delete-DJfiOIDM.js";import{l as Ke,U as ie}from"./index-CGcXwVxh.js";import{u as Xe,$ as de,C as Je,i as ke}from"./chunk-HJTJQZF3-Cn5ZL-v5.js";import{c as V}from"./chunk-MZRCPRP2-D9CGtGpV.js";import{l as Q,s as ee}from"./chunk-7JXO3E7I-DDiEVtqb.js";import{l as ce}from"./chunk-T45N425O-DJ7AylSu.js";import{t as Ue}from"./chunk-CSXHODZI-DrQ6oPO5.js";import{u as ue}from"./chunk-R6AK6OQ4-DdiCHEbU.js";import{d as Ze}from"./dayjs.min-CTH_U6Xy.js";import{d as Qe}from"./Search-Cu1H1s9Y.js";import{D as pe}from"./Download-CLoMQ7lh.js";import{p as et}from"./chunk-YHY32LNM-Bk2DzvpJ.js";import"./chunk-2BFF5KFD-4PFDEFF7.js";import"./chunk-SLABUSGS-DAoN3Vln.js";import"./chunk-4EXC76WE-DAjkjlid.js";import"./chunk-7F3ZLNJ6-CaUeb2g5.js";var tt=l.useLayoutEffect,rt=function(n){var o=q.useRef(n);return tt(function(){o.current=n}),o},he=function(n,o){if(typeof n=="function"){n(o);return}n.current=o},at=function(n,o){var r=q.useRef();return q.useCallback(function(d){n.current=d,r.current&&he(r.current,null),r.current=o,o&&he(o,d)},[o])},ge={"min-height":"0","max-height":"none",height:"0",visibility:"hidden",overflow:"hidden",position:"absolute","z-index":"-1000",top:"0",right:"0",display:"block"},nt=function(n){Object.keys(ge).forEach(function(o){n.style.setProperty(o,ge[o],"important")})},me=nt,x=null,fe=function(n,o){var r=n.scrollHeight;return o.sizingStyle.boxSizing==="border-box"?r+o.borderSize:r-o.paddingSize};function ot(s,n,o,r){o===void 0&&(o=1),r===void 0&&(r=1/0),x||(x=document.createElement("textarea"),x.setAttribute("tabindex","-1"),x.setAttribute("aria-hidden","true"),me(x)),x.parentNode===null&&document.body.appendChild(x);var d=s.paddingSize,p=s.borderSize,v=s.sizingStyle,C=v.boxSizing;Object.keys(v).forEach(function(w){var g=w;x.style[g]=v[g]}),me(x),x.value=n;var m=fe(x,s);x.value=n,m=fe(x,s),x.value="x";var c=x.scrollHeight-d,h=c*o;C==="border-box"&&(h=h+d+p),m=Math.max(h,m);var y=c*r;return C==="border-box"&&(y=y+d+p),m=Math.min(y,m),[m,c]}var be=function(){},st=function(n,o){return n.reduce(function(r,d){return r[d]=o[d],r},{})},lt=["borderBottomWidth","borderLeftWidth","borderRightWidth","borderTopWidth","boxSizing","fontFamily","fontSize","fontStyle","fontWeight","letterSpacing","lineHeight","paddingBottom","paddingLeft","paddingRight","paddingTop","tabSize","textIndent","textRendering","textTransform","width","wordBreak","wordSpacing","scrollbarGutter"],it=!!document.documentElement.currentStyle,dt=function(n){var o=window.getComputedStyle(n);if(o===null)return null;var r=st(lt,o),d=r.boxSizing;if(d==="")return null;it&&d==="border-box"&&(r.width=parseFloat(r.width)+parseFloat(r.borderRightWidth)+parseFloat(r.borderLeftWidth)+parseFloat(r.paddingRight)+parseFloat(r.paddingLeft)+"px");var p=parseFloat(r.paddingBottom)+parseFloat(r.paddingTop),v=parseFloat(r.borderBottomWidth)+parseFloat(r.borderTopWidth);return{sizingStyle:r,paddingSize:p,borderSize:v}},ct=dt;function _e(s,n,o){var r=rt(o);l.useLayoutEffect(function(){var d=function(v){return r.current(v)};if(s)return s.addEventListener(n,d),function(){return s.removeEventListener(n,d)}},[])}var ut=function(n){_e(window,"resize",n)},pt=function(n){_e(document.fonts,"loadingdone",n)},ht=["cacheMeasurements","maxRows","minRows","onChange","onHeightChange"],gt=function(n,o){var r=n.cacheMeasurements,d=n.maxRows,p=n.minRows,v=n.onChange,C=v===void 0?be:v,m=n.onHeightChange,c=m===void 0?be:m,h=De(n,ht),y=h.value!==void 0,w=l.useRef(null),g=at(w,o),e=l.useRef(0),a=l.useRef(),i=function(){var u=w.current,R=r&&a.current?a.current:ct(u);if(R){a.current=R;var k=ot(R,u.value||u.placeholder||"x",p,d),D=k[0],T=k[1];e.current!==D&&(e.current=D,u.style.setProperty("height",D+"px","important"),c(D,{rowHeight:T}))}},S=function(u){y||i(),C(u)};return l.useLayoutEffect(i),ut(i),pt(i),l.createElement("textarea",Ie({},h,{onChange:S,ref:g}))},mt=l.forwardRef(gt),we=We(({style:s,minRows:n=3,maxRows:o=8,cacheMeasurements:r=!1,disableAutosize:d=!1,onHeightChange:p,...v},C)=>{const{Component:m,label:c,description:h,startContent:y,endContent:w,hasHelper:g,shouldLabelBeOutside:e,shouldLabelBeInside:a,isInvalid:i,errorMessage:S,getBaseProps:f,getLabelProps:u,getInputProps:R,getInnerWrapperProps:k,getInputWrapperProps:D,getHelperWrapperProps:T,getDescriptionProps:W,getErrorMessageProps:K,isClearable:A,getClearButtonProps:N}=Xe({...v,ref:C,isMultiline:!0}),[$,I]=l.useState(n>1),[j,X]=l.useState(!1),O=c?L.jsx("label",{...u(),children:c}):null,b=R(),_=(J,U)=>{if(n===1&&I(J>=U.rowHeight*2),o>n){const He=J>=o*U.rowHeight;X(He)}p==null||p(J,U)},E=d?L.jsx("textarea",{...b,style:de(b.style,s??{})}):L.jsx(mt,{...b,cacheMeasurements:r,"data-hide-scroll":se(!j),maxRows:o,minRows:n,style:de(b.style,s??{}),onHeightChange:_}),H=l.useMemo(()=>A?L.jsx("button",{...N(),children:L.jsx(Je,{})}):null,[A,N]),Y=l.useMemo(()=>y||w?L.jsxs("div",{...k(),children:[y,E,w]}):L.jsx("div",{...k(),children:E}),[y,b,w,k]),F=i&&S,M=F||h;return L.jsxs(m,{...f(),children:[e?O:null,L.jsxs("div",{...D(),"data-has-multiple-rows":se($),children:[a?O:null,Y,H]}),g&&M?L.jsx("div",{...T(),children:F?L.jsx("div",{...K(),children:S}):L.jsx("div",{...W(),children:h})}):null]})});we.displayName="HeroUI.Textarea";var ft=we;const bt=()=>t("div",{className:"spinner-container",children:t(Ke.Dots,{animation:"fade",background:"rgba(0, 0, 0, 0.5)",color:"#3498db",size:60})});var te={},vt=Ce;Object.defineProperty(te,"__esModule",{value:!0});var Le=te.default=void 0,xt=vt(Se()),Ct=xe();Le=te.default=(0,xt.default)((0,Ct.jsx)("path",{d:"M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1M8 13h8v-2H8zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5"}),"Link");var re={},yt=Ce;Object.defineProperty(re,"__esModule",{value:!0});var Re=re.default=void 0,St=yt(Se()),kt=xe();Re=re.default=(0,St.default)((0,kt.jsx)("path",{d:"M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2m0 4-8 5-8-5V6l8 5 8-5z"}),"Mail");const _t=Ee(Ye)(({theme:s})=>({"& .rdt_Table":{backgroundColor:"transparent","& .rdt_TableHead":{"& .rdt_TableHeadRow":{"& .hZUxNm":{"white-space":"normal"},backgroundColor:"transparent",color:s.palette.text.primary},top:0,zIndex:1},"& .rdt_TableBody":{overflowY:"auto",maxHeight:"52vh","&::-webkit-scrollbar":{display:"none"},"-ms-overflow-style":"none","scrollbar-width":"none","& .rdt_TableRow":{minHeight:"auto",backgroundColor:"transparent",color:s.palette.text.primary,"& .rdt_TableCol":{backgroundColor:"transparent",borderBottom:`1px solid ${s.palette.divider}`,width:"auto",whiteSpace:"nowrap"}},"& .rdt_TableRow:hover":{backgroundColor:s.palette.action.hover}}}})),wt=({allData:s,setData:n,users:o,loading:r,handleClickOpen:d,openModal:p,setCurrentRow:v,search:C})=>{const{auth:m}=Te().props,c=ye();l.useState(null),m.roles.includes("Administrator"),m.roles.includes("Supervision Engineer");const h=e=>{switch(e){case"Open":return"danger";case"Closed":return"success";case"Processing":return"primary";case"Signed":return"warning";case"Sent":return"success";default:return""}},y=e=>{if(!C)return e;const a=C.split(" ").filter(Boolean),i=new RegExp(`(${a.join("|")})`,"gi");return e.split(i).map((f,u)=>a.some(R=>f.toLowerCase()===R.toLowerCase())?t("span",{style:{backgroundColor:"yellow"},children:f},u):f)},w=[{name:"From",selector:e=>e.from,sortable:!0,center:"true",width:"80px",cell:e=>y(e.from)},{name:"Status",selector:e=>e.status,sortable:!0,center:"true",width:"170px",cell:e=>t(ee,{"aria-label":"Status",color:h(e.status),placeholder:"Select Status",value:e.status,onChange:a=>g(e.id,"status",a.target.value),fullWidth:!0,selectedKeys:[e.status],popoverProps:{classNames:{content:"bg-transparent backdrop-blur-lg border-inherit"}},children:["Open","Closed"].map(a=>t(Q,{value:e.status,children:a},a))})},{name:"Received Date",selector:e=>e.received_date,sortable:!0,center:"true",width:"160px",cell:e=>t(ke,{variant:"underlined",type:"date",fullWidth:!0,value:e.received_date,onChange:a=>g(e.id,"received_date",a.target.value)})},{name:"Memo Number",selector:e=>e.memo_number,sortable:!0,center:"true",width:"200px",cell:e=>t(ce,{isExternal:!0,color:"foreground",isBlock:!0,showAnchorIcon:!0,href:e.letter_link||`/letters/${e.memo_number}.pdf`,anchorIcon:t(Re,{}),children:e.memo_number||"N/A"})},{name:"Subject",selector:e=>e.subject,sortable:!0,left:!0,width:"260px",cell:e=>t(Ue,{content:e.subject,placement:"top",showArrow:!0,radius:"md",size:"md",classNames:{content:["bg-transparent backdrop-blur-lg border border-gray-200","max-w-[300px] text-sm"]},children:t(G,{sx:{whiteSpace:"normal",wordWrap:"break-word",overflow:"hidden",textOverflow:"ellipsis",maxWidth:"100%",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical"},children:y(e.subject)})})},{name:"Action Taken",selector:e=>e.action_taken,sortable:!0,left:!0,width:"250px",cell:e=>{const[a,i]=l.useState(e.action_taken||"");return t(ft,{variant:"underlined",size:"sm",radius:"sm",maxRows:2,fullWidth:!0,value:a,onChange:u=>{i(u.target.value)},onBlur:()=>{g(e.id,"action_taken",a)}})}},{name:"Handling Link",selector:e=>e.handling_link,sortable:!0,center:"true",width:"200px",cell:e=>t(ce,{isExternal:!0,color:"primary",isBlock:!0,showAnchorIcon:!0,href:e.handling_link||"#",anchorIcon:t(Le,{}),children:e.handling_memo||"N/A"})},{name:"Handling Status",selector:e=>e.handling_status,sortable:!0,center:"true",width:"180px",cell:e=>t(ee,{"aria-label":"Handling Status",color:h(e.handling_status),placeholder:"Select Status",value:e.handling_status,onChange:a=>g(e.id,"handling_status",a.target.value),fullWidth:!0,selectedKeys:[e.handling_status],popoverProps:{classNames:{content:"bg-transparent backdrop-blur-lg border-inherit"}},children:["Processing","Signed","Sent"].map(a=>t(Q,{value:e.handling_status,children:a},a))})},{name:"Need Reply",selector:e=>e.need_reply,center:"true",width:"80px",cell:e=>t(V,{color:h(e.status),isSelected:e.need_reply,onChange:a=>g(e.id,"need_reply",a.target.checked)})},{name:"Replied Status",selector:e=>e.replied_status,center:"true",width:"80px",cell:e=>t(V,{color:h(e.status),isSelected:e.replied_status,onChange:a=>g(e.id,"replied_status",a.target.checked)})},{name:"Need Forward",selector:e=>e.need_forward,center:"true",width:"80px",cell:e=>t(V,{color:h(e.status),isSelected:e.need_forward,onChange:a=>g(e.id,"need_forward",a.target.checked)})},{name:"Forwarded Status",selector:e=>e.forwarded_status,center:"true",width:"90px",cell:e=>t(V,{color:h(e.status),isSelected:e.forwarded_status,onChange:a=>g(e.id,"forwarded_status",a.target.checked)})},{name:"Dealt By",selector:e=>e.dealt_by,sortable:!0,center:"true",cell:e=>t(ee,{items:o,variant:"underlined","aria-label":"Dealt By",fullWidth:!0,value:e.dealt_by||"na",onChange:a=>g(e.id,"dealt_by",a.target.value),selectedKeys:[String(e.dealt_by)],style:{minWidth:"260px"},popoverProps:{classNames:{content:"bg-transparent backdrop-blur-lg border-inherit"},style:{whiteSpace:"nowrap",minWidth:"fit-content"}},placeholder:"Select a user",renderValue:a=>a.map(i=>t("div",{className:"flex items-center gap-2 m-1",children:t(ue,{style:{whiteSpace:"nowrap"},size:"sm",name:i.data.name,description:i.data.designation.title,avatarProps:{radius:"sm",size:"sm",src:i.data.profile_image}})},i.key)),children:a=>t(Q,{textValue:a.id,children:t(ue,{style:{whiteSpace:"nowrap"},size:"sm",name:a.name,description:a.designation.title,avatarProps:{radius:"sm",size:"sm",src:a.profile_image}})},a.id)})},{name:"Actions",center:"true",width:"150px",cell:e=>z("div",{className:"flex gap-4 items-center",children:[t(le,{variant:"bordered",isIconOnly:!0,color:"warning","aria-label":"Edit",onClick:()=>p("editLetter",e),children:t(Ne,{})}),t(le,{variant:"bordered",isIconOnly:!0,color:"danger","aria-label":"Delete",onClick:()=>handleDelete(e.id),children:t(qe,{})})]})}],g=async(e,a,i)=>{var S,f;try{const u=await ve.put(route("letters.update"),{id:e,[a]:i});u.status===200?(n(R=>R.map(k=>k.id===e?{...k,[a]:i}:k)),B.success(...u.data.messages||"Letter updated successfully",{icon:"ðŸŸ¢",style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:c.glassCard.backgroundColor,border:c.glassCard.border,color:c.palette.text.primary}})):B.error(u.data.error||`Failed to update letter ${[a]}.`,{icon:"ðŸ”´",style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:c.glassCard.backgroundColor,border:c.glassCard.border,color:c.palette.text.primary}})}catch(u){B.error(((f=(S=u.response)==null?void 0:S.data)==null?void 0:f.message)||"An unexpected error occurred.",{icon:"ðŸ”´",style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:c.glassCard.backgroundColor,border:c.glassCard.border,color:c.palette.text.primary}})}};return z("div",{children:[r&&t(bt,{}),t(Fe,{styles:{"& .cgTKyH":{backgroundColor:"transparent !important",color:c.palette.text.primary}}}),t(_t,{columns:w,data:s,defaultSortField:"received_date",highlightOnHover:!0,responsive:!0,dense:!0,sortIcon:t(Ae,{}),keyField:"id"})]})};Ze.extend(Ve);const Lt=q.memo(({auth:s,title:n,users:o})=>{const r=ye(),[d,p]=l.useState([]),[v,C]=l.useState(!1),[m,c]=l.useState(0),[h,y]=l.useState(0);l.useState([]);const[w,g]=l.useState(),[e,a]=l.useState(null),[i,S]=l.useState(null),[f,u]=l.useState(""),R=Pe(r.breakpoints.down("md")),[k,D]=l.useState(30),[T,W]=l.useState(1),K=async(b,_,E)=>{try{const H=await ve.get(route("letters.paginate"),{params:{page:b,perPage:_,search:E}});p(H.data.data),c(H.data.total),y(H.data.last_page),C(!1)}catch(H){console.error(H),B.error("Failed to fetch data.",{icon:"ðŸ”´",style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:r.glassCard.backgroundColor,border:r.glassCard.border,color:r.palette.text.primary}}),C(!1)}},A=()=>{const b=new Promise(async(_,E)=>{var H,Y;try{const F=await fetch("/delete-daily-work",{method:"DELETE",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.head.querySelector('meta[name="csrf-token"]').content},body:JSON.stringify({id:e,page:T,perPage:k,search:f,status:filterData.status!=="all"?filterData.status:"",inCharge:filterData.incharge!=="all"?filterData.incharge:"",startDate:(H=filterData.startDate)==null?void 0:H.format("YYYY-MM-DD"),endDate:(Y=filterData.endDate)==null?void 0:Y.format("YYYY-MM-DD")})}),M=await F.json();F.ok?(p(M.data),c(M.total),_("Daily work deleted successfully")):E(M.error||"Failed to delete task")}catch(F){console.error("Error deleting task:",F),E("An error occurred while deleting the task")}finally{$()}});B.promise(b,{pending:{render(){return z("div",{style:{display:"flex",alignItems:"center"},children:[t(Be,{}),t("span",{style:{marginLeft:"8px"},children:"Deleting task..."})]})},icon:!1,style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:r.glassCard.backgroundColor,border:r.glassCard.border,color:r.palette.text.primary}},success:{render({data:_}){return t(P,{children:_})},icon:"ðŸŸ¢",style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:r.glassCard.backgroundColor,border:r.glassCard.border,color:r.palette.text.primary}},error:{render({data:_}){return t(P,{children:_})},icon:"ðŸ”´",style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:r.glassCard.backgroundColor,border:r.glassCard.border,color:r.palette.text.primary}}})},N=l.useCallback((b,_)=>{a(b),S(_)},[]),$=l.useCallback(()=>{S(null),a(null)},[]),I=l.useCallback(b=>{S(b)},[]),j=l.useCallback(()=>{S(null)},[]),X=b=>{const _=b.target.value;u(_)};l.useEffect(()=>{C(!0),K(T,k,f)},[T,k,f]);const O=b=>{W(b)};return z(P,{children:[t(ze,{title:n}),i==="editLetter"&&t(LetterForm,{open:i==="editLetter",currentRow:w,setData:p,closeModal:j}),i==="deleteLetter"&&t(DeleteLetterForm,{open:i==="deleteLetter",handleClose:$,handleDelete:A,setData:p}),i==="importLetters"&&t(LettersUploadForm,{open:i==="importLetters",closeModal:j,setData:p,setTotalRows:c}),i==="exportLetters"&&t(LettersDownloadForm,{open:i==="exportLetters",closeModal:j,data:d,users:o}),t(G,{sx:{display:"flex",justifyContent:"center",p:2},children:t(je,{in:!0,children:z($e,{children:[t(Me,{title:n,sx:{padding:"24px"},action:z(G,{display:"flex",gap:2,children:[s.permissions.includes("addTask")&&t(Z,{title:"Add Task",color:"primary",id:"showAddModalBtn",children:t(Ge,{})}),s.roles.includes("Administrator")&&t(P,{children:R?z(P,{children:[t(Z,{title:"Import Letters",color:"warning",onClick:()=>I("importLetters"),children:t(ie,{})}),t(Z,{title:"Export Letters",color:"success",onClick:()=>I("exportLetters"),children:t(pe,{})})]}):z(P,{children:[t(ae,{title:"Import Letters",variant:"outlined",color:"warning",startIcon:t(ie,{}),onClick:()=>I("importLetters"),children:"Import"}),t(ae,{title:"Export Letters",variant:"outlined",color:"success",startIcon:t(pe,{}),onClick:()=>I("exportLetters"),children:"Export"})]})})]})}),t(ne,{children:t(G,{children:t(oe,{container:!0,spacing:2,children:t(oe,{item:!0,xs:12,sm:6,md:3,children:t(ke,{label:"Search",type:"text",fullWidth:!0,variant:"bordered",placeholder:"Search...",value:f,onChange:X,endContent:t(Qe,{})})})})})}),z(ne,{children:[t(wt,{setData:p,setCurrentRow:g,currentPage:T,setCurrentPage:W,setLoading:C,handleClickOpen:N,openModal:I,totalRows:m,lastPage:h,loading:v,allData:d,users:o,search:f}),m>=30&&t("div",{className:"py-2 px-2 flex justify-center items-center",children:t(et,{initialPage:1,isCompact:!0,showControls:!0,showShadow:!0,color:"primary",variant:"bordered",page:T,total:h,onChange:O})})]})]})})})]})});Lt.layout=s=>t(Oe,{children:s});export{Lt as default};
