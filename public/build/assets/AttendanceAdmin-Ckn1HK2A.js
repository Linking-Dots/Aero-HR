import{a as e,j as h,q as re,Y as ae,G as ne,F as b,c as oe,B as q}from"./app-DmQz1dGO.js";import{o as U,B as F,s as se,u as le,r as a,t as ce,e as de,g as ie,c as ue,f as pe,a as K,G as L,b as he,I as me}from"./vendor-CaUsQwso.js";import{A as ye}from"./App-DMAM_XZo.js";import{d as m}from"./dayjs.min-DQ0-_jOY.js";import{t as ge,a as be,b as fe,c as xe,d as E,e as Ce}from"./chunk-YRZGWF2W-B5mUHYMB.js";import{u as ke}from"./chunk-TLBGAR4N-D_K5h0Bl.js";import{d as _e,p as Me}from"./Search-3d9KyBXp.js";import{D as Q,u as P,w as ve}from"./xlsx-DAdaqk4J.js";import{i as we}from"./chunk-IR2E3HZF-C61U1WHR.js";import"./useFormValidationState-BAF8a-iD.js";import"./useLabel-DPrBl2Q7.js";var Ae={name:"1a5nq0o",styles:"width:100%;border-collapse:collapse;& td{border:1px solid #ddd;}& th{background-color:#f4f4f4;}"};const Se=({loading:f,attendanceData:r,currentYear:v,currentMonth:x,leaveTypes:w,leaveCounts:A})=>{const S=m(`${v}-${x}-01`).daysInMonth(),Y=[{label:"Sl",key:"sl"},{label:"Name",key:"name"},...Array.from({length:S},(t,n)=>{const d=n+1;return{label:`${d}`,key:`day-${d}`}}),...w.map(t=>({label:t.type,key:t.type}))],D=t=>w.map(n=>{var y;const d=((y=A[t])==null?void 0:y[n.type])||0;return e(E,{align:"center",children:d},`${t+n.type}`)}),C=t=>{const n=r.find(d=>d.user_id===t);return Array.from({length:S},(d,y)=>{const $=y+1,k=m(`${v}-${x}-${$}`).format("YYYY-MM-DD"),I=n?n[k]:"â–¼";return e(E,{align:"center",children:I},`day-${$}`)})};return e("div",{style:{maxHeight:"84vh",overflowY:"auto"},children:f?h(F,{display:"flex",justifyContent:"center",alignItems:"center",height:"100%",children:[e(U,{})," "]}):h(Ce,{isStriped:!0,selectionMode:"multiple",selectionBehavior:"toggle",isCompact:!0,isHeaderSticky:!0,removeWrapper:!0,"aria-label":"Attendance Table",css:Ae,children:[e(ge,{columns:Y,children:t=>e(be,{align:"center",children:t.label},t.key)}),e(fe,{children:r.map((t,n)=>h(xe,{children:[e(E,{children:n+1}),e(E,{style:{whiteSpace:"nowrap",textAlign:"start"},children:e(ke,{avatarProps:{radius:"lg",src:t.profile_image},name:t.name})}),C(t.user_id),D(t.user_id)]},t.user_id))})]})})},Ye=se.memo(({title:f})=>{const r=le(),[v,x]=a.useState(!1),{auth:w}=re().props,[A,S]=a.useState([]),[Y,D]=a.useState([]),[C,t]=a.useState([]),[n,d]=a.useState(0),[y,$]=a.useState(0),[k,I]=a.useState(""),z=ce(r.breakpoints.down("md")),[B,$e]=a.useState(30),[j,J]=a.useState(1),[i,O]=a.useState({currentMonth:m().format("YYYY-MM")}),G=m(`${i.currentYear}-${i.currentMonth}-01`).daysInMonth(),V=a.useCallback((o,s)=>{O(u=>({...u,[o]:s}))},[]),X=async(o,s,u)=>{x(!0);try{const l=await oe.get(route("attendancesAdmin.paginate"),{params:{page:o,perPage:s,employee:k,currentYear:u.currentMonth?m(u.currentMonth).year():"",currentMonth:u.currentMonth?m(u.currentMonth).format("MM"):""}});S(l.data.data),d(l.data.total),$(l.data.last_page),t(l.data.leaveTypes),D(l.data.leaveCounts)}catch(l){console.log(l),q.error("Failed to fetch data.",{icon:"ðŸ”´",style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:r.glassCard.backgroundColor,border:r.glassCard.border,color:r.palette.text.primary}})}finally{x(!1)}},Z=o=>{const s=o.target.value.toLowerCase();I(s)};a.useEffect(()=>{X(j,B,i)},[j,B,i,k]);const ee=o=>{J(o)},W=async()=>{const o=new Promise((s,u)=>{try{const l=allUsers.map((c,_)=>{const g=A.find(p=>p.user_id===c.id)||{},T={sl:_+1,name:c.name};for(let p=0;p<G;p++){const M=p+1,te=m(`${i.currentYear}-${i.currentMonth}-${M}`).format("YYYY-MM-DD");T[`day-${M}`]=g[te]||"â–¼"}return C.forEach(p=>{var M;T[p.type]=((M=Y[c.id])==null?void 0:M[p.type])||0}),T}),R=[{label:"Sl",key:"sl"},{label:"Name",key:"name"},...Array.from({length:G},(c,_)=>{const g=_+1;return{label:`${g}`,key:`day-${g}`}}),...C.map(c=>({label:c.type,key:c.type}))],H=P.json_to_sheet(l,{header:R.map(c=>c.key)});R.forEach((c,_)=>{const g=P.encode_cell({c:_,r:0});H[g].v=c.label});const N=P.book_new();P.book_append_sheet(N,H,"Attendance"),ve(N,"AttendanceData.xlsx"),s("Export successful!")}catch(l){u("Failed to export data. Please try again."),console.error("Error exporting data to Excel:",l)}});q.promise(o,{pending:{render(){return h("div",{style:{display:"flex",alignItems:"center"},children:[e(U,{}),e("span",{style:{marginLeft:"8px"},children:"Exporting data to Excel ..."})]})},icon:!1,style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:r.glassCard.backgroundColor,border:r.glassCard.border,color:r.palette.text.primary}},success:{render({data:s}){return e(b,{children:s})},icon:"ðŸŸ¢",style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:r.glassCard.backgroundColor,border:r.glassCard.border,color:r.palette.text.primary}},error:{render({data:s}){return e(b,{children:s})},icon:"ðŸ”´",style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:r.glassCard.backgroundColor,border:r.glassCard.border,color:r.palette.text.primary}}})};return h(b,{children:[e(ae,{title:f}),e(F,{sx:{display:"flex",justifyContent:"center",p:2},children:e(de,{in:!0,children:h(ne,{children:[e(ie,{title:"Attendances",sx:{padding:"24px"},action:e(F,{display:"flex",gap:2,children:w.roles.includes("Administrator")&&e(b,{children:z?e(b,{children:e(ue,{title:"Export Daily Works",color:"success",onClick:W,children:e(Q,{})})}):e(b,{children:e(pe,{title:"Export Daily Works",variant:"outlined",color:"success",startIcon:e(Q,{}),onClick:W,children:"Export"})})})})}),e(K,{children:e(F,{children:h(L,{container:!0,spacing:2,children:[e(L,{item:!0,xs:12,sm:6,md:4,children:e(he,{label:"Employee",fullWidth:!0,variant:"outlined",placeholder:"Employee...",value:k,onChange:Z,InputProps:{startAdornment:e(me,{position:"start",children:e(_e,{})})}})}),e(L,{item:!0,xs:12,sm:6,md:4,children:e(we,{label:"Current Month",type:"month",fullWidth:!0,variant:"bordered",placeholder:"Month...",value:i.currentMonth,onChange:o=>V("currentMonth",o.target.value)})})]})})}),h(K,{children:[e(Se,{attendanceData:A,currentYear:i.currentYear,currentMonth:i.currentMonth,leaveTypes:C,leaveCounts:Y,loading:v}),n>=30&&e("div",{className:"py-2 px-2 flex justify-center items-center",children:e(Me,{initialPage:1,isCompact:!0,showControls:!0,showShadow:!0,color:"primary",variant:"bordered",page:j,total:y,onChange:ee})})]})]})})})]})});Ye.layout=f=>e(ye,{children:f});export{Ye as default};
