import{a as e,j as i,F as x,U as z,M as Q}from"./app-BDL2Y3Ac.js";import{r as k,u as Z,v as U,w as ee,x as ae,y as te,T as N,b as f,z as re,f as W,c as E,k as F,S as O,M as g,F as I,h as L,e as ne,g as ie,B as q,a as oe}from"./vendor-DhsbrqqY.js";import{B as C,a as le,A as de,G as se}from"./App-BAl9-fyJ.js";import{t as J}from"./chunk-CSXHODZI-DZPtdVvQ.js";import{E as ce,D as pe}from"./Edit-DLAY4Fx8.js";import{t as ue,a as ge,b as me,c as he,d as be,e as xe}from"./chunk-F3UDT23P-DUMxki6N.js";import{u as ye}from"./chunk-R6AK6OQ4-YfMKL-bA.js";import{A as fe}from"./Add-NKU7InPC.js";import"./chunk-MZRCPRP2-BIsogASO.js";import"./chunk-SLABUSGS-CPDwsMNJ.js";import"./chunk-7F3ZLNJ6-Dd5bsoxT.js";import"./chunk-A6PX3NG3-B1_1_emB.js";const Ce=({allUsers:m,departments:v,designations:_,attendanceTypes:h})=>{var j,R,B;const[w,T]=k.useState(m||[]),[G,A]=k.useState(!1),[o,_e]=k.useState(null),[d,b]=k.useState({}),n=Z();if(!m||!v||!_)return e("div",{children:"Loading..."});async function D(a,l,r){const t=new Promise(async(s,p)=>{try{const c=r;let u;switch(a){case"department":u="user.updateDepartment";break;case"designation":u="user.updateDesignation";break;case"attendance_type":u="user.updateAttendanceType";break;default:u="user.updateDepartment"}const M=await fetch(route(u,{id:l}),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.head.querySelector('meta[name="csrf-token"]').content},body:JSON.stringify({[a==="attendance_type"?"attendance_type_id":a]:c})}),P=await M.json();M.ok?(T($=>$.map(S=>{if(String(S.id)===String(l)){const y={...S};if(a==="department"&&S.department!==c&&(y.designation=null),a==="attendance_type"){y.attendance_type_id=c;const K=h.find(Y=>Y.id===c);y.attendance_type=K}else y[a]=c;return y}return S})),s(P.messages)):(p([P.messages||"Failed to update profile information."]),console.error(P.errors))}catch(c){console.error(c),p(["An unexpected error occurred."])}});C.promise(t,{pending:{render(){return i("div",{style:{display:"flex",alignItems:"center"},children:[e(L,{}),i("span",{style:{marginLeft:"8px"},children:["Updating employee ",a.replace("_"," "),"..."]})]})},icon:!1,style:{backdropFilter:"blur(16px) saturate(200%)",background:n.glassCard.background,border:n.glassCard.border,color:n.palette.text.primary}},success:{render({data:s}){return e(x,{children:s.map((p,c)=>e("div",{children:p},c))})},icon:"ðŸŸ¢",style:{backdropFilter:"blur(16px) saturate(200%)",background:n.glassCard.background,border:n.glassCard.border,color:n.palette.text.primary}},error:{render({data:s}){return e(x,{children:s.map((p,c)=>e("div",{children:p},c))})},icon:"ðŸ”´",style:{backdropFilter:"blur(16px) saturate(200%)",background:n.glassCard.background,border:n.glassCard.border,color:n.palette.text.primary}}})}const H=async()=>{try{const a=await fetch(route("user.updateAttendanceType",{id:o.id}),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.head.querySelector('meta[name="csrf-token"]').content},body:JSON.stringify({attendance_type_id:o.attendance_type_id,attendance_config:d})}),l=await a.json();a.ok?(T(r=>r.map(t=>t.id===o.id?{...t,attendance_config:d}:t)),A(!1),C.success("Attendance configuration updated successfully!")):C.error("Failed to update attendance configuration.")}catch(a){console.error(a),C.error("An error occurred while updating configuration.")}},V=async a=>{const l=new Promise(async(r,t)=>{try{const s=await fetch(route("profile.delete"),{method:"DELETE",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.head.querySelector('meta[name="csrf-token"]').content},body:JSON.stringify({user_id:a})}),p=await s.json();s.ok?(T(c=>c.filter(u=>u.id!==a)),r([p.message])):t([p.message])}catch(s){console.error("Error deleting user:",s),t(["An error occurred while deleting user. Please try again."])}});C.promise(l,{pending:{render(){return i("div",{style:{display:"flex",alignItems:"center"},children:[e(L,{}),e("span",{style:{marginLeft:"8px"},children:"Deleting user..."})]})},icon:!1,style:{backdropFilter:"blur(16px) saturate(200%)",background:n.glassCard.background,border:n.glassCard.border,color:n.palette.text.primary}},success:{render({data:r}){return e(x,{children:r.map((t,s)=>e("div",{children:t},s))})},icon:"ðŸŸ¢",style:{backdropFilter:"blur(16px) saturate(200%)",background:n.glassCard.background,border:n.glassCard.border,color:n.palette.text.primary}},error:{render({data:r}){return e(x,{children:r.map((t,s)=>e("div",{children:t},s))})},icon:"ðŸ”´",style:{backdropFilter:"blur(16px) saturate(200%)",background:n.glassCard.background,border:n.glassCard.border,color:n.palette.text.primary}}})},X=(a,l)=>{const r=a[l];switch(l){case"employee_id":return r;case"name":return e(ye,{avatarProps:{radius:"lg",src:a==null?void 0:a.profile_image},name:a==null?void 0:a.name,children:a==null?void 0:a.email});case"phone":return r;case"email":return r;case"date_of_joining":return r;case"department":return i(I,{size:"small",fullWidth:!0,children:[e(F,{id:"department",children:"Department"}),i(O,{labelId:"department",id:`department-select-${a.id}`,value:a.department||"na",onChange:t=>D("department",a.id,t.target.value),label:"Department",variant:"outlined",MenuProps:{PaperProps:{sx:{backdropFilter:"blur(16px) saturate(200%)",background:n.glassCard.background,border:n.glassCard.border,borderRadius:2,boxShadow:"rgb(255, 255, 255) 0px 0px 0px 0px, rgba(0, 0, 0, 0.05) 0px 0px 0px 1px, rgba(0, 0, 0, 0.1) 0px 10px 15px -3px, rgba(0, 0, 0, 0.05) 0px 4px 6px -2px"}}},children:[e(g,{value:"na",disabled:!0,children:"Select Department"}),v.map(t=>e(g,{value:t.id,children:t.name},t.id))]})]});case"designation":return i(I,{size:"small",fullWidth:!0,sx:{zIndex:0},children:[e(F,{id:"designation",children:"Designation"}),i(O,{variant:"outlined",labelId:"designation",id:`designation-select-${a.id}`,value:a.designation||"na",onChange:t=>D("designation",a.id,t.target.value),disabled:!a.department,label:"Designation",MenuProps:{PaperProps:{sx:{backdropFilter:"blur(16px) saturate(200%)",background:n.glassCard.background,border:n.glassCard.border,borderRadius:2,boxShadow:"rgb(255, 255, 255) 0px 0px 0px 0px, rgba(0, 0, 0, 0.05) 0px 0px 0px 1px, rgba(0, 0, 0, 0.1) 0px 10px 15px -3px, rgba(0, 0, 0, 0.05) 0px 4px 6px -2px"}}},children:[e(g,{value:"na",disabled:!0,children:"Select Designation"}),_.filter(t=>t.department_id===a.department).map(t=>e(g,{value:t.id,children:t.title},t.id))]})]});case"attendance_type":return i(I,{size:"small",fullWidth:!0,sx:{zIndex:0},children:[e(F,{id:"attendance-type",children:"Attendance Type"}),i(O,{variant:"outlined",labelId:"attendance-type",id:`attendance-type-select-${a.id}`,value:a.attendance_type_id||"na",onChange:t=>D("attendance_type",a.id,t.target.value),label:"Attendance Type",MenuProps:{PaperProps:{sx:{backdropFilter:"blur(16px) saturate(200%)",background:n.glassCard.background,border:n.glassCard.border,borderRadius:2,boxShadow:"rgb(255, 255, 255) 0px 0px 0px 0px, rgba(0, 0, 0, 0.05) 0px 0px 0px 1px, rgba(0, 0, 0, 0.1) 0px 10px 15px -3px, rgba(0, 0, 0, 0.05) 0px 4px 6px -2px"}}},children:[e(g,{value:"na",disabled:!0,children:"Select Attendance Type"}),h&&h.length>0?h.map(t=>e(g,{value:t.id,children:i("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[t.icon&&e("span",{children:t.icon}),t.name]})},t.id)):e(g,{disabled:!0,children:"No attendance types available"})]})]});case"actions":return i("div",{className:"relative flex items-center gap-2",children:[e(J,{content:"View Profile",children:e(E,{className:"text-lg text-default-400 cursor-pointer active:opacity-50",component:z,href:route("profile",{user:a.id}),children:e(le,{})})}),e(J,{content:"Edit User",children:e(E,{className:"text-lg text-default-400 cursor-pointer active:opacity-50",component:z,href:route("profile",{user:a.id}),children:e(ce,{})})}),e(J,{content:"Delete User",color:"danger",children:e(E,{className:"text-lg text-danger cursor-pointer active:opacity-50",onClick:()=>{V(a.id)},children:e(pe,{})})})]});default:return"N/A"}};return i(x,{children:[e("div",{style:{maxHeight:"84vh",overflowY:"auto"},children:i(ue,{fullWidth:!0,isCompact:!0,isHeaderSticky:!0,removeWrapper:!0,isStriped:!0,"aria-label":"Employees Table",children:[e(ge,{columns:[{name:"Employee ID",uid:"employee_id"},{name:"Name",uid:"name"},{name:"Mobile",uid:"phone"},{name:"Email",uid:"email"},{name:"Join Date",uid:"date_of_joining"},{name:"Department",uid:"department"},{name:"Designation",uid:"designation"},{name:"Attendance Type",uid:"attendance_type"},{name:"Action",uid:"actions"}],children:a=>e(me,{align:a.uid==="actions"?"center":"start",children:a.name},a.uid)}),e(he,{items:w,children:a=>e(be,{children:l=>e(xe,{style:{whiteSpace:"nowrap"},children:X(a,l)})},a.id)})]},w.length)}),i(U,{open:G,onClose:()=>A(!1),maxWidth:"md",fullWidth:!0,PaperProps:{sx:{backdropFilter:"blur(16px) saturate(200%)",background:n.glassCard.background,border:n.glassCard.border,borderRadius:2}},children:[i(ee,{children:["Configure Attendance Settings for ",o==null?void 0:o.name,(o==null?void 0:o.attendance_type)&&e(ae,{label:o.attendance_type.name,icon:o.attendance_type.icon?e("span",{children:o.attendance_type.icon}):void 0,sx:{ml:2}})]}),i(te,{children:[((j=o==null?void 0:o.attendance_type)==null?void 0:j.slug)==="geo_polygon"&&i("div",{children:[e(N,{variant:"h6",gutterBottom:!0,children:"Polygon Configuration"}),e(f,{fullWidth:!0,label:"Polygon Coordinates (JSON)",multiline:!0,rows:4,value:JSON.stringify(d.polygon||[],null,2),onChange:a=>{try{const l=JSON.parse(a.target.value);b({...d,polygon:l})}catch{}},margin:"normal",helperText:"Enter polygon coordinates as JSON array: [{'lat': 23.123, 'lng': 90.456}, ...]"})]}),((R=o==null?void 0:o.attendance_type)==null?void 0:R.slug)==="wifi_ip"&&i("div",{children:[e(N,{variant:"h6",gutterBottom:!0,children:"WiFi/IP Configuration"}),e(f,{fullWidth:!0,label:"Allowed IP Addresses (comma separated)",value:(d.allowed_ips||[]).join(", "),onChange:a=>{const l=a.target.value.split(",").map(r=>r.trim()).filter(r=>r);b({...d,allowed_ips:l})},margin:"normal",helperText:"Enter allowed IP addresses separated by commas"}),e(f,{fullWidth:!0,label:"Allowed IP Ranges (CIDR notation, comma separated)",value:(d.allowed_ranges||[]).join(", "),onChange:a=>{const l=a.target.value.split(",").map(r=>r.trim()).filter(r=>r);b({...d,allowed_ranges:l})},margin:"normal",helperText:"Enter IP ranges like: 192.168.1.0/24, 10.0.0.0/8"})]}),((B=o==null?void 0:o.attendance_type)==null?void 0:B.slug)==="route_waypoint"&&i("div",{children:[e(N,{variant:"h6",gutterBottom:!0,children:"Route Waypoint Configuration"}),e(f,{fullWidth:!0,label:"Tolerance (meters)",type:"number",value:d.tolerance||200,onChange:a=>b({...d,tolerance:parseInt(a.target.value)}),margin:"normal"}),e(f,{fullWidth:!0,label:"Waypoints (JSON)",multiline:!0,rows:4,value:d.waypointsText||JSON.stringify(d.waypoints||[],null,2),onChange:a=>{const l=a.target.value;b(r=>({...r,waypointsText:l}));try{const r=JSON.parse(l);Array.isArray(r)&&b(t=>({...t,waypoints:r,waypointsText:l}))}catch{console.log("Invalid JSON, but allowing text editing")}},margin:"normal",helperText:"Enter waypoints as JSON array: [{'lat': 23.123, 'lng': 90.456}, ...]",error:(()=>{try{const a=d.waypointsText||JSON.stringify(d.waypoints||[],null,2);return JSON.parse(a),!1}catch{return!0}})()})]})]}),i(re,{children:[e(W,{onClick:()=>A(!1),children:"Cancel"}),e(W,{onClick:H,variant:"contained",children:"Save Configuration"})]})]})]})},ve=({title:m,allUsers:v,departments:_,designations:h,attendanceTypes:w})=>i(x,{children:[e(Q,{title:m}),e(q,{sx:{display:"flex",justifyContent:"center",p:2},children:e(ne,{in:!0,children:i(se,{children:[e(ie,{title:"Employees",sx:{padding:"24px"},action:e(q,{display:"flex",gap:2,children:e(W,{title:"Add Employee",variant:"outlined",color:"success",startIcon:e(fe,{}),children:"Add Employee"})})}),e(oe,{children:e(Ce,{allUsers:v,departments:_,designations:h,attendanceTypes:w})})]})})})]});ve.layout=m=>e(de,{children:m});export{ve as default};
