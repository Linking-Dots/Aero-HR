import{J as Ze,r as l,a as G,j as s,b as m,e as W,F as be,Q as Ue,f as ea,c as te}from"./app-vxJEuD-Q.js";import{u as aa,G as ye,T as M,B as we,F as ta}from"./logo-g9YP4PG9.js";import{P as ra}from"./PageHeader-BeJuacUS.js";import{S as sa}from"./StatsCards-9Uz3XXED.js";import{u as ke,B as D,a as la,G as oa,b as re,c as H,A as na}from"./App-BT8BxCJ3.js";import{L as _e,D as ia,B as da,a as ca,b as ma}from"./BulkDeleteModal-ClWHMCWs.js";import{d as Pe}from"./dayjs.min-BjJFeL87.js";import{F as ua}from"./CheckCircleIcon-BV__7fPs.js";import{F as pa}from"./XCircleIcon-DHNxfu0p.js";import{F as Ce}from"./ChartBarIcon-D199JcIs.js";import{F as Se}from"./ExclamationTriangleIcon-BLU4Cpqb.js";import{F as va}from"./MagnifyingGlassIcon-mh8Mw0Q1.js";import{F as ha}from"./AdjustmentsHorizontalIcon-B8D11j4z.js";import{C as ga}from"./CircularProgress-Dh0N64S7.js";import{F as fa}from"./PlusIcon-C4bbiGhJ.js";import{F as ba}from"./DocumentArrowDownIcon-Ccq1BO5v.js";import{F as ya}from"./PresentationChartLineIcon-D94LSdNh.js";import{i as Le}from"./chunk-6MDMHKHV-D9rXeZJI.js";import{b as wa}from"./chunk-57V4RE7B-CkhO8dxh.js";import{s as se,l as R}from"./chunk-2GIFKCNQ-CFraMr1A.js";import"./app-CX8GSXRI.js";import"./create-visual-element-BaeSogmb.js";import"./chunk-D5XJWRAV-D2I4RFfZ.js";import"./EnvelopeIcon-0Ed3Ojh4.js";import"./UserIcon-Cwmcvl4r.js";import"./ShieldCheckIcon-B4rgpKpm.js";import"./TrashIcon-uQ6a2ypJ.js";import"./PencilIcon--2aHcfc6.js";import"./EllipsisVerticalIcon-DgccSi4E.js";import"./XCircleIcon-D_jT1NZz.js";import"./CheckCircleIcon-CKrJhQNY.js";import"./ClockIcon-DYF6qwHW.js";import"./ExclamationTriangleIcon-CHpopMB1.js";import"./CardContent-DsN_0Jju.js";import"./colorManipulator-BoyoDkGl.js";import"./chunk-F3UDT23P-mOqhZ_sY.js";import"./chunk-MZRCPRP2-CFlyd_ao.js";import"./useHasTabbableChild-DmypSWSf.js";import"./chunk-7F3ZLNJ6-C__I5l7e.js";import"./chunk-7ZZXWEXF-Dq6yJxwn.js";import"./chunk-R6AK6OQ4-C9ngbHq9.js";import"./chunk-O5I3QTYU-CIGLpq7d.js";import"./index-CokAva9Y.js";import"./Clear-G6H8M5bx.js";import"./GlassDialog-emp7_90C.js";import"./Dialog-D_Q59pOx.js";import"./DialogTitle-BlXR1-7a.js";import"./DialogContent-B87ZKfwG.js";import"./TextField-BU0hxfg8.js";import"./Select-DowLc5Dk.js";import"./Popover-BocvnZh2.js";import"./Avatar-BLqgLCbs.js";import"./useSlot-ANw5ZdAp.js";import"./LoadingButton-Dr6VK0mT.js";import"./Button-BPfGwbjN.js";import"./DialogContentText-B4N7JZUV.js";import"./CardHeader-Bv7Bkz7x.js";import"./InformationCircleIcon-MBshrEH8.js";import"./ListItemText-aQTmD9de.js";import"./Divider-UmV619bM.js";const ka=({title:J,allUsers:v})=>{var pe,ve,he,ge,fe;const{auth:B}=Ze().props,x=aa(),Q=ke(x.breakpoints.down("sm"));ke(x.breakpoints.down("md"));const[Ae,X]=l.useState(!1),[F,j]=l.useState([]),[u,h]=l.useState(),[N,g]=l.useState(0),[Me,C]=l.useState(0),[K,le]=l.useState(),[Ne,oe]=l.useState([]),[ne,E]=l.useState(""),[ie,xe]=l.useState([]),[d,S]=l.useState({perPage:30,currentPage:1}),[_a,T]=l.useState(!1),[V,Fe]=l.useState(!1),[a,Te]=l.useState({employee:"",selectedMonth:Pe().format("YYYY-MM"),status:[],leaveType:[],department:[]}),f=l.useCallback((e,t)=>{if(e==="year"){const r=Number(t);if(r<1900||r>new Date().getFullYear()){console.warn("Invalid year selected. Must be between 1900 and current year.");return}}Te(r=>({...r,[e]:t})),S(r=>({...r,currentPage:1}))},[]),[O,De]=l.useState({pending:0,approved:0,rejected:0,total:0}),z=((pe=B.permissions)==null?void 0:pe.includes("leaves.view"))||!1,$=((ve=B.permissions)==null?void 0:ve.includes("leaves.approve"))||!1,de=((he=B.permissions)==null?void 0:he.includes("leaves.create"))||!1,Re=((ge=B.permissions)==null?void 0:ge.includes("leaves.update"))||!1,Be=((fe=B.permissions)==null?void 0:fe.includes("leaves.delete"))||!1,je=l.useMemo(()=>{const e=[{key:"all",label:"All Types",value:"all"}];if(!F.leaveTypes)return e;const t=F.leaveTypes.map(r=>({key:r.type.toLowerCase(),label:r.type,value:r.type.toLowerCase()}));return[...e,...t]},[F.leaveTypes]),Ee=l.useCallback(e=>{Y(t=>({...t,[e]:!0}))},[]),Oe=l.useCallback((e,t)=>{le({id:e}),Y(r=>({...r,[t]:!0}))},[]);l.useCallback(e=>{f("employee",e.target.value.toLowerCase())},[f]);const Z=l.useCallback(e=>{f("selectedMonth",e.target.value)},[f]),ze=l.useCallback(e=>{S(t=>({...t,currentPage:e}))},[]),$e=l.useCallback(e=>{S(t=>({...t,perPage:e,currentPage:1}))},[]),b=l.useCallback(async(e=null,t=null)=>{var n,c,_,p,w;X(!0);const r=e||d.currentPage,o=t||d.perPage;try{const P=await G.get(route("leaves.paginate"),{params:{page:r,perPage:o,employee:a.employee,month:a.selectedMonth,status:Array.isArray(a.status)&&a.status.length>0?a.status:void 0,leave_type:Array.isArray(a.leaveType)&&a.leaveType.length>0?a.leaveType:void 0,department:Array.isArray(a.department)&&a.department.length>0?a.department:void 0,admin_view:!0,view_all:!0}});if(P.status===200){const{leaves:i,leavesData:A,departments:ee}=P.data;i!=null&&i.data&&Array.isArray(i.data)?(h(i.data),g(i.total||i.data.length),C(i.last_page||1),e&&e!==d.currentPage&&S(ae=>({...ae,currentPage:e})),t&&t!==d.perPage&&S(ae=>({...ae,perPage:t}))):Array.isArray(i)?(h(i),g(i.length),C(1)):(console.error("Unexpected leaves data format:",i),h([]),g(0),C(1)),j(A),xe(ee||[]),E("")}}catch(P){if(console.error("Error fetching leaves data:",P.response),((n=P.response)==null?void 0:n.status)===404){const{leavesData:i}=P.response.data||{};j(i||[]),E(((_=(c=P.response)==null?void 0:c.data)==null?void 0:_.message)||"No leaves found for the selected criteria.")}else E(((w=(p=P.response)==null?void 0:p.data)==null?void 0:w.message)||"Error retrieving leaves data. Please try again.");h([]),g(0),C(1)}finally{X(!1)}},[a,d.currentPage,d.perPage]),L=l.useCallback(async()=>{var e,t,r;try{const o=await G.get(route("leaves.stats"),{params:{month:a.selectedMonth,admin_view:!0,view_all:!0}});if(o.status===200){const{stats:n}=o.data;De(n)}}catch(o){console.error("Error fetching leaves data:",o.response),((e=o.response)==null?void 0:e.status)===404?E(((r=(t=o.response)==null?void 0:t.data)==null?void 0:r.message)||"No leaves found for the selected criteria."):E("Error retrieving leaves data. Please try again."),X(!1)}},[a]),Ye=l.useCallback(async e=>{if($)try{if((await G.post(route("leaves.bulk-approve"),{leave_ids:e})).status===200){b();const r=Promise.resolve();D.promise(r,{success:"Selected leaves approved successfully"})}}catch(t){console.error("Error bulk approving leaves:",t);const r=Promise.reject(t);D.promise(r,{error:"Failed to approve selected leaves"})}},[$,b]),Ie=l.useCallback(async e=>{if($)try{if((await G.post(route("leaves.bulk-reject"),{leave_ids:e})).status===200){b();const r=Promise.resolve();D.promise(r,{success:"Selected leaves rejected successfully"})}}catch(t){console.error("Error bulk rejecting leaves:",t);const r=Promise.reject(t);D.promise(r,{error:"Failed to reject selected leaves"})}},[$,b]),qe=l.useCallback(e=>{oe(e),Y(t=>({...t,bulk_delete:!0}))},[]),Ge=l.useMemo(()=>[{title:"Pending",value:O.pending,icon:s(la,{}),color:"text-orange-400",iconBg:"bg-orange-500/20",description:"Awaiting approval"},{title:"Approved",value:O.approved,icon:s(ua,{}),color:"text-green-400",iconBg:"bg-green-500/20",description:"Successfully approved"},{title:"Rejected",value:O.rejected,icon:s(pa,{}),color:"text-red-400",iconBg:"bg-red-500/20",description:"Declined requests"},{title:"Total",value:O.total,icon:s(Ce,{}),color:"text-blue-400",iconBg:"bg-blue-500/20",description:"All leave requests"}],[O]);if(!z)return s(we,{sx:{display:"flex",justifyContent:"center",p:2},children:s(ye,{children:m(W,{className:"p-8 text-center",children:[s(Se,{className:"w-16 h-16 text-warning-500 mx-auto mb-4"}),s(M,{variant:"h6",className:"mb-2",children:"Access Denied"}),s(M,{variant:"body2",color:"textSecondary",children:"You don't have permission to view leave management."})]})})});const[y,Y]=l.useState({add_leave:!1,edit_leave:!1,delete_leave:!1,bulk_leave:!1,bulk_delete:!1}),Qe=l.useRef(null),ce=l.useCallback(e=>{Y(t=>({...t,[e]:!0}))},[]),I=l.useCallback(e=>{Y(t=>({...t,[e]:!1})),e==="bulk_delete"&&oe([])},[]),me=l.useCallback(e=>[...e].sort((t,r)=>new Date(r.from_date)-new Date(t.from_date)),[]),q=l.useCallback((e,t=null)=>{g(e);const r=Math.max(1,Math.ceil(e/d.perPage));C(r),d.currentPage>r&&S(o=>({...o,currentPage:r}))},[d.perPage,d.currentPage]),ue=l.useCallback(e=>{const t=Pe(e.from_date).format("YYYY-MM");if(a.selectedMonth&&t!==a.selectedMonth)return!1;if(a.employee){const r=v==null?void 0:v.find(n=>String(n.id)===String(e.user_id)),o=a.employee.trim().toLowerCase();if(r){if(String(r.id)!==o&&!(r.name&&r.name.trim().toLowerCase().includes(o)))return!1}else if(String(a.employee)!==String(e.user_id))return!1}if(Array.isArray(a.status)&&a.status.length>0&&!a.status.some(o=>String(e.status).toLowerCase()===String(o).toLowerCase())||Array.isArray(a.leaveType)&&a.leaveType.length>0&&!a.leaveType.some(o=>String(e.leave_type).toLowerCase()===String(o).toLowerCase()))return!1;if(Array.isArray(a.department)&&a.department.length>0){const r=v==null?void 0:v.find(n=>String(n.id)===String(e.user_id));if(!r||!a.department.some(n=>String(r.department_id)===String(n)))return!1}return!0},[a,v]),Ke=l.useMemo(()=>u||[],[u]),U=l.useCallback(async()=>{if(u&&u.length<d.perPage&&N>u.length){const e=Math.min(d.perPage-u.length,N-u.length);if(e<=0)return;T(!0);try{const t=await G.get(route("leaves.paginate"),{params:{page:d.currentPage+1,perPage:e,employee:a.employee,month:a.selectedMonth,status:Array.isArray(a.status)&&a.status.length>0?a.status:void 0,leave_type:Array.isArray(a.leaveType)&&a.leaveType.length>0?a.leaveType:void 0,department:Array.isArray(a.department)&&a.department.length>0?a.department:void 0,admin_view:!0,view_all:!0}});t.status===200&&t.data.leaves.data&&h(r=>{const o=t.data.leaves.data.filter(ue),n=[...r,...o];return me(n)})}catch(t){const r=Promise.reject(t);D.promise(r,{error:"Error fetching additional items."}),console.error(`Error fetching additional items from page ${d.currentPage+1}:`,t)}finally{T(!1)}}},[d.currentPage,d.perPage,u,a,me,ue]),k=l.useCallback((e,t)=>{if(!t||!t.success){console.error(`Invalid ${e} response data:`,t);return}L(),t.leavesData&&j(t.leavesData);const r=d.perPage,o=d.currentPage;switch(e){case"bulk_delete":{const n=t.deleted_leaves||[],c=t.deleted_count||n.length;if(c===0)return;const _=n.map(i=>i.id),p=Math.max(0,N-c),w=u.filter(i=>!_.includes(i.id)).length;if(c>5||w===0||o>1&&w<r/2){const i=Math.ceil(p/r);let A=o;w===0&&p>0?A=Math.max(1,o-1):o>i&&i>0&&(A=i),S(ee=>({...ee,currentPage:A})),b(A,r)}else T(!0),h(i=>i.filter(A=>!_.includes(A.id))),g(p),q(p),T(!1),U();break}case"single_delete":{const n=t.deleted_leave_id;if(!n)return;const c=Math.max(0,N-1);if(u.filter(p=>p.id!==n).length===0&&c>0&&o>1){const p=o-1;S(w=>({...w,currentPage:p})),b(p,r)}else T(!0),h(p=>p.filter(w=>w.id!==n)),g(c),q(c),T(!1),U();break}case"bulk_add":case"single_add":{const n=t.added_count||1,c=N+n;e==="bulk_add"||u.length<r?(g(c),q(c),b(o,r)):(g(c),q(c));break}case"edit":{const n=t.updated_leave||t.leave;n&&h(c=>c.map(_=>_.id===n.id?n:_));break}}},[d.perPage,d.currentPage,N,u,L,q,b,U]),Ve=l.useCallback(e=>{k("single_add",{success:!0,added_count:1,leave:e})},[k]),We=l.useCallback(e=>{k("edit",{success:!0,updated_leave:e});const r=Promise.resolve(["Leave updated!"]);D.promise(r,{success:{render({data:o}){return s(be,{children:o.map((n,c)=>s("div",{children:n},c))})},icon:"ðŸŸ¢",style:{backdropFilter:"blur(16px) saturate(200%)",background:x.glassCard.background,border:x.glassCard.border,color:x.palette.text.primary}}})},[b,L,x]),He=l.useCallback(e=>{var n;if(!e||!e.success){console.error("Invalid bulk response data:",e);return}const t=e.created_leaves||[],r=((n=e.summary)==null?void 0:n.successful)||t.length,o={...e,added_count:r};k("bulk_add",o)},[k]),Je=l.useCallback(e=>{k("single_delete",{success:!0,deleted_leave_id:e})},[k]),Xe=l.useCallback(e=>{k("bulk_delete",e)},[k]);return l.useEffect(()=>{z&&b()},[b,z,d.currentPage,a.employee,a.selectedMonth,a.status,a.leaveType,a.department]),l.useEffect(()=>{z&&L()},[b,z]),m(be,{children:[s(Ue,{title:J}),y.add_leave&&s(_e,{open:y.add_leave,closeModal:()=>I("add_leave"),leavesData:F,setLeavesData:j,currentLeave:null,allUsers:v,setTotalRows:g,setLastPage:C,setLeaves:h,handleMonthChange:Z,employee:a.employee,selectedMonth:a.selectedMonth,addLeaveOptimized:Ve,fetchLeavesStats:L}),y.edit_leave&&s(_e,{open:y.edit_leave,closeModal:()=>I("edit_leave"),leavesData:F,setLeavesData:j,currentLeave:K,allUsers:v,setTotalRows:g,setLastPage:C,setLeaves:h,handleMonthChange:Z,employee:a.employee,selectedMonth:a.selectedMonth,updateLeaveOptimized:We,fetchLeavesStats:L}),y.delete_leave&&s(ia,{open:y.delete_leave,closeModal:()=>I("delete_leave"),leaveId:K==null?void 0:K.id,setLeaves:h,setTotalRows:g,setLastPage:C,deleteLeaveOptimized:Je,fetchLeavesStats:L}),y.bulk_leave&&s(da,{open:y.bulk_leave,onClose:()=>I("bulk_leave"),onSuccess:e=>{He(e)},allUsers:v,leavesData:F,isAdmin:!0}),y.bulk_delete&&s(ca,{open:y.bulk_delete,onClose:()=>I("bulk_delete"),onSuccess:e=>{Xe(e)},selectedLeaves:Ne,allUsers:v}),s(we,{sx:{display:"flex",justifyContent:"center",p:2},children:s(oa,{in:!0,children:s(ye,{children:s(ra,{title:"Leave Management",subtitle:"Manage employee leave requests and approvals",icon:s(ya,{className:"w-8 h-8"}),variant:"gradient",actionButtons:[...de?[{label:"Add Leave",icon:s(fa,{className:"w-4 h-4"}),onPress:()=>ce("add_leave"),className:"bg-gradient-to-r from-[var(--theme-primary)] to-[var(--theme-secondary)] text-white font-medium hover:opacity-90"}]:[],...de?[{label:"Add Bulk",icon:s(re,{className:"w-4 h-4"}),onPress:()=>ce("bulk_leave"),className:"bg-gradient-to-r from-[var(--theme-primary)] to-[var(--theme-secondary)] text-white font-medium hover:opacity-90"}]:[],{label:"Export",icon:s(ba,{className:"w-4 h-4"}),variant:"bordered",className:"border-[rgba(var(--theme-primary-rgb),0.3)] bg-[rgba(var(--theme-primary-rgb),0.05)] hover:bg-[rgba(var(--theme-primary-rgb),0.1)]"}],children:m("div",{className:"p-6",children:[s(sa,{stats:Ge}),m("div",{className:"flex flex-col sm:flex-row gap-4 mb-6",children:[s("div",{className:"flex-1",children:s(Le,{label:"Search Employee",variant:"bordered",placeholder:"Search by name or ID...",value:a.employee,onValueChange:e=>f("employee",e),startContent:s(va,{className:"w-4 h-4"}),classNames:{input:"bg-transparent",inputWrapper:"bg-white/10 backdrop-blur-md border-white/20 hover:bg-white/15"},size:Q?"sm":"md"})}),s("div",{className:"flex gap-2 items-end",children:s(wa,{variant:"bordered",className:"bg-white/5",children:m(ea,{isIconOnly:Q,color:V?"primary":"default",onPress:()=>Fe(!V),className:V?"bg-purple-500/20":"bg-white/5",children:[s(ha,{className:"w-4 h-4"}),!Q&&s("span",{className:"ml-1",children:"Filters"})]})})})]}),V&&s(ta,{in:!0,timeout:300,children:m("div",{className:"mb-6 p-4 bg-white/5 backdrop-blur-md rounded-lg border border-white/10",children:[m("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:[m(se,{label:"Leave Status",selectionMode:"multiple",variant:"bordered",selectedKeys:a.status,onSelectionChange:e=>f("status",Array.from(e)),classNames:{trigger:"bg-white/10 backdrop-blur-md border-white/20 hover:bg-white/15"},children:[s(R,{value:"pending",children:"Pending"},"pending"),s(R,{value:"approved",children:"Approved"},"approved"),s(R,{value:"rejected",children:"Rejected"},"rejected"),s(R,{value:"new",children:"New"},"new")]}),s(se,{label:"Leave Type",variant:"bordered",selectionMode:"multiple",selectedKeys:a.leaveType,onSelectionChange:e=>f("leaveType",Array.from(e)),classNames:{trigger:"bg-white/10 backdrop-blur-md border-white/20 hover:bg-white/15"},children:je.map(e=>s(R,{value:e.value,children:e.label},e.key))}),s(se,{label:"Department",variant:"bordered",selectionMode:"multiple",selectedKeys:a.department,onSelectionChange:e=>f("department",Array.from(e)),classNames:{trigger:"bg-white/10 backdrop-blur-md border-white/20 hover:bg-white/15"},children:ie.map(e=>s(R,{value:e.id,children:e.name},e.id))}),s(Le,{label:"Month/Year",type:"month",value:a.selectedMonth,onChange:Z,startContent:s(re,{className:"w-4 h-4"}),variant:"bordered",classNames:{inputWrapper:"bg-white/10 backdrop-blur-md border-white/20 hover:bg-white/15"},size:Q?"sm":"md"})]}),(a.employee||Array.isArray(a.status)&&a.status.length>0||Array.isArray(a.leaveType)&&a.leaveType.length>0||Array.isArray(a.department)&&a.department.length>0)&&m("div",{className:"flex flex-wrap gap-2 mt-4 pt-4 border-t border-white/10",children:[a.employee&&m(H,{variant:"flat",color:"primary",size:"sm",onClose:()=>f("employee",""),children:["Employee: ",a.employee]}),Array.isArray(a.status)&&a.status.map(e=>m(H,{variant:"flat",color:"secondary",size:"sm",onClose:()=>f("status",a.status.filter(t=>t!==e)),children:["Status: ",e]},e)),Array.isArray(a.leaveType)&&a.leaveType.map(e=>m(H,{variant:"flat",color:"warning",size:"sm",onClose:()=>f("leaveType",a.leaveType.filter(t=>t!==e)),children:["Type: ",e]},e)),Array.isArray(a.department)&&a.department.map(e=>{const t=ie.find(r=>String(r.id)===String(e));return m(H,{variant:"flat",color:"success",size:"sm",onClose:()=>f("department",a.department.filter(r=>r!==e)),children:["Department: ",(t==null?void 0:t.name)||`ID: ${e}`]},e)})]})]})}),m("div",{className:"min-h-96",children:[m(M,{variant:"h6",className:"mb-4 flex items-center gap-2",children:[s(Ce,{className:"w-5 h-5"}),"Leave Requests Management"]}),Ae?s(te,{className:"bg-white/10 backdrop-blur-md border-white/20",children:m(W,{className:"text-center py-12",children:[s(ga,{size:40}),s(M,{className:"mt-4",color:"textSecondary",children:"Loading leave data..."})]})}):u&&u.length>0?s("div",{className:"overflow-hidden rounded-lg",children:s(ma,{ref:Qe,totalRows:N,lastPage:Me,setCurrentPage:ze,setPerPage:$e,perPage:d.perPage,currentPage:d.currentPage,handleClickOpen:Oe,setCurrentLeave:le,openModal:Ee,leaves:Ke,allUsers:v,setLeaves:h,employee:a.employee,selectedMonth:a.selectedMonth,isAdminView:!0,onBulkApprove:Ye,onBulkReject:Ie,canApproveLeaves:$,canEditLeaves:Re,canDeleteLeaves:Be,fetchLeavesStats:L,onBulkDelete:qe})}):ne?s(te,{className:"bg-white/10 backdrop-blur-md border-white/20",children:m(W,{className:"text-center py-12",children:[s(Se,{className:"w-16 h-16 text-warning-500 mx-auto mb-4"}),s(M,{variant:"h6",className:"mb-2",children:"No Data Found"}),s(M,{color:"textSecondary",children:ne})]})}):s(te,{className:"bg-white/10 backdrop-blur-md border-white/20",children:m(W,{className:"text-center py-12",children:[s(re,{className:"w-16 h-16 text-default-400 mx-auto mb-4"}),s(M,{variant:"h6",className:"mb-2",children:"No Leave Records Found"}),s(M,{color:"textSecondary",children:"No leave records found for the selected criteria."})]})})]})]})})})})})]})};ka.layout=J=>s(na,{children:J});export{ka as default};
