import{J as Ye,r as o,a as R,j as r,b as i,e as I,Q as Oe,f as Ie,c as W,F as qe}from"./app-CEzniZE0.js";import{u as Ge,a as le,r as S,c as Qe,b as ne,e as ie,T as w,B as ce,G as Ke,i as de,q as Ve,j as me,h as q,A as We}from"./App-BDoHcQM2.js";import{P as He}from"./PageHeader-D4a1Mce2.js";import{S as Je}from"./StatsCards-DaU3FK2z.js";import{L as pe,D as Xe,a as Ze}from"./DeleteLeaveForm-Ck47i7r_.js";import{d as ue}from"./dayjs.min-DqKbmimS.js";import{F as Ue}from"./CheckCircleIcon-DM5o0-iI.js";import{F as ea}from"./XCircleIcon-CL455mkE.js";import{F as ge}from"./ExclamationTriangleIcon-HFSGj02l.js";import{F as aa}from"./MagnifyingGlassIcon-3iEQK3t9.js";import{F as ta}from"./AdjustmentsHorizontalIcon-COakoueI.js";import{C as ra}from"./CircularProgress-BwEl_KoI.js";import{F as sa}from"./PlusIcon-Br-Pwcea.js";import{F as oa}from"./DocumentArrowDownIcon-DfH1hkuO.js";import{F as la}from"./PresentationChartLineIcon-BAGthj_h.js";import{b as na}from"./chunk-57V4RE7B-DgOfB7fU.js";import{s as H,l as M}from"./chunk-2GIFKCNQ-CKxsxfH_.js";import"./app-CENRN2EE.js";import"./chunk-D5XJWRAV-Pu0ZQtUj.js";import"./PencilIcon-DOSt_r-h.js";import"./TrashIcon-BQQx4WSz.js";import"./EllipsisVerticalIcon-CVToEg8h.js";import"./XCircleIcon-CdVU4Q71.js";import"./CardContent-Bri4IZ89.js";import"./colorManipulator-BEWUaNJ4.js";import"./chunk-F3UDT23P-CooYFdyi.js";import"./chunk-MZRCPRP2-CzxHrHBy.js";import"./LiveAnnouncer-BI-RabLr.js";import"./useHasTabbableChild-B2i-T3fu.js";import"./chunk-7F3ZLNJ6-Bl27Usxl.js";import"./chunk-7ZZXWEXF-CVqD9ePZ.js";import"./chunk-R6AK6OQ4-BYGmJlq3.js";import"./chunk-O5I3QTYU-CkARt-O3.js";import"./index-CokAva9Y.js";import"./Clear-DHinSSP4.js";import"./GlassDialog-CbKjxt3k.js";import"./Dialog-CeKaGiC2.js";import"./DialogTitle-NYJIUl_O.js";import"./DialogContent-BethLIN6.js";import"./InputLabel-D97QvwLg.js";import"./Select-dCmhexlw.js";import"./Popover-BWInbS9g.js";import"./List-BwpKOVAh.js";import"./MenuItem-DWIK-tUR.js";import"./listItemTextClasses-D6b6on-R.js";import"./dividerClasses-4vJzVDP3.js";import"./TextField-Bik31g1t.js";import"./Avatar-B-I6EeB3.js";import"./useSlot-DlIWNXKJ.js";import"./LoadingButton-zPDyUtPP.js";import"./Button-C0CH6LkG.js";import"./DialogContentText-DCiTsU7t.js";import"./chunk-2PG5BJX6-B6C1yTx0.js";const ia=({title:G,allUsers:v})=>{var ae,te,re,se,oe;const{auth:x}=Ye().props,J=Ge(),E=le(J.breakpoints.down("sm"));le(J.breakpoints.down("md"));const[he,Q]=o.useState(!1),[_,j]=o.useState([]),[d,p]=o.useState(),[P,f]=o.useState(0),[ve,y]=o.useState(0),[B,X]=o.useState(),[Z,k]=o.useState(""),[U,fe]=o.useState([]),[n,$]=o.useState({perPage:30,currentPage:1}),[ca,b]=o.useState(!1),[z,ye]=o.useState(!1),[a,be]=o.useState({employee:"",selectedMonth:ue().format("YYYY-MM"),status:[],leaveType:[],department:[]}),g=o.useCallback((e,s)=>{if(e==="year"){const t=Number(s);if(t<1900||t>new Date().getFullYear()){console.warn("Invalid year selected. Must be between 1900 and current year.");return}}be(t=>({...t,[e]:s})),$(t=>({...t,currentPage:1}))},[]),[L,we]=o.useState({pending:0,approved:0,rejected:0,total:0}),F=((ae=x.permissions)==null?void 0:ae.includes("leaves.view"))||!1,T=((te=x.permissions)==null?void 0:te.includes("leaves.approve"))||!1,Pe=((re=x.permissions)==null?void 0:re.includes("leaves.create"))||!1,Ce=((se=x.permissions)==null?void 0:se.includes("leaves.update"))||!1,Se=((oe=x.permissions)==null?void 0:oe.includes("leaves.delete"))||!1,Ae=o.useMemo(()=>{const e=[{key:"all",label:"All Types",value:"all"}];if(!_.leaveTypes)return e;const s=_.leaveTypes.map(t=>({key:t.type.toLowerCase(),label:t.type,value:t.type.toLowerCase()}));return[...e,...s]},[_.leaveTypes]),Ne=o.useCallback(e=>{Y(s=>({...s,[e]:!0}))},[]),Me=o.useCallback((e,s)=>{X({id:e}),Y(t=>({...t,[s]:!0}))},[]);o.useCallback(e=>{g("employee",e.target.value.toLowerCase())},[g]);const K=o.useCallback(e=>{g("selectedMonth",e.target.value)},[g]),xe=o.useCallback(e=>{$(s=>({...s,currentPage:e}))},[]),_e=o.useCallback(e=>{$(s=>({...s,perPage:e,currentPage:1}))},[]),h=o.useCallback(async()=>{var e,s,t,l,c;Q(!0);try{const u=await R.get(route("leaves.paginate"),{params:{page:n.currentPage,perPage:n.perPage,employee:a.employee,month:a.selectedMonth,status:Array.isArray(a.status)&&a.status.length>0?a.status:void 0,leave_type:Array.isArray(a.leaveType)&&a.leaveType.length>0?a.leaveType:void 0,department:Array.isArray(a.department)&&a.department.length>0?a.department:void 0,admin_view:!0,view_all:!0}});if(u.status===200){const{leaves:m,leavesData:$e,departments:ze}=u.data;m!=null&&m.data&&Array.isArray(m.data)?(p(m.data),f(m.total||m.data.length),y(m.last_page||1)):Array.isArray(m)?(p(m),f(m.length),y(1)):(console.error("Unexpected leaves data format:",m),p([]),f(0),y(1)),j($e),fe(ze||[]),k("")}}catch(u){if(console.error("Error fetching leaves data:",u.response),((e=u.response)==null?void 0:e.status)===404){const{leavesData:m}=u.response.data||{};j(m||[]),k(((t=(s=u.response)==null?void 0:s.data)==null?void 0:t.message)||"No leaves found for the selected criteria.")}else k(((c=(l=u.response)==null?void 0:l.data)==null?void 0:c.message)||"Error retrieving leaves data. Please try again.");p([]),f(0),y(1)}finally{Q(!1)}},[a,n.currentPage,n.perPage]),D=o.useCallback(async()=>{var e,s,t;try{const l=await R.get(route("leaves.stats"),{params:{month:a.selectedMonth,admin_view:!0,view_all:!0}});if(l.status===200){const{stats:c}=l.data;we(c)}}catch(l){console.error("Error fetching leaves data:",l.response),((e=l.response)==null?void 0:e.status)===404?k(((t=(s=l.response)==null?void 0:s.data)==null?void 0:t.message)||"No leaves found for the selected criteria."):k("Error retrieving leaves data. Please try again."),Q(!1)}},[a]),ke=o.useCallback(async e=>{if(T)try{(await R.post(route("leaves.bulk-approve"),{leave_ids:e})).status===200&&(h(),S.success("Selected leaves approved successfully"))}catch(s){console.error("Error bulk approving leaves:",s),S.error("Failed to approve selected leaves")}},[T,h]),Le=o.useCallback(async e=>{if(T)try{(await R.post(route("leaves.bulk-reject"),{leave_ids:e})).status===200&&(h(),S.success("Selected leaves rejected successfully"))}catch(s){console.error("Error bulk rejecting leaves:",s),S.error("Failed to reject selected leaves")}},[T,h]),Fe=o.useMemo(()=>[{title:"Pending",value:L.pending,icon:r(Qe,{}),color:"text-orange-400",iconBg:"bg-orange-500/20",description:"Awaiting approval"},{title:"Approved",value:L.approved,icon:r(Ue,{}),color:"text-green-400",iconBg:"bg-green-500/20",description:"Successfully approved"},{title:"Rejected",value:L.rejected,icon:r(ea,{}),color:"text-red-400",iconBg:"bg-red-500/20",description:"Declined requests"},{title:"Total",value:L.total,icon:r(ne,{}),color:"text-blue-400",iconBg:"bg-blue-500/20",description:"All leave requests"}],[L]);if(!F)return r(ce,{sx:{display:"flex",justifyContent:"center",p:2},children:r(ie,{children:i(I,{className:"p-8 text-center",children:[r(ge,{className:"w-16 h-16 text-warning-500 mx-auto mb-4"}),r(w,{variant:"h6",className:"mb-2",children:"Access Denied"}),r(w,{variant:"body2",color:"textSecondary",children:"You don't have permission to view leave management."})]})})});const[A,Y]=o.useState({add_leave:!1,edit_leave:!1,delete_leave:!1}),Te=o.useRef(null),De=o.useCallback(e=>{Y(s=>({...s,[e]:!0}))},[]),V=o.useCallback(e=>{Y(s=>({...s,[e]:!1}))},[]),N=o.useCallback(e=>[...e].sort((s,t)=>new Date(t.from_date)-new Date(s.from_date)),[]),O=o.useCallback((e,s=null)=>{f(e);const t=Math.max(1,Math.ceil(e/n.perPage));y(t),n.currentPage>t&&$(l=>({...l,currentPage:t}))},[n.perPage,n.currentPage]),C=o.useCallback(e=>{const s=ue(e.from_date).format("YYYY-MM");if(a.selectedMonth&&s!==a.selectedMonth)return!1;if(a.employee){const t=v==null?void 0:v.find(c=>String(c.id)===String(e.user_id)),l=a.employee.trim().toLowerCase();if(t){if(String(t.id)!==l&&!(t.name&&t.name.trim().toLowerCase().includes(l)))return!1}else if(String(a.employee)!==String(e.user_id))return!1}if(Array.isArray(a.status)&&a.status.length>0&&!a.status.some(l=>String(e.status).toLowerCase()===String(l).toLowerCase())||Array.isArray(a.leaveType)&&a.leaveType.length>0&&!a.leaveType.some(l=>String(e.leave_type).toLowerCase()===String(l).toLowerCase()))return!1;if(Array.isArray(a.department)&&a.department.length>0){const t=v==null?void 0:v.find(c=>String(c.id)===String(e.user_id));if(!t||!a.department.some(c=>String(t.department_id)===String(c)))return!1}return!0},[a,v]),Re=o.useMemo(()=>d||[],[d]),Ee=o.useCallback(e=>{C(e)&&(b(!0),p(s=>{const t=[...s,e];return N(t).slice(0,n.perPage)}),O(P+1),b(!1),n.currentPage!==1&&h())},[C,N,n.currentPage,n.perPage,P,O,h]),je=o.useCallback(e=>{const s=d.some(t=>t.id===e.id);if(b(!0),!C(e)&&s){p(t=>t.filter(l=>l.id!==e.id)),S.info("Leave removed from filtered view."),b(!1);return}if(!s&&!C(e)){b(!1);return}p(t=>{const l=t.some(u=>u.id===e.id);let c;return l?c=t.map(u=>u.id===e.id?e:u):c=[...t,e],N(c).slice(0,n.perPage)}),S.success("Leave updated!"),b(!1),n.currentPage!==1&&h()},[C,N,d,n.currentPage,n.perPage,h]),ee=o.useCallback(async()=>{if(d&&d.length<n.perPage&&P>d.length){const e=Math.min(n.perPage-d.length,P-d.length);if(e<=0)return;b(!0);try{const s=await R.get(route("leaves.paginate"),{params:{page:n.currentPage+1,perPage:e,employee:a.employee,month:a.selectedMonth,status:Array.isArray(a.status)&&a.status.length>0?a.status:void 0,leave_type:Array.isArray(a.leaveType)&&a.leaveType.length>0?a.leaveType:void 0,department:Array.isArray(a.department)&&a.department.length>0?a.department:void 0,admin_view:!0,view_all:!0}});s.status===200&&s.data.leaves.data&&p(t=>{const l=s.data.leaves.data.filter(C),c=[...t,...l];return N(c)})}catch(s){S.error("Error fetching additional items."),console.error(`Error fetching additional items from page ${n.currentPage+1}:`,s)}finally{b(!1)}}},[n.currentPage,n.perPage,d,a,N,C]),Be=o.useCallback(e=>{d.some(t=>t.id===e)&&(p(t=>t.filter(l=>l.id!==e)),O(P-1),ee())},[d,P,O,ee]);return o.useEffect(()=>{F&&h()},[h,F,n.currentPage,a.employee,a.selectedMonth,a.status,a.leaveType,a.department]),o.useEffect(()=>{F&&D()},[h,F]),i(qe,{children:[r(Oe,{title:G}),A.add_leave&&r(pe,{open:A.add_leave,closeModal:()=>V("add_leave"),leavesData:_,setLeavesData:j,currentLeave:null,allUsers:v,setTotalRows:f,setLastPage:y,setLeaves:p,handleMonthChange:K,employee:a.employee,selectedMonth:a.selectedMonth,addLeaveOptimized:Ee,fetchLeavesStats:D}),A.edit_leave&&r(pe,{open:A.edit_leave,closeModal:()=>V("edit_leave"),leavesData:_,setLeavesData:j,currentLeave:B,allUsers:v,setTotalRows:f,setLastPage:y,setLeaves:p,handleMonthChange:K,employee:a.employee,selectedMonth:a.selectedMonth,updateLeaveOptimized:je,fetchLeavesStats:D}),A.delete_leave&&r(Xe,{open:A.delete_leave,closeModal:()=>V("delete_leave"),leaveId:B==null?void 0:B.id,setLeaves:p,setTotalRows:f,setLastPage:y,deleteLeaveOptimized:Be,fetchLeavesStats:D}),r(ce,{sx:{display:"flex",justifyContent:"center",p:2},children:r(Ke,{in:!0,children:r(ie,{children:r(He,{title:"Leave Management",subtitle:"Manage employee leave requests and approvals",icon:r(la,{className:"w-8 h-8"}),variant:"gradient",actionButtons:[...Pe?[{label:"Add Leave",icon:r(sa,{className:"w-4 h-4"}),onPress:()=>De("add_leave"),className:"bg-gradient-to-r from-[var(--theme-primary)] to-[var(--theme-secondary)] text-white font-medium hover:opacity-90"}]:[],{label:"Export",icon:r(oa,{className:"w-4 h-4"}),variant:"bordered",className:"border-[rgba(var(--theme-primary-rgb),0.3)] bg-[rgba(var(--theme-primary-rgb),0.05)] hover:bg-[rgba(var(--theme-primary-rgb),0.1)]"}],children:i("div",{className:"p-6",children:[r(Je,{stats:Fe}),i("div",{className:"flex flex-col sm:flex-row gap-4 mb-6",children:[r("div",{className:"flex-1",children:r(de,{label:"Search Employee",variant:"bordered",placeholder:"Search by name or ID...",value:a.employee,onValueChange:e=>g("employee",e),startContent:r(aa,{className:"w-4 h-4"}),classNames:{input:"bg-transparent",inputWrapper:"bg-white/10 backdrop-blur-md border-white/20 hover:bg-white/15"},size:E?"sm":"md"})}),r("div",{className:"flex gap-2 items-end",children:r(na,{variant:"bordered",className:"bg-white/5",children:i(Ie,{isIconOnly:E,color:z?"primary":"default",onPress:()=>ye(!z),className:z?"bg-purple-500/20":"bg-white/5",children:[r(ta,{className:"w-4 h-4"}),!E&&r("span",{className:"ml-1",children:"Filters"})]})})})]}),z&&r(Ve,{in:!0,timeout:300,children:i("div",{className:"mb-6 p-4 bg-white/5 backdrop-blur-md rounded-lg border border-white/10",children:[i("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:[i(H,{label:"Leave Status",selectionMode:"multiple",variant:"bordered",selectedKeys:a.status,onSelectionChange:e=>g("status",Array.from(e)),classNames:{trigger:"bg-white/10 backdrop-blur-md border-white/20 hover:bg-white/15"},children:[r(M,{value:"pending",children:"Pending"},"pending"),r(M,{value:"approved",children:"Approved"},"approved"),r(M,{value:"rejected",children:"Rejected"},"rejected"),r(M,{value:"new",children:"New"},"new")]}),r(H,{label:"Leave Type",variant:"bordered",selectionMode:"multiple",selectedKeys:a.leaveType,onSelectionChange:e=>g("leaveType",Array.from(e)),classNames:{trigger:"bg-white/10 backdrop-blur-md border-white/20 hover:bg-white/15"},children:Ae.map(e=>r(M,{value:e.value,children:e.label},e.key))}),r(H,{label:"Department",variant:"bordered",selectionMode:"multiple",selectedKeys:a.department,onSelectionChange:e=>g("department",Array.from(e)),classNames:{trigger:"bg-white/10 backdrop-blur-md border-white/20 hover:bg-white/15"},children:U.map(e=>r(M,{value:e.id,children:e.name},e.id))}),r(de,{label:"Month/Year",type:"month",value:a.selectedMonth,onChange:K,startContent:r(me,{className:"w-4 h-4"}),variant:"bordered",classNames:{inputWrapper:"bg-white/10 backdrop-blur-md border-white/20 hover:bg-white/15"},size:E?"sm":"md"})]}),(a.employee||Array.isArray(a.status)&&a.status.length>0||Array.isArray(a.leaveType)&&a.leaveType.length>0||Array.isArray(a.department)&&a.department.length>0)&&i("div",{className:"flex flex-wrap gap-2 mt-4 pt-4 border-t border-white/10",children:[a.employee&&i(q,{variant:"flat",color:"primary",size:"sm",onClose:()=>g("employee",""),children:["Employee: ",a.employee]}),Array.isArray(a.status)&&a.status.map(e=>i(q,{variant:"flat",color:"secondary",size:"sm",onClose:()=>g("status",a.status.filter(s=>s!==e)),children:["Status: ",e]},e)),Array.isArray(a.leaveType)&&a.leaveType.map(e=>i(q,{variant:"flat",color:"warning",size:"sm",onClose:()=>g("leaveType",a.leaveType.filter(s=>s!==e)),children:["Type: ",e]},e)),Array.isArray(a.department)&&a.department.map(e=>{const s=U.find(t=>String(t.id)===String(e));return i(q,{variant:"flat",color:"success",size:"sm",onClose:()=>g("department",a.department.filter(t=>t!==e)),children:["Department: ",(s==null?void 0:s.name)||`ID: ${e}`]},e)})]})]})}),i("div",{className:"min-h-96",children:[i(w,{variant:"h6",className:"mb-4 flex items-center gap-2",children:[r(ne,{className:"w-5 h-5"}),"Leave Requests Management"]}),he?r(W,{className:"bg-white/10 backdrop-blur-md border-white/20",children:i(I,{className:"text-center py-12",children:[r(ra,{size:40}),r(w,{className:"mt-4",color:"textSecondary",children:"Loading leave data..."})]})}):d&&d.length>0?r("div",{className:"overflow-hidden rounded-lg",children:r(Ze,{ref:Te,totalRows:P,lastPage:ve,setCurrentPage:xe,setPerPage:_e,perPage:n.perPage,currentPage:n.currentPage,handleClickOpen:Me,setCurrentLeave:X,openModal:Ne,leaves:Re,allUsers:v,setLeaves:p,employee:a.employee,selectedMonth:a.selectedMonth,isAdminView:!0,onBulkApprove:ke,onBulkReject:Le,canApproveLeaves:T,canEditLeaves:Ce,canDeleteLeaves:Se,fetchLeavesStats:D})}):Z?r(W,{className:"bg-white/10 backdrop-blur-md border-white/20",children:i(I,{className:"text-center py-12",children:[r(ge,{className:"w-16 h-16 text-warning-500 mx-auto mb-4"}),r(w,{variant:"h6",className:"mb-2",children:"No Data Found"}),r(w,{color:"textSecondary",children:Z})]})}):r(W,{className:"bg-white/10 backdrop-blur-md border-white/20",children:i(I,{className:"text-center py-12",children:[r(me,{className:"w-16 h-16 text-default-400 mx-auto mb-4"}),r(w,{variant:"h6",className:"mb-2",children:"No Leave Records Found"}),r(w,{color:"textSecondary",children:"No leave records found for the selected criteria."})]})})]})]})})})})})]})};ia.layout=G=>r(We,{children:G});export{ia as default};
