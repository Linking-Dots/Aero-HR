import{v as ge,w as fe,J as le,r as a,b as o,j as e,F as j,Q as be}from"./app-BcmgNF0y.js";import{ay as ye,az as ve,u as ie,T as xe,I as Ce,f as m,Q as L,B as ne,n as de,G as Se,e as Pe,i as ee,A as De}from"./App-n7nN2ISI.js";import{C as _e}from"./Clear-Dt9ziiz3.js";import{G as ce}from"./GlassDialog-Cyqucp6s.js";import{D as ue}from"./DialogTitle-O1kA4poy.js";import{I as te}from"./InputLabel-CBH9I2AA.js";import{S as ae}from"./Select-Ctbfs3z7.js";import{M as U}from"./MenuItem-Dfzpa8iu.js";import{F as re,T as W}from"./TextField-D6XLYh9C.js";import{A as ke}from"./Avatar-DaRPXre4.js";import{b as pe,c as me}from"./DialogContent-DKiN3tZb.js";import{L as Te}from"./LoadingButton-Df1lRplx.js";import{C as he}from"./CircularProgress-CbI9q9-Q.js";import{D as we}from"./DialogContentText-CCpfaH9U.js";import{B as X}from"./Button-CSU9JmaR.js";import{d as Ie}from"./dayjs.min-CUgcbVFT.js";import{C as Fe}from"./CardHeader-BECeIX3r.js";import{A as Re}from"./Add-B_Hx5R7u.js";import{C as se}from"./CardContent-DW-4atRp.js";import{t as Be,a as Ee,b as Me,c as Ae,d as We,e as qe}from"./chunk-F3UDT23P-B95P-WTm.js";import{p as je}from"./chunk-O5I3QTYU-D4iSu0fv.js";import"./app-CA3O2NZp.js";import"./Popover-CT5iVJTH.js";import"./List-CbVyooDd.js";import"./listItemTextClasses-BMndB1IC.js";import"./dividerClasses-hlmcFD_x.js";import"./useSlot-HkoI0zIO.js";import"./chunk-MZRCPRP2-DPVm9c79.js";import"./LiveAnnouncer-CLFakR0q.js";import"./useHasTabbableChild-BeACiGdW.js";import"./chunk-7F3ZLNJ6-C0BxFFvh.js";import"./index-CokAva9Y.js";var q={},oe;function Ge(){if(oe)return q;oe=1;var y=ye();Object.defineProperty(q,"__esModule",{value:!0}),q.default=void 0;var c=y(ve()),u=ge();return q.default=(0,c.default)((0,u.jsx)("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"}),"Search"),q}var Ue=Ge();const Ye=fe(Ue),He=({open:y,closeModal:c,leavesData:u,setLeavesData:F,currentLeave:t,allUsers:x,setTotalRows:R,setLastPage:h,setLeaves:B,handleMonthChange:g,employee:Y})=>{const{auth:E}=le().props,l=ie(),[C,H]=a.useState((t==null?void 0:t.user_id)||E.user.id),[f,D]=a.useState(u.leaveTypes||[]),[_,k]=a.useState(u.leaveCounts||[]),[S,M]=a.useState((t==null?void 0:t.leave_type)||(f.length>0?f[0].type:"")),[T,w]=a.useState((t==null?void 0:t.from_date)||""),[A,N]=a.useState((t==null?void 0:t.to_date)||""),[O,Z]=a.useState((t==null?void 0:t.no_of_days)||""),[Q,z]=a.useState(""),[G,J]=a.useState((t==null?void 0:t.reason)||""),[i,K]=a.useState({}),[s,b]=a.useState(!1),[I,V]=a.useState("");return a.useEffect(()=>{u&&(D(u.leaveTypes||[]),k(u.leaveCountsByUser[C]||[]))},[u,C]),a.useEffect(()=>{var p;const r=((p=_==null?void 0:_.find(d=>d.leave_type===S))==null?void 0:p.days_used)||0;V(r);const P=f==null?void 0:f.find(d=>d.type===S);P&&z(P.days-r)},[S,_,f]),a.useEffect(()=>{Z(((P,p)=>{if(!P||!p)return"";const d=new Date(P),n=new Date(p);if(d>n)return"";const v=n.getTime()-d.getTime();return Math.ceil(v/(1e3*3600*24))+1})(T,A))},[T,A]),o(ce,{open:y,onClose:c,fullWidth:!0,maxWidth:"sm",children:[o(ue,{sx:{display:"flex",alignItems:"center"},children:[e(xe,{variant:"h6",children:"Add Leave"}),e(Ce,{onClick:c,sx:{position:"absolute",top:8,right:16},children:e(_e,{})})]}),o("form",{onSubmit:async r=>{r.preventDefault(),b(!0);const P=new Promise(async(p,d)=>{try{const n={route:route().current(),user_id:C,leaveType:S,fromDate:T,toDate:A,daysCount:O,leaveReason:G,employee:Y};t&&(n.id=t.id);const v=await axios.post(route("leave-add"),n);v.status===200&&(F(v.data.leavesData),R(v.data.leavesData.leaveRecords.total),h(v.data.leavesData.leaveRecords.last_page),B(v.data.leavesData.leaveRecords.data),g({target:{value:T.slice(0,7)}}),c(),p([v.data.message||"Leave application submitted successfully"]))}catch(n){console.error(n),b(!1),n.response?(n.response.status===422?(K(n.response.data.errors||{}),d(n.response.data.error||"Failed to submit leave application")):d("An unexpected error occurred. Please try again later."),console.error(n.response.data.error)):n.request?(d("No response received from the server. Please check your internet connection."),console.error(n.request)):(d("An error occurred while setting up the request."),console.error("Error",n.message))}finally{b(!1)}});de.promise(P,{pending:{render(){return o("div",{style:{display:"flex",alignItems:"center"},children:[e(he,{}),e("span",{style:{marginLeft:"8px"},children:"Submitting leave application..."})]})},icon:!1,style:{backdropFilter:"blur(16px) saturate(200%)",background:l.glassCard.background,border:l.glassCard.border,color:l.palette.text.primary}},success:{render({data:p}){return e(j,{children:p.map((d,n)=>e("div",{children:d},n))})},icon:"ðŸŸ¢",style:{backdropFilter:"blur(16px) saturate(200%)",background:l.glassCard.background,border:l.glassCard.border,color:l.palette.text.primary}},error:{render({data:p}){return e(j,{children:p})},icon:"ðŸ”´",style:{backdropFilter:"blur(16px) saturate(200%)",background:l.glassCard.background,border:l.glassCard.border,color:l.palette.text.primary}}})},children:[e(pe,{children:o(m,{container:!0,spacing:2,children:[e(m,{item:!0,xs:12,md:6,children:o(L,{fullWidth:!0,children:[e(te,{id:"leave-type-label",children:"Leave Type"}),o(ae,{labelId:"leave-type-label",value:S,onChange:r=>M(r.target.value),label:"Leave Type",error:!!i.leaveType,MenuProps:{PaperProps:{sx:{backdropFilter:"blur(16px) saturate(200%)",background:l.glassCard.background,border:l.glassCard.border,borderRadius:2,boxShadow:l.glassCard.boxShadow}}},children:[e(U,{value:"",disabled:!0,children:"Select Leave Type"}),f.map(r=>o(U,{value:r.type,children:[r.type," ",r.days," Days"]},r.id))]}),e(re,{children:i.leaveType})]})}),e(m,{item:!0,xs:12,md:6,children:e(W,{label:"From",type:"date",fullWidth:!0,value:T,onChange:r=>w(r.target.value),InputLabelProps:{shrink:!0},error:!!i.fromDate,helperText:i.fromDate})}),e(m,{item:!0,xs:12,md:6,children:e(W,{label:"To",type:"date",fullWidth:!0,value:A,onChange:r=>N(r.target.value),InputLabelProps:{shrink:!0},error:!!i.toDate,helperText:i.toDate})}),e(m,{item:!0,xs:12,md:6,children:e(W,{label:"Number of days",type:"text",fullWidth:!0,value:O,InputProps:{readOnly:!0},error:!!i.daysCount,helperText:i.daysCount})}),e(m,{item:!0,xs:12,md:6,children:e(W,{label:"Remaining Leaves",type:"text",fullWidth:!0,value:Q,InputProps:{readOnly:!0},error:!!i.remainingLeaves,helperText:i.remainingLeaves})}),E.roles.includes("Administrator")&&route().current()==="leaves"&&e(m,{item:!0,xs:12,md:6,children:o(L,{fullWidth:!0,children:[e(te,{id:"leave-employee-label",children:"Employee"}),o(ae,{variant:"outlined",fullWidth:!0,labelId:"leave-employee-label",value:C||"na",error:!!i.user_id,onChange:r=>H(r.target.value),label:"Employee",MenuProps:{PaperProps:{sx:{backdropFilter:"blur(16px) saturate(200%)",background:l.glassCard.background,border:l.glassCard.border,borderRadius:2,boxShadow:l.glassCard.boxShadow}}},children:[e(U,{value:"na",disabled:!0,children:"Please select"}),x.map(r=>e(U,{value:r.id,children:o(ne,{sx:{display:"flex"},children:[e(ke,{src:r.profile_image,alt:r.name||"Not assigned",sx:{borderRadius:"50%",width:23,height:23,display:"flex",mr:1}}),r.name]})},r.id))]}),e(re,{children:i.user_id})]})}),e(m,{item:!0,xs:12,children:e(W,{label:"Leave Reason",multiline:!0,rows:4,fullWidth:!0,value:G,onChange:r=>J(r.target.value),error:!!i.leaveReason,helperText:i.leaveReason})})]})}),e(me,{sx:{padding:"16px",justifyContent:"center"},children:e(Te,{type:"submit",variant:"outlined",color:"primary",loading:s,disabled:s,sx:{borderRadius:"50px"},children:"Submit"})})]})]})},Ne=({open:y,handleClose:c,leaveIdToDelete:u,setLeavesData:F})=>{const t=ie();return o(ce,{open:y,onClose:c,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e(ue,{id:"alert-dialog-title",children:"Confirm Deletion"}),e(pe,{children:e(we,{id:"alert-dialog-description",children:"Are you sure you want to delete this leave? This action cannot be undone."})}),o(me,{children:[e(X,{onClick:c,color:"primary",children:"Cancel"}),e(X,{onClick:()=>{const R=new Promise(async(h,B)=>{try{const g=await axios.delete(route("leave-delete",{id:u,route:route().current()}));g.status===200&&(F(g.data.leavesData),h("Leave application deleted successfully"))}catch(g){console.error("Error deleting task:",g),B(g.response.data.error||"Failed to delete leave application")}finally{c()}});de.promise(R,{pending:{render(){return o("div",{style:{display:"flex",alignItems:"center"},children:[e(he,{}),e("span",{style:{marginLeft:"8px"},children:"Deleting leave application..."})]})},icon:!1,style:{backdropFilter:"blur(16px) saturate(200%)",background:t.glassCard.background,border:t.glassCard.border,color:t.palette.text.primary}},success:{render({data:h}){return e(j,{children:h})},icon:"ðŸŸ¢",style:{backdropFilter:"blur(16px) saturate(200%)",background:t.glassCard.background,border:t.glassCard.border,color:t.palette.text.primary}},error:{render({data:h}){return e(j,{children:h})},icon:"ðŸ”´",style:{backdropFilter:"blur(16px) saturate(200%)",background:t.glassCard.background,border:t.glassCard.border,color:t.palette.text.primary}}})},color:"error",autoFocus:!0,children:"Delete"})]})]})},Oe=({title:y,allUsers:c})=>{const{auth:u,props:F}=le(),[t,x]=a.useState(null),[R,h]=a.useState(F.leavesData),[B,g]=a.useState(),[Y,E]=a.useState(0),[l,C]=a.useState(0),[H,f]=a.useState(null),[D,_]=a.useState(""),[k,S]=a.useState(Ie().format("YYYY-MM")),[M,T]=a.useState(30),[w,A]=a.useState(1),[N,O]=a.useState(),[Z,Q]=a.useState(""),z=s=>x(s);a.useCallback((s,b)=>{f(s),x(b)},[]);const G=a.useCallback(()=>{x(null),f(null)},[]),J=s=>_(s.target.value.toLowerCase()),i=s=>{S(s.target.value)},K=async()=>{var s,b;try{const I=await axios.get(route("leaves.paginate"),{params:{page:w,perPage:M,employee:D,month:k}});if(I.status===200){const{data:V,total:$,last_page:r}=I.data.leaves;g(V),E($),C(r)}}catch(I){console.error("Error fetching leaves data:",I),Q(((b=(s=I.response)==null?void 0:s.data)==null?void 0:b.message)||"Error retrieving data.")}};return a.useEffect(()=>{K()},[k,w,M,D]),o(j,{children:[e(be,{title:y}),["add_leave","edit_leave"].includes(t)&&e(He,{setTotalRows:E,setLastPage:C,setPicnicParticipants:g,perPage:M,employee:D,currentPage:w,selectedMonth:k,allUsers:c,open:!0,setPicnicParticipantsData:h,closeModal:()=>x(null),leavesData:R,currentPicnicParticipant:t==="edit_leave"?N:null,handleMonthChange:i}),t==="delete_leave"&&e(Ne,{open:!0,handleClose:G,leaveIdToDelete:H,setPicnicParticipantsData:h}),e(ne,{sx:{display:"flex",justifyContent:"center",p:2},children:e(Se,{in:!0,children:o(Pe,{children:[e(Fe,{title:"Picnic Participants",sx:{padding:"24px"},action:e(X,{title:"Add Picnic Participant",variant:"outlined",color:"success",startIcon:e(Re,{}),onClick:()=>z("add_leave"),children:"Add Picnic Participant"})}),e(se,{children:o(m,{container:!0,spacing:2,children:[e(m,{item:!0,xs:12,sm:6,md:4,children:e(ee,{label:"Search",fullWidth:!0,variant:"bordered",placeholder:"Employee...",value:D,onChange:J,endContent:e(Ye,{})})}),e(m,{item:!0,xs:12,sm:6,md:4,children:e(ee,{label:"Select Month",type:"month",variant:"bordered",onChange:i,value:k})})]})}),e(se,{children:o("div",{style:{maxHeight:"84vh",overflowY:"auto"},children:[o(Be,{isStriped:!0,selectionMode:"multiple",selectionBehavior:"toggle",isCompact:!0,isHeaderSticky:!0,removeWrapper:!0,"aria-label":"Picnic Participant Employee Table",children:[e(Ee,{columns,children:s=>e(Me,{align:s.uid==="actions"?"center":"start",children:s.name},s.uid)}),e(Ae,{items:B,children:s=>e(We,{children:b=>e(qe,{style:{whiteSpace:"nowrap"},children:renderCell(s,b)})},s.id)})]}),Y>10&&e("div",{className:"py-2 px-2 flex justify-center items-end",style:{height:"100%"},children:e(je,{initialPage:1,isCompact:!0,showControls:!0,showShadow:!0,color:"primary",variant:"bordered",page:w,total:l,onChange:handlePageChange})})]})})]})})})]})};Oe.layout=y=>e(De,{children:y});export{Oe as default};
