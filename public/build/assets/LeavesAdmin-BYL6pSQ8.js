import{V as de,j as o,a as e,F as N,M as ye}from"./app-BDL2Y3Ac.js";import{u as ce,r as a,w as ue,T as H,c as be,G as f,F as re,k as se,S as oe,M as q,$ as le,b as G,B as ee,a0 as fe,y as pe,z as me,h as te,a1 as ve,f as ae,e as xe,g as Ce,a as ne}from"./vendor-DhsbrqqY.js";import{d as Se}from"./Search-B0fLnhl1.js";import{B as he,G as De,A as ke}from"./App-BAl9-fyJ.js";import{L as Te}from"./LeaveEmployeeTable-PVH58uxZ.js";import{d as we,G as ge}from"./GlassDialog-DOpUH0ai.js";import{L as Pe}from"./LoadingButton-CMJFg4Jg.js";import{d as _e}from"./dayjs.min-BnBCbp-R.js";import{A as Fe}from"./Add-NKU7InPC.js";import{i as ie}from"./chunk-HJTJQZF3-KpnUfdqE.js";import"./Edit-DLAY4Fx8.js";import"./chunk-F3UDT23P-DUMxki6N.js";import"./chunk-MZRCPRP2-BIsogASO.js";import"./chunk-SLABUSGS-CPDwsMNJ.js";import"./chunk-7F3ZLNJ6-Dd5bsoxT.js";import"./chunk-YHY32LNM-CTtTOVnb.js";import"./chunk-CSXHODZI-DZPtdVvQ.js";import"./chunk-7JXO3E7I-C2bpU273.js";import"./chunk-2BFF5KFD-CY6UALKj.js";import"./chunk-4EXC76WE-BbmWI7ow.js";import"./chunk-R6AK6OQ4-YfMKL-bA.js";import"./chunk-A6PX3NG3-B1_1_emB.js";import"./chunk-M3MASYO7-COGiOE1Q.js";const Ie=({open:P,closeModal:v,leavesData:m,setLeavesData:S,currentLeave:r,allUsers:T,setTotalRows:L,setLastPage:D,setLeaves:d,handleMonthChange:w,employee:W,selectedMonth:h})=>{const{auth:E}=de().props,s=ce(),[k,n]=a.useState((r==null?void 0:r.user_id)||E.user.id),[c,$]=a.useState(m.leaveTypes||[]),[x,z]=a.useState(m.leaveCounts||[]),[g,V]=a.useState((r==null?void 0:r.leave_type)||(c.length>0?c[0].type:"")),_=t=>{const C=new Date(t);return isNaN(C.getTime())?new Date().toISOString().split("T")[0]:C.toISOString().split("T")[0]},[F,J]=a.useState(_(r==null?void 0:r.from_date)),[M,O]=a.useState(_(r==null?void 0:r.to_date)),[A,j]=a.useState((r==null?void 0:r.no_of_days)||""),[K,Q]=a.useState(""),[U,Y]=a.useState((r==null?void 0:r.reason)||""),[i,p]=a.useState({}),[I,y]=a.useState(!1),[R,X]=a.useState("");return a.useEffect(()=>{m&&($(m.leaveTypes||[]),z(m.leaveCountsByUser[k]||[]))},[m,k]),a.useEffect(()=>{var b;const t=((b=x==null?void 0:x.find(u=>u.leave_type===g))==null?void 0:b.days_used)||0;X(t);const C=c==null?void 0:c.find(u=>u.type===g);C&&Q(C.days-t)},[g,x,c]),a.useEffect(()=>{j(((C,b)=>{if(!C||!b)return"";const u=new Date(C),l=new Date(b);if(u>l)return"";const Z=l.getTime()-u.getTime();return Math.ceil(Z/(1e3*3600*24))+1})(F,M))},[F,M]),o(ge,{open:P,onClose:v,fullWidth:!0,maxWidth:"sm",children:[o(ue,{sx:{display:"flex",alignItems:"center"},children:[e(H,{variant:"h6",children:"Add Leave"}),e(be,{onClick:v,sx:{position:"absolute",top:8,right:16},children:e(we,{})})]}),o("form",{onSubmit:async t=>{t.preventDefault(),y(!0);const C=new Promise(async(b,u)=>{try{const l={route:route().current(),user_id:k,leaveType:g,fromDate:F,toDate:M,daysCount:A,leaveReason:U,employee:W,month:h},Z=r?route("leave-update"):route("leave-add");r&&(l.id=r.id);const B=await axios.post(Z,l);B.status===200&&(S(B.data.leavesData),L(B.data.leaves.total),D(B.data.leaves.last_page),d(B.data.leaves.data),w({target:{value:F.slice(0,7)}}),v(),b([B.data.message||"Leave application submitted successfully"]))}catch(l){console.error(l),y(!1),l.response?(l.response.status===422?(p(l.response.data.errors||{}),u(l.response.data.error||"Failed to submit leave application")):u("An unexpected error occurred. Please try again later."),console.error(l.response.data.error)):l.request?(u("No response received from the server. Please check your internet connection."),console.error(l.request)):(u("An error occurred while setting up the request."),console.error("Error",l.message))}finally{y(!1)}});he.promise(C,{pending:{render(){return o("div",{style:{display:"flex",alignItems:"center"},children:[e(te,{}),e("span",{style:{marginLeft:"8px"},children:"Submitting leave application..."})]})},icon:!1,style:{backdropFilter:"blur(16px) saturate(200%)",background:s.glassCard.background,border:s.glassCard.border,color:s.palette.text.primary}},success:{render({data:b}){return e(N,{children:b.map((u,l)=>e("div",{children:u},l))})},icon:"ðŸŸ¢",style:{backdropFilter:"blur(16px) saturate(200%)",background:s.glassCard.background,border:s.glassCard.border,color:s.palette.text.primary}},error:{render({data:b}){return e(N,{children:b})},icon:"ðŸ”´",style:{backdropFilter:"blur(16px) saturate(200%)",background:s.glassCard.background,border:s.glassCard.border,color:s.palette.text.primary}}})},children:[e(pe,{children:o(f,{container:!0,spacing:2,children:[e(f,{item:!0,xs:12,md:6,children:o(re,{fullWidth:!0,children:[e(se,{id:"leave-type-label",children:"Leave Type"}),o(oe,{labelId:"leave-type-label",value:g,onChange:t=>V(t.target.value),label:"Leave Type",error:!!i.leaveType,MenuProps:{PaperProps:{sx:{backdropFilter:"blur(16px) saturate(200%)",background:s.glassCard.background,border:s.glassCard.border,borderRadius:2,boxShadow:s.glassCard.boxShadow}}},children:[e(q,{value:"",disabled:!0,children:"Select Leave Type"}),c.map(t=>o(q,{value:t.type,children:[t.type," ",t.days," Days"]},t.id))]}),e(le,{children:i.leaveType})]})}),e(f,{item:!0,xs:12,md:6,children:e(G,{label:"From",type:"date",fullWidth:!0,value:F,onChange:t=>J(t.target.value),InputLabelProps:{shrink:!0},error:!!i.fromDate,helperText:i.fromDate})}),e(f,{item:!0,xs:12,md:6,children:e(G,{label:"To",type:"date",fullWidth:!0,value:M,onChange:t=>O(t.target.value),InputLabelProps:{shrink:!0},error:!!i.toDate,helperText:i.toDate})}),e(f,{item:!0,xs:12,md:6,children:e(G,{label:"Number of days",type:"text",fullWidth:!0,value:A,InputProps:{readOnly:!0},error:!!i.daysCount,helperText:i.daysCount})}),e(f,{item:!0,xs:12,md:6,children:e(G,{label:"Remaining Leaves",type:"text",fullWidth:!0,value:K,InputProps:{readOnly:!0},error:!!i.remainingLeaves,helperText:i.remainingLeaves})}),E.roles.includes("Administrator")&&route().current()==="leaves"&&e(f,{item:!0,xs:12,md:6,children:o(re,{fullWidth:!0,children:[e(se,{id:"leave-employee-label",children:"Employee"}),o(oe,{variant:"outlined",fullWidth:!0,labelId:"leave-employee-label",value:k||"na",error:!!i.user_id,onChange:t=>n(t.target.value),label:"Employee",MenuProps:{PaperProps:{sx:{backdropFilter:"blur(16px) saturate(200%)",background:s.glassCard.background,border:s.glassCard.border,borderRadius:2,boxShadow:s.glassCard.boxShadow}}},children:[e(q,{value:"na",disabled:!0,children:"Please select"}),T.map(t=>e(q,{value:t.id,children:o(ee,{sx:{display:"flex"},children:[e(fe,{src:t.profile_image,alt:t.name||"Not assigned",sx:{borderRadius:"50%",width:23,height:23,display:"flex",mr:1}}),t.name]})},t.id))]}),e(le,{children:i.user_id})]})}),e(f,{item:!0,xs:12,children:e(G,{label:"Leave Reason",multiline:!0,rows:4,fullWidth:!0,value:U,onChange:t=>Y(t.target.value),error:!!i.leaveReason,helperText:i.leaveReason})})]})}),e(me,{sx:{padding:"16px",justifyContent:"center"},children:e(Pe,{type:"submit",variant:"outlined",color:"primary",loading:I,disabled:I,sx:{borderRadius:"50px"},children:"Submit"})})]})]})},Be=({open:P,handleClose:v,leaveIdToDelete:m,setLeavesData:S,setLeaves:r,setTotalRows:T,setLastPage:L,setError:D})=>{const d=ce();return o(ge,{open:P,onClose:v,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e(ue,{id:"alert-dialog-title",children:"Confirm Deletion"}),e(pe,{children:e(ve,{id:"alert-dialog-description",children:"Are you sure you want to delete this leave? This action cannot be undone."})}),o(me,{children:[e(ae,{onClick:v,color:"primary",children:"Cancel"}),e(ae,{onClick:()=>{const W=new Promise(async(h,E)=>{var s,k;try{const n=await axios.delete(route("leave-delete",{id:m,route:route().current()}));n.status===200&&(S(n.data.leavesData),T(n.data.leaves.total),L(n.data.leaves.last_page),r(n.data.leaves.data),D(!1),h("Leave application deleted successfully"))}catch(n){if(console.error("Error deleting task:",n),n.response.status===404){const{leavesData:c}=n.response.data;S(c),D(((k=(s=n.response)==null?void 0:s.data)==null?void 0:k.message)||"Error retrieving data.")}E(n.response.data.error||"Failed to delete leave application")}finally{v()}});he.promise(W,{pending:{render(){return o("div",{style:{display:"flex",alignItems:"center"},children:[e(te,{}),e("span",{style:{marginLeft:"8px"},children:"Deleting leave application..."})]})},icon:!1,style:{backdropFilter:"blur(16px) saturate(200%)",background:d.glassCard.background,border:d.glassCard.border,color:d.palette.text.primary}},success:{render({data:h}){return e(N,{children:h})},icon:"ðŸŸ¢",style:{backdropFilter:"blur(16px) saturate(200%)",background:d.glassCard.background,border:d.glassCard.border,color:d.palette.text.primary}},error:{render({data:h}){return e(N,{children:h})},icon:"ðŸ”´",style:{backdropFilter:"blur(16px) saturate(200%)",background:d.glassCard.background,border:d.glassCard.border,color:d.palette.text.primary}}})},color:"error",autoFocus:!0,children:"Delete"})]})]})},Ee=({title:P,allUsers:v})=>{de();const[m,S]=a.useState(!1),[r,T]=a.useState(null),[L,D]=a.useState([]),[d,w]=a.useState(),[W,h]=a.useState(0),[E,s]=a.useState(0),[k,n]=a.useState(null),[c,$]=a.useState(""),[x,z]=a.useState(_e().format("YYYY-MM")),[g,V]=a.useState(30),[_,F]=a.useState(1),[J,M]=a.useState(),[O,A]=a.useState(""),j=p=>T(p),K=a.useCallback((p,I)=>{n(p),T(I)},[]),Q=a.useCallback(()=>{T(null),n(null)},[]),U=p=>$(p.target.value.toLowerCase()),Y=p=>{z(p.target.value)},i=async()=>{var p,I;try{const y=await axios.get(route("leaves.paginate"),{params:{page:_,perPage:g,employee:c,month:x}});if(y.status===200){const{leaves:R,leavesData:X}=y.data;w(R.data),D(X),h(R.total),s(R.last_page),A(!1),S(!1)}}catch(y){if(console.error("Error fetching leaves data:",y.response),y.response.status===404){const{leavesData:R}=y.response.data;D(R),A(((I=(p=y.response)==null?void 0:p.data)==null?void 0:I.message)||"Error retrieving data.")}w(!1),S(!1)}};return a.useEffect(()=>{S(!0),i()},[x,_,g,c]),o(N,{children:[e(ye,{title:P}),["add_leave","edit_leave"].includes(r)&&e(Ie,{setTotalRows:h,setLastPage:s,setLeaves:w,perPage:g,employee:c,currentPage:_,selectedMonth:x,allUsers:v,open:!0,setLeavesData:D,closeModal:()=>T(null),leavesData:L,currentLeave:r==="edit_leave"?J:null,handleMonthChange:Y}),r==="delete_leave"&&e(Be,{setTotalRows:h,setLastPage:s,setLeaves:w,perPage:g,open:!0,handleClose:Q,leaveIdToDelete:k,setLeavesData:D,setError:A,setLoading:S}),e(ee,{sx:{display:"flex",justifyContent:"center",p:2},children:e(xe,{in:!0,children:o(De,{children:[e(Ce,{title:"Leaves",sx:{padding:"24px"},action:e(ae,{title:"Add Leave",variant:"outlined",color:"success",startIcon:e(Fe,{}),onClick:()=>j("add_leave"),children:"Add Leave"})}),e(ne,{children:o(f,{container:!0,spacing:2,children:[e(f,{item:!0,xs:12,sm:6,md:4,children:e(ie,{label:"Search",fullWidth:!0,variant:"bordered",placeholder:"Employee...",value:c,onChange:U,endContent:e(Se,{})})}),e(f,{item:!0,xs:12,sm:6,md:4,children:e(ie,{label:"Select Month",type:"month",variant:"bordered",onChange:Y,value:x,isLoading:m})})]})}),e(ne,{children:m?o(ee,{sx:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%"},children:[e(te,{sx:{p:1}}),e(H,{variant:"body1",align:"center",children:"Loading leaves data..."})]}):d&&d.length>0?e(Te,{totalRows:W,lastPage:E,setCurrentPage:F,setPerPage:V,perPage:g,currentPage:_,handleClickOpen:K,setCurrentLeave:M,openModal:j,leaves:d,allUsers:v,setLeaves:w,employee:c,selectedMonth:x}):O?e(H,{variant:"body1",align:"center",children:O}):e(H,{variant:"body1",align:"center",children:"No leaves data found."})})]})})})]})};Ee.layout=P=>e(ke,{children:P});export{Ee as default};
