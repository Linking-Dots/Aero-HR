import{r as o,R as ke,J as Ye,b as r,j as e,f as Le,a as ge,d as Je,F as se}from"./app-_fBEAKGv.js";import{u as ze,B as j,I as ue,T as dt,y as Ke,v as Qe,w as Ze,x as qe,F as de,s as Xe,d as Ne,a as He,c as Te,ah as ct,z as ut,S as pt,k as ae,l as Fe,C as le,ai as mt,O as ht,P as ft}from"./App-D7mnl0rW.js";import{u as ye,B as n,T as d,G as lt,v as et}from"./logo-Doov_oAp.js";import{F as _e}from"./TrashIcon-87edl8fu.js";import{F as tt}from"./PencilIcon-CBHFuzMe.js";import{F as rt}from"./EllipsisVerticalIcon-DyXenDSg.js";import{F as gt}from"./XCircleIcon-C78QXoz9.js";import{F as yt}from"./CheckCircleIcon-BBYS3oJu.js";import{F as bt}from"./ClockIcon-DXiz9gfz.js";import{F as xt}from"./ExclamationTriangleIcon-Cs3Z4zDH.js";import{F as Ue}from"./UserIcon-zPmqLCda.js";import{C as $e}from"./CardContent-Cgmaqpts.js";import{a as ie}from"./colorManipulator-D0SwyKok.js";import{e as he,t as vt,a as wt,b as Ct,c as kt,d as _t}from"./chunk-F3UDT23P-BTULbAsi.js";import{t as at}from"./chunk-7ZZXWEXF-Dd_2ES6i.js";import{u as st}from"./chunk-R6AK6OQ4-BdPXzNvl.js";import{p as nt}from"./chunk-O5I3QTYU-xPbw-PaW.js";import{C as Oe}from"./Clear-CYfXmgbF.js";import{G as We}from"./GlassDialog-3ukC7agG.js";import{D as Ee}from"./DialogTitle-Bgoxt4Wz.js";import{I as Pe,F as Re,T as fe}from"./TextField-DtCy84kv.js";import{S as Ie,M as ce}from"./Select-CovYC41-.js";import{A as it}from"./Avatar-BP97WDXp.js";import{D as Me,a as Be}from"./DialogContent-CN9m-QLp.js";import{L as xe}from"./LoadingButton-C_o6DdHk.js";import{C as ve}from"./CircularProgress-C4tAYJkY.js";import{D as St}from"./DialogContentText-D1W5680b.js";import{B as Ae}from"./Button-D-EfDwIb.js";import{C as je}from"./CardHeader-C0sjRh_R.js";import{F as ot}from"./InformationCircleIcon-CGF2jvuV.js";import{F as Dt}from"./XCircleIcon-D7m7Nibs.js";import{F as Ve}from"./ExclamationTriangleIcon-jnGiZYOV.js";import{F as Ge}from"./CheckCircleIcon-Lv7LzbCy.js";import{L as Nt,a as Tt}from"./ListItemText-CivQVqMk.js";import{D as Ft}from"./Divider-CYpvgi-B.js";import{b as $t}from"./Popover-QXU3_HMD.js";function Pt({title:y,titleId:C,...N},w){return o.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:w,"aria-labelledby":C},N),y?o.createElement("title",{id:C},y):null,o.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 19.5 8.25 12l7.5-7.5"}))}const Rt=o.forwardRef(Pt);function It({title:y,titleId:C,...N},w){return o.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:w,"aria-labelledby":C},N),y?o.createElement("title",{id:C},y):null,o.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12Z"}))}const Wt=o.forwardRef(It),Et=ke.forwardRef(({leaves:y,allUsers:C,handleClickOpen:N,setCurrentLeave:w,openModal:c,setLeaves:k,setCurrentPage:P,currentPage:L,totalRows:u,lastPage:b,perPage:p,selectedMonth:E,employee:T,isAdminView:R=!1,onBulkApprove:x,onBulkReject:F,onBulkDelete:m,canApproveLeaves:_=!1,canEditLeaves:I=!1,canDeleteLeaves:M=!1,fetchLeavesStats:H},Y)=>{var a,h;const{auth:ee}=Ye().props,$=ye(),W=ze("(min-width: 1025px)"),K=ze("(min-width: 641px) and (max-width: 1024px)"),ne=ze("(max-width: 640px)"),[pe,O]=o.useState(!1),[l,v]=o.useState(null),[S,q]=o.useState(new Set);ke.useMemo(()=>Array.from(S).join(", ").replaceAll("_"," "),[S]);const V=ke.useMemo(()=>{const t=S==="all",s=t||S.size>0,i=t?y.length:S.size;return r("div",{className:"flex flex-col gap-4",children:[e("div",{className:"flex justify-between gap-3 items-end",children:e("div",{className:"flex gap-3",children:s&&m&&r(Le,{color:"danger",variant:"flat",startContent:e(_e,{className:"w-4 h-4"}),onPress:()=>{const g=t?y:y.filter(G=>S.has(G.id.toString()));m(g)},children:["Delete ",i," selected"]})})}),s&&r("span",{className:"text-default-400 text-small",children:[i," of ",y.length," selected"]})]})},[S,y,m]);(a=ee.permissions)!=null&&a.includes("leaves.view"),(h=ee.permissions)!=null&&h.includes("leave.own.view");const B={New:{color:"primary",icon:xt,bgColor:ie($.palette.primary.main,.1),textColor:$.palette.primary.main},Pending:{color:"warning",icon:bt,bgColor:ie($.palette.warning.main,.1),textColor:$.palette.warning.main},Approved:{color:"success",icon:yt,bgColor:ie($.palette.success.main,.1),textColor:$.palette.success.main},Declined:{color:"danger",icon:gt,bgColor:ie($.palette.error.main,.1),textColor:$.palette.error.main}},U=t=>{switch(t==null?void 0:t.toLowerCase()){case"casual":return e(ut,{className:"w-3 h-3 text-blue-500"});case"weekend":return e(ct,{className:"w-3 h-3 text-yellow-500"});case"sick":return e(Wt,{className:"w-3 h-3 text-red-500"});case"earned":return e(He,{className:"w-3 h-3 text-green-500"});default:return e(Ne,{className:"w-3 h-3 text-primary"})}},D=o.useCallback(t=>{P&&P(t)},[P]),z=o.useCallback(async(t,s)=>{if(t.status===s)return j.info(`Leave is already ${s}.`),Promise.resolve(`The leave status is already updated to ${s}`);const i=`${t.id}-${s}`;if(l===i)return;v(i);const g=new Promise(async(G,Z)=>{var oe,we,De,be;try{const J=await ge.post(route("leave-update-status"),{id:t.id,status:s});J.status===200?(k(Ce=>Ce.map(X=>X.id===t.id?{...X,status:s}:X)),H(),G(J.data.message||"Leave status updated successfully")):Z(((oe=J.data)==null?void 0:oe.message)||"Failed to update leave status")}catch(J){const Ce=((De=(we=J.response)==null?void 0:we.data)==null?void 0:De.message)||((be=J.response)==null?void 0:be.statusText)||"Failed to update leave status";Z(Ce)}finally{v(null)}});return j.promise(g,{pending:"Updating leave status...",success:"Leave status updated successfully!",error:"Failed to update leave status"}),g},[k,l,H]),Q=t=>{const s=B[t]||B.New,i=s.icon;return e(Te,{size:"sm",variant:"flat",color:s.color,startContent:e(i,{className:"w-3 h-3"}),classNames:{base:"h-6",content:"text-xs font-medium"},children:t})},te=(t,s)=>{const i=new Date(t),g=new Date(s),G=Math.abs(g-i),Z=Math.ceil(G/(1e3*60*60*24))+1;return Z===1?"1 day":`${Z} days`},re=t=>new Date(t).toLocaleDateString("en-US",{day:"numeric",month:"short",year:"numeric"}),A=t=>(C==null?void 0:C.find(s=>String(s.id)===String(t)))||{name:"Unknown User",phone:""},Se=({leave:t,updatingLeave:s,setCurrentLeave:i,openModal:g,handleClickOpen:G,updateLeaveStatus:Z,canEditLeaves:oe,canDeleteLeaves:we,canApproveLeaves:De,isAdminView:be})=>{const J=A(t.user_id),Ce=te(t.from_date,t.to_date);return B[t.status]||B.New,console.log(be?"Admin View":"User View"),e(lt,{className:"mb-2",shadow:"sm",children:r($e,{className:"p-3",children:[r(n,{className:"flex items-start justify-between mb-3",children:[e(n,{className:"flex items-center gap-3 flex-1",children:be&&e(st,{avatarProps:{radius:"lg",size:"sm",src:J==null?void 0:J.profile_image,fallback:e(Ue,{className:"w-4 h-4"})},name:e(d,{variant:"body2",fontWeight:"medium",children:J==null?void 0:J.name}),description:e(d,{variant:"caption",color:"textSecondary",children:J==null?void 0:J.phone})})}),r(n,{className:"flex items-center gap-2",children:[Q(t.status),(oe||we)&&r(Ke,{children:[e(Qe,{children:e(ue,{size:"small",children:e(rt,{className:"w-4 h-4"})})}),r(Ze,{"aria-label":"Leave actions",children:[oe&&e(qe,{startContent:e(tt,{className:"w-4 h-4"}),onPress:()=>{i(t),g("edit_leave")},children:"Edit Leave"},"edit"),we&&e(qe,{className:"text-danger",color:"danger",startContent:e(_e,{className:"w-4 h-4"}),onPress:()=>G(t.id,"delete_leave"),children:"Delete Leave"},"delete")]})]})]})]}),e(Je,{className:"my-3"}),r(pt,{spacing:2,children:[r(n,{className:"flex items-center gap-2",children:[e(Ne,{className:"w-4 h-4 text-primary"}),e(d,{variant:"body2",fontWeight:"medium",children:t.leave_type})]}),r(n,{className:"flex items-center gap-2",children:[e(de,{className:"w-4 h-4 text-default-500"}),r(d,{variant:"body2",color:"textSecondary",children:[re(t.from_date)," - ",re(t.to_date)]}),e(Te,{size:"sm",variant:"bordered",color:"default",children:Ce})]}),t.reason&&r(n,{className:"flex items-start gap-2",children:[e(He,{className:"w-4 h-4 text-default-500 mt-0.5"}),e(d,{variant:"body2",color:"textSecondary",className:"flex-1",children:t.reason})]})]}),be&&De&&r(se,{children:[e(Je,{className:"my-3"}),e(n,{className:"flex gap-2",children:["Approved","Declined"].map(X=>e(Le,{size:"sm",variant:t.status===X?"solid":"bordered",color:B[X].color,isLoading:s===`${t.id}-${X}`,onPress:()=>{s!==`${t.id}-${X}`&&Z(t,X)},startContent:s!==`${t.id}-${X}`?ke.createElement(B[X].icon,{className:"w-3 h-3"}):null,classNames:{base:"flex-1"},children:X},X))})]})]})})},me=o.useCallback((t,s)=>{const i=A(t.user_id);switch(s){case"employee":return e(he,{className:"whitespace-nowrap",children:e(st,{avatarProps:{radius:"lg",size:"sm",src:i==null?void 0:i.profile_image,fallback:e(Ue,{className:"w-4 h-4"})},description:e(d,{variant:"caption",className:"text-xs",children:i==null?void 0:i.phone}),name:e(d,{variant:"body2",className:"text-sm font-medium",children:i==null?void 0:i.name})})});case"leave_type":return e(he,{children:r(n,{className:"flex items-center gap-1",children:[U(t.leave_type),e(d,{variant:"body2",className:"text-sm font-medium capitalize",children:t.leave_type})]})});case"from_date":case"to_date":return e(he,{children:r(n,{className:"flex items-center gap-1",children:[e(de,{className:"w-3 h-3 text-default-500"}),r(n,{children:[e(d,{variant:"body2",className:"text-sm",children:re(t[s])}),s==="from_date"&&e(d,{variant:"caption",className:"text-xs",color:"textSecondary",children:te(t.from_date,t.to_date)})]})]})});case"status":return e(he,{children:r(n,{className:"flex items-center gap-2",children:[Q(t.status),R&&_&&r(Ke,{children:[e(Qe,{children:e(Le,{isIconOnly:!0,size:"sm",variant:"light",isDisabled:l&&l.startsWith(`${t.id}-`),children:e(rt,{className:"w-4 h-4"})})}),e(Ze,{"aria-label":"Status actions",onAction:g=>z(t,g),children:Object.keys(B).map(g=>{const G=B[g],Z=G.icon;return e(qe,{startContent:e(Z,{className:"w-4 h-4"}),color:G.color,children:g},g)})})]})]})});case"reason":return e(he,{children:e(dt,{title:t.reason||"No reason provided",children:e(d,{variant:"caption",className:"max-w-xs truncate cursor-help text-xs",color:"textSecondary",children:t.reason||"No reason provided"})})});case"actions":return e(he,{children:r(n,{className:"flex items-center gap-1",children:[I&&e(at,{content:"Edit Leave",children:e(ue,{size:"small",onClick:()=>{l&&l.startsWith(`${t.id}-`)||(w(t),c("edit_leave"))},sx:{background:ie($.palette.primary.main,.1),"&:hover":{background:ie($.palette.primary.main,.2)}},children:e(tt,{className:"w-4 h-4"})})}),M&&e(at,{content:"Delete Leave",color:"danger",children:e(ue,{size:"small",onClick:()=>{l&&l.startsWith(`${t.id}-`)||(w(t),N(t.id,"delete_leave"))},sx:{background:ie($.palette.error.main,.1),"&:hover":{background:ie($.palette.error.main,.2)}},children:e(_e,{className:"w-4 h-4"})})})]})});default:return e(he,{children:t[s]})}},[R,_,W,l,$,w,c,N,z]),f=[...R?[{name:"Employee",uid:"employee",icon:Ue}]:[],{name:"Leave Type",uid:"leave_type",icon:Ne},{name:"From Date",uid:"from_date",icon:de},{name:"To Date",uid:"to_date",icon:de},{name:"Status",uid:"status",icon:He},{name:"Reason",uid:"reason",icon:Ne},...R?[{name:"Actions",uid:"actions"}]:[]];return ne?r(n,{className:"space-y-4",children:[e(Xe,{className:"max-h-[70vh]",children:y.map(t=>e(Se,{leave:t,updatingLeave:l,setCurrentLeave:w,openModal:c,handleClickOpen:N,updateLeaveStatus:z,canEditLeaves:I,canDeleteLeaves:M,canApproveLeaves:_,isAdminView:R},t.id))}),u>p&&e(n,{className:"flex justify-center pt-4",children:e(nt,{showControls:!0,showShadow:!0,color:"primary",variant:"bordered",page:L,total:b,onChange:D,size:"sm"})})]}):r(n,{sx:{maxHeight:"84vh",overflowY:"auto"},children:[e(Xe,{className:"max-h-[70vh]",children:r(vt,{isStriped:!0,selectionMode:"multiple",selectedKeys:S,onSelectionChange:q,topContent:V,topContentPlacement:"outside",isCompact:!0,isHeaderSticky:!0,removeWrapper:!0,"aria-label":"Leave Management Table",classNames:{wrapper:"min-h-[200px]",table:"min-h-[300px]",thead:"[&>tr]:first:shadow-small bg-default-100/80",tbody:"divide-y divide-default-200/50",tr:"group hover:bg-default-50/50 transition-colors h-12",td:"py-2 px-3 text-sm",th:"py-2 px-3 text-xs font-semibold"},children:[e(wt,{columns:f,children:t=>e(Ct,{align:t.uid==="actions"?"center":"start",className:"bg-default-100/80 backdrop-blur-md",children:r(n,{className:"flex items-center gap-1",children:[t.icon&&e(t.icon,{className:"w-3 h-3"}),e("span",{className:"text-xs font-semibold",children:t.name})]})},t.uid)}),e(kt,{items:y,emptyContent:r(n,{className:"flex flex-col items-center justify-center py-8 text-center",children:[e(de,{className:"w-12 h-12 text-default-300 mb-4"}),e(d,{variant:"h6",color:"textSecondary",children:"No leaves found"}),e(d,{variant:"body2",color:"textSecondary",children:T?`No leaves found for "${T}"`:"No leave requests for the selected period"})]}),children:t=>e(_t,{children:s=>me(t,s)},t.id)})]})}),u>p&&r(n,{className:"py-4 flex justify-center",children:[e(nt,{showControls:!0,showShadow:!0,color:"primary",variant:"bordered",page:L,total:b,onChange:D,size:K?"sm":"md"}),r("div",{className:"ml-4 text-xs text-gray-500",children:["Page ",L," of ",b," (Total: ",u," records)"]})]})]})});Et.displayName="LeaveEmployeeTable";const vr=({open:y,closeModal:C,leavesData:N,setLeavesData:w,currentLeave:c,allUsers:k,setTotalRows:P,setLastPage:L,setLeaves:u,handleMonthChange:b,employee:p,selectedMonth:E,addLeaveOptimized:T,updateLeaveOptimized:R,fetchLeavesStats:x})=>{var me;const{auth:F}=Ye().props,m=ye(),[_,I]=o.useState((c==null?void 0:c.user_id)||F.user.id),[M,H]=o.useState((N==null?void 0:N.leaveTypes)||[]),[Y,ee]=o.useState([]),[$,W]=o.useState((c==null?void 0:c.leave_type)||""),K=f=>{if(!f)return new Date().toISOString().split("T")[0];if(typeof f=="string"&&f.match(/^\d{4}-\d{2}-\d{2}$/))return f;if(typeof f=="string"&&f.includes("T")){if(f.includes("T18:00:00")){const h=f.split("T")[0].split("-"),t=parseInt(h[0]),s=parseInt(h[1]),i=parseInt(h[2])+1;return new Date(t,s-1,i).toISOString().split("T")[0]}return f.split("T")[0]}try{const a=new Date(f);if(isNaN(a.getTime()))return new Date().toISOString().split("T")[0];const h=a.getFullYear(),t=String(a.getMonth()+1).padStart(2,"0"),s=String(a.getDate()).padStart(2,"0");return`${h}-${t}-${s}`}catch(a){return console.error("Error formatting date:",a),new Date().toISOString().split("T")[0]}},[ne,pe]=o.useState(c!=null&&c.from_date?K(c.from_date):""),[O,l]=o.useState(c!=null&&c.to_date?K(c.to_date):""),[v,S]=o.useState((c==null?void 0:c.no_of_days)||""),[q,V]=o.useState(""),[B,U]=o.useState((c==null?void 0:c.reason)||""),[D,z]=o.useState({}),[Q,te]=o.useState(!1),[re,A]=o.useState("");return o.useEffect(()=>{var f,a;if(N){H(N.leaveTypes||[]);const h=((f=N.leaveCountsByUser)==null?void 0:f[_])||[];if(ee(h),M.length>0&&!$&&!c&&W(M[0].type),c&&!$){const t=(a=N.leaveTypes)==null?void 0:a.find(s=>s.id===c.leave_type);t&&W(t.type)}}},[N,_,c]),o.useEffect(()=>{if(!$||!Y||!M)return;const f=Y.find(t=>t.leave_type===$),a=(f==null?void 0:f.days_used)||0;A(a);const h=M.find(t=>t.type===$);if(h){const t=h.days-a;V(t),c&&v>t&&S(t)}},[$,Y,M,c,v]),o.useEffect(()=>{S(((a,h)=>{if(!a||!h)return"";const t=new Date(a),s=new Date(h);if(t>s)return"";const i=s.getTime()-t.getTime();return Math.ceil(i/(1e3*3600*24))+1})(ne,O))},[ne,O]),r(We,{open:y,onClose:C,fullWidth:!0,maxWidth:"sm",children:[r(Ee,{sx:{display:"flex",alignItems:"center"},children:[e(d,{variant:"h6",children:c?"Edit Leave":"Add Leave"}),e(ue,{onClick:C,sx:{position:"absolute",top:8,right:16},children:e(Oe,{})})]}),r("form",{onSubmit:async f=>{f.preventDefault(),te(!0);const a=new Promise(async(h,t)=>{try{const s={route:route().current(),user_id:_,leaveType:$,fromDate:ne,toDate:O,daysCount:v,leaveReason:B,employee:p,month:E},i=c?route("leave-update"):route("leave-add");c&&(s.id=c.id);const g=await axios.post(i,s);g.status===200||g.status===201?(w(g.data.leavesData),c&&R&&g.data.leave?(R(g.data.leave),x()):T&&g.data.leave?(T(g.data.leave),x(),g.data.pagination&&(P(g.data.pagination.total),L(g.data.pagination.lastPage))):(console.log("Using fallback data update mode"),g.data.leaves&&(u(g.data.leaves.data),P(g.data.leaves.total),L(g.data.leaves.last_page)),g.data.leavesData&&typeof updateLeavesData=="function"&&updateLeavesData(g.data.leavesData)),C(),h([g.data.message||"Leave application submitted successfully"])):(console.error("Unexpected response status:",g.status),t(`Unexpected response status: ${g.status}`))}catch(s){console.error("Full error object:",s),s.response?(console.error("Error response status:",s.response.status),console.error("Error response data:",s.response.data),s.response.status===422?(z(s.response.data.errors||{}),t(s.response.data.error||"Failed to submit leave application")):t(`HTTP Error ${s.response.status}: ${s.response.data.message||"An unexpected error occurred. Please try again later."}`)):s.request?(console.error("No response received:",s.request),t("No response received from the server. Please check your internet connection.")):(console.error("Request setup error:",s.message),t("An error occurred while setting up the request."))}finally{te(!1)}});j.promise(a,{pending:{render(){return r("div",{style:{display:"flex",alignItems:"center"},children:[e(ve,{}),e("span",{style:{marginLeft:"8px"},children:"Submitting leave application..."})]})},icon:!1,style:{backdropFilter:"blur(16px) saturate(200%)",background:m.glassCard.background,border:m.glassCard.border,color:m.palette.text.primary}},success:{render({data:h}){return e(se,{children:h.map((t,s)=>e("div",{children:t},s))})},icon:"ðŸŸ¢",style:{backdropFilter:"blur(16px) saturate(200%)",background:m.glassCard.background,border:m.glassCard.border,color:m.palette.text.primary}},error:{render({data:h}){return e(se,{children:h})},icon:"ðŸ”´",style:{backdropFilter:"blur(16px) saturate(200%)",background:m.glassCard.background,border:m.glassCard.border,color:m.palette.text.primary}}})},children:[e(Me,{children:r(ae,{container:!0,spacing:2,children:[e(ae,{item:!0,xs:12,md:6,children:r(Fe,{fullWidth:!0,children:[e(Pe,{id:"leave-type-label",children:"Leave Type"}),r(Ie,{labelId:"leave-type-label",value:$||"",onChange:f=>W(f.target.value),label:"Leave Type",error:!!D.leaveType,disabled:!1,MenuProps:{PaperProps:{sx:{backdropFilter:"blur(16px) saturate(200%)",background:m.glassCard.background,border:m.glassCard.border,borderRadius:2,boxShadow:m.glassCard.boxShadow,maxHeight:300}}},children:[e(ce,{value:"",disabled:!0,children:"Select Leave Type"}),M.map(f=>{const a=Y==null?void 0:Y.find(s=>s.leave_type===f.type),t=(a?f.days-a.days_used:f.days)<=0;return e(ce,{value:f.type,disabled:t,title:t?"No remaining leaves available":"",children:r(n,{display:"flex",justifyContent:"space-between",width:"100%",children:[e("span",{children:f.type}),e("span",{children:a?`${a.days_used} / ${f.days} days`:`${f.days} days`})]})},f.id)})]}),e(Re,{children:D.leaveType})]})}),e(ae,{item:!0,xs:12,md:6,children:e(fe,{label:"From",type:"date",fullWidth:!0,value:ne,onChange:f=>pe(f.target.value),InputLabelProps:{shrink:!0},error:!!D.fromDate,helperText:D.fromDate})}),e(ae,{item:!0,xs:12,md:6,children:e(fe,{label:"To",type:"date",fullWidth:!0,value:O,onChange:f=>l(f.target.value),InputLabelProps:{shrink:!0},error:!!D.toDate,helperText:D.toDate})}),e(ae,{item:!0,xs:12,md:6,children:e(fe,{label:"Number of days",type:"text",fullWidth:!0,value:v,InputProps:{readOnly:!0},error:!!D.daysCount,helperText:D.daysCount})}),e(ae,{item:!0,xs:12,md:6,children:e(fe,{label:"Remaining Leaves",type:"text",fullWidth:!0,value:`${q} day${q!==1?"s":""}`,InputProps:{readOnly:!0,endAdornment:r(d,{variant:"caption",color:"textSecondary",sx:{ml:1},children:["of ",((me=M.find(f=>f.type===$))==null?void 0:me.days)||0," total"]})},error:!!D.remainingLeaves,helperText:D.remainingLeaves})}),route().current()==="leaves"&&e(ae,{item:!0,xs:12,md:6,children:r(Fe,{fullWidth:!0,children:[e(Pe,{id:"leave-employee-label",children:"Employee"}),r(Ie,{variant:"outlined",fullWidth:!0,labelId:"leave-employee-label",value:_||"na",error:!!D.user_id,onChange:f=>I(f.target.value),label:"Employee",MenuProps:{PaperProps:{sx:{backdropFilter:"blur(16px) saturate(200%)",background:m.glassCard.background,border:m.glassCard.border,borderRadius:2,boxShadow:m.glassCard.boxShadow}}},children:[e(ce,{value:"na",disabled:!0,children:"Please select"}),k.map(f=>e(ce,{value:f.id,children:r(n,{sx:{display:"flex"},children:[e(it,{src:f.profile_image,alt:f.name||"Not assigned",sx:{borderRadius:"50%",width:23,height:23,display:"flex",mr:1}}),f.name]})},f.id))]}),e(Re,{children:D.user_id})]})}),e(ae,{item:!0,xs:12,children:e(fe,{label:"Leave Reason",multiline:!0,rows:4,fullWidth:!0,value:B,onChange:f=>U(f.target.value),error:!!D.leaveReason,helperText:D.leaveReason})})]})}),e(Be,{sx:{padding:"16px",justifyContent:"center"},children:e(xe,{type:"submit",variant:"outlined",color:"primary",loading:Q,disabled:Q,sx:{borderRadius:"50px"},children:"Submit"})})]})]})},wr=({open:y,closeModal:C,leaveId:N,setLeavesData:w,setLeaves:c,setTotalRows:k,setLastPage:P,setError:L,deleteLeaveOptimized:u,fetchLeavesStats:b})=>{const p=ye(),[E,T]=o.useState(!1);return r(We,{open:y,onClose:C,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e(Ee,{id:"alert-dialog-title",children:"Confirm Deletion"}),e(Me,{children:e(St,{id:"alert-dialog-description",children:"Are you sure you want to delete this leave? This action cannot be undone."})}),r(Be,{children:[e(Ae,{onClick:C,color:"primary",disabled:E,children:"Cancel"}),e(Ae,{loading:E,disabled:E,onClick:()=>{if(!N){const F=Promise.reject(new Error("Invalid leave ID"));j.promise(F,{error:"Invalid leave ID provided"});return}T(!0);const x=new Promise(async(F,m)=>{var _,I,M,H,Y,ee,$;try{const W=await ge.delete(route("leave-delete",{id:N,route:route().current()}));W.status===200&&(u?(u(N),k(K=>Math.max(0,K-1)),b&&b()):(w&&w(W.data.leavesData),k&&k(W.data.leaves.total),P&&P(W.data.leaves.last_page),c&&c(W.data.leaves.data),L&&L(!1),b&&b()),F("Leave application deleted successfully"))}catch(W){if(console.error("Error deleting leave:",W),((_=W.response)==null?void 0:_.status)===404){const{leavesData:K}=W.response.data||{};w&&K&&w(K),L&&L(((M=(I=W.response)==null?void 0:I.data)==null?void 0:M.message)||"Leave not found."),m("Leave not found or already deleted")}else((H=W.response)==null?void 0:H.status)===403?m("You do not have permission to delete this leave"):((Y=W.response)==null?void 0:Y.status)===422?m("Cannot delete leave with current status"):m((($=(ee=W.response)==null?void 0:ee.data)==null?void 0:$.error)||"Failed to delete leave application")}finally{T(!1),C()}});j.promise(x,{pending:{render(){return r("div",{style:{display:"flex",alignItems:"center"},children:[e(ve,{}),e("span",{style:{marginLeft:"8px"},children:"Deleting leave application..."})]})},icon:!1,style:{backdropFilter:"blur(16px) saturate(200%)",background:p.glassCard.background,border:p.glassCard.border,color:p.palette.text.primary}},success:{render({data:F}){return e(se,{children:F})},icon:"ðŸŸ¢",style:{backdropFilter:"blur(16px) saturate(200%)",background:p.glassCard.background,border:p.glassCard.border,color:p.palette.text.primary}},error:{render({data:F}){return e(se,{children:F})},icon:"ðŸ”´",style:{backdropFilter:"blur(16px) saturate(200%)",background:p.glassCard.background,border:p.glassCard.border,color:p.palette.text.primary}}})},color:"error",autoFocus:!0,children:"Delete"})]})]})},Mt=({selectedDates:y=[],onDatesChange:C,existingLeaves:N=[],publicHolidays:w=[],minDate:c=null,maxDate:k=null,userId:P=null,fetchFromAPI:L=!1})=>{const u=ye(),[b,p]=o.useState(new Date),[E,T]=o.useState({existingLeaves:N,publicHolidays:w}),[R,x]=o.useState(!1),[F,m]=o.useState(null),_=o.useCallback(async l=>{if(!(!L||!P)&&F!==l){x(!0);try{const v=await ge.get(route("leaves.bulk.calendar-data"),{params:{user_id:P,year:l}});v.data.success&&(T({existingLeaves:v.data.data.existingLeaves||[],publicHolidays:v.data.data.publicHolidays||[]}),m(l))}catch(v){console.error("Failed to fetch calendar data:",v)}finally{x(!1)}}},[L,P,F]);o.useEffect(()=>{const l=b.getFullYear();_(l)},[_,b.getFullYear()]),o.useEffect(()=>{L&&P&&m(null)},[P,L]);const I=L?E.existingLeaves:N,M=L?E.publicHolidays:w,H=o.useMemo(()=>{const l=b.getFullYear(),v=b.getMonth(),S=new Date(l,v,1),V=new Date(l,v+1,0).getDate(),B=S.getDay(),U=new Date(l,v,0).getDate(),D=[];for(let A=B-1;A>=0;A--)D.push({date:U-A,isCurrentMonth:!1,fullDate:new Date(l,v-1,U-A)});const z=[];for(let A=1;A<=V;A++)z.push({date:A,isCurrentMonth:!0,fullDate:new Date(l,v,A)});const te=42-(D.length+z.length),re=[];for(let A=1;A<=te;A++)re.push({date:A,isCurrentMonth:!1,fullDate:new Date(l,v+1,A)});return[...D,...z,...re]},[b]),Y=o.useCallback(()=>{p(l=>new Date(l.getFullYear(),l.getMonth()-1,1))},[]),ee=o.useCallback(()=>{p(l=>new Date(l.getFullYear(),l.getMonth()+1,1))},[]),$=o.useCallback(()=>{p(new Date)},[]),W=o.useCallback(l=>{if(!l.isCurrentMonth||R)return;const v=l.fullDate.getFullYear()+"-"+String(l.fullDate.getMonth()+1).padStart(2,"0")+"-"+String(l.fullDate.getDate()).padStart(2,"0"),S=I.some(U=>{if(!U.from_date||!U.to_date)return!1;const D=U.from_date.split("T")[0],z=U.to_date.split("T")[0];return v>=D&&v<=z}),q=M.includes(v);if(S||q||c&&l.fullDate<new Date(c)||k&&l.fullDate>new Date(k))return;const V=y.includes(v);let B;V?B=y.filter(U=>U!==v):B=[...y,v],C(B.sort())},[y,C,c,k,R,I,M]),K=o.useCallback(l=>{if(!l.isCurrentMonth)return{selectable:!1};const v=l.fullDate.getFullYear()+"-"+String(l.fullDate.getMonth()+1).padStart(2,"0")+"-"+String(l.fullDate.getDate()).padStart(2,"0"),S=y.includes(v),q=l.fullDate.toDateString()===new Date().toDateString(),V=l.fullDate<new Date().setHours(0,0,0,0),B=l.fullDate.getDay()===0||l.fullDate.getDay()===6,U=I.some(Q=>{if(!Q.from_date||!Q.to_date)return!1;const te=Q.from_date.split("T")[0],re=Q.to_date.split("T")[0];return v>=te&&v<=re}),D=M.includes(v),z=!R&&!U&&!D&&(!c||l.fullDate>=new Date(c))&&(!k||l.fullDate<=new Date(k));return{isSelected:S,isToday:q,isPast:V,isWeekend:B,hasExistingLeave:U,isPublicHoliday:D,selectable:z}},[y,I,M,c,k,R]),ne=o.useCallback((l,v)=>l.isCurrentMonth?R?{color:u.palette.text.disabled,cursor:"not-allowed",backgroundColor:u.palette.action.disabledBackground,opacity:.5,pointerEvents:"none"}:v.isSelected?{backgroundColor:u.palette.primary.main,color:u.palette.primary.contrastText,fontWeight:"bold",border:`2px solid ${u.palette.primary.dark}`,boxShadow:`0 0 0 3px ${u.palette.primary.main}30`,transform:"scale(1.05)",zIndex:10}:v.hasExistingLeave?{backgroundColor:u.palette.error.main,color:u.palette.error.contrastText,border:`2px solid ${u.palette.error.dark}`,fontWeight:500,cursor:"not-allowed"}:v.isPublicHoliday?{backgroundColor:u.palette.warning.main,color:u.palette.warning.contrastText,border:`2px solid ${u.palette.warning.dark}`,fontWeight:500,cursor:"not-allowed"}:v.isToday?{backgroundColor:u.palette.secondary.light,color:u.palette.secondary.contrastText,fontWeight:600,border:`2px solid ${u.palette.secondary.main}`,boxShadow:`0 0 0 2px ${u.palette.secondary.main}40`,"&:hover":{backgroundColor:u.palette.secondary.main,transform:"scale(1.02)"}}:v.isWeekend?{color:u.palette.text.secondary,backgroundColor:u.palette.action.hover,border:`1px solid ${u.palette.divider}`,opacity:.7,"&:hover":{backgroundColor:u.palette.action.selected,opacity:.9}}:v.selectable?{color:u.palette.text.primary,border:"1px solid transparent","&:hover":{backgroundColor:u.palette.primary.main+"15",color:u.palette.primary.main,border:`1px solid ${u.palette.primary.main}30`,transform:"scale(1.02)"}}:{color:u.palette.text.disabled,cursor:"not-allowed",backgroundColor:u.palette.action.disabledBackground,opacity:.6}:{color:u.palette.text.disabled,cursor:"not-allowed",opacity:.3},[u,R]),pe=b.toLocaleDateString("en-US",{month:"long",year:"numeric"}),O=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];return r(lt,{variant:"outlined",sx:{width:"100%"},children:[e(je,{title:r(n,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[r(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[e(de,{style:{width:20,height:20,color:u.palette.primary.main}}),e(d,{variant:"h6",component:"h3",children:pe}),L&&F&&e(le,{size:"small",variant:"outlined",color:"primary",label:`Data: ${F}`,sx:{ml:1,fontSize:"0.7rem"}})]}),r(n,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e(ue,{size:"small",onClick:Y,sx:{color:"text.secondary"},disabled:R,children:e(Rt,{style:{width:16,height:16}})}),e(Ae,{variant:"text",size:"small",onClick:$,sx:{minWidth:"auto",px:1.5,py:.5,fontSize:"0.75rem",textTransform:"none"},disabled:R,children:"Today"}),e(ue,{size:"small",onClick:ee,sx:{color:"text.secondary"},disabled:R,children:e(mt,{style:{width:16,height:16}})})]})]}),sx:{pb:2}}),r($e,{sx:{pt:0},children:[R&&r(n,{sx:{display:"flex",justifyContent:"center",alignItems:"center",py:3,backgroundColor:u.palette.action.hover,borderRadius:2,mb:3},children:[e(ve,{size:24}),r(d,{variant:"body2",sx:{ml:2},children:["Loading calendar data for ",b.getFullYear(),"..."]})]}),r(n,{sx:{display:"flex",flexWrap:"wrap",gap:1,mb:3},children:[e(le,{size:"small",variant:"filled",color:"primary",label:"Selected",sx:{fontWeight:600}}),e(le,{size:"small",variant:"filled",color:"error",label:"Existing Leave",sx:{opacity:.9}}),e(le,{size:"small",variant:"filled",color:"warning",label:"Holiday",sx:{opacity:.9}}),e(le,{size:"small",variant:"filled",color:"secondary",label:"Today",sx:{fontWeight:600}}),e(le,{size:"small",variant:"outlined",color:"default",label:"Weekend",sx:{opacity:.7}})]}),e(n,{sx:{display:"grid",gridTemplateColumns:"repeat(7, 1fr)",gap:.5,mb:1},children:O.map(l=>e(n,{sx:{textAlign:"center",py:1,fontSize:"0.875rem",fontWeight:"medium",color:"text.secondary"},children:l},l))}),e(n,{sx:{display:"grid",gridTemplateColumns:"repeat(7, 1fr)",gap:.5},children:H.map((l,v)=>{const S=K(l),q=ne(l,S);return r(n,{onClick:()=>W(l),sx:{position:"relative",display:"flex",alignItems:"center",justifyContent:"center",width:40,height:40,minHeight:40,cursor:S.selectable?"pointer":"not-allowed",borderRadius:1.5,transition:"all 0.2s ease-in-out",fontSize:"0.875rem",userSelect:"none",...q},role:"button",tabIndex:S.selectable?0:-1,title:S.hasExistingLeave?"Existing leave - cannot select":S.isPublicHoliday?"Public holiday - cannot select":S.selectable?"":"Not selectable","aria-label":`${l.fullDate.toDateString()}${S.isSelected?" (selected)":""}${S.hasExistingLeave?" (existing leave)":""}${S.isPublicHoliday?" (public holiday)":""}`,onKeyDown:V=>{(V.key==="Enter"||V.key===" ")&&(V.preventDefault(),W(l))},children:[l.date,S.isWeekend&&!S.isSelected&&!S.hasExistingLeave&&!S.isPublicHoliday&&e(n,{sx:{position:"absolute",top:2,right:2,width:4,height:4,borderRadius:"50%",bgcolor:"text.secondary",opacity:.5}})]},v)})}),y.length>0&&r(n,{sx:{mt:3,p:2.5,borderRadius:2,background:`linear-gradient(135deg, ${u.palette.primary.light}20, ${u.palette.primary.main}10)`,border:`1px solid ${u.palette.primary.main}30`,backdropFilter:"blur(8px)",position:"relative",overflow:"hidden"},children:[r(n,{sx:{position:"relative",zIndex:1},children:[r(d,{variant:"body2",color:"primary.main",fontWeight:"600",sx:{mb:1},children:["ðŸ“… ",y.length," date",y.length!==1?"s":""," selected"]}),r(n,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:[y.slice(0,12).map(l=>e(le,{size:"small",variant:"filled",color:"primary",label:new Date(l).toLocaleDateString("en-US",{month:"short",day:"numeric"}),sx:{fontWeight:500,fontSize:"0.75rem"}},l)),y.length>12&&e(le,{size:"small",variant:"outlined",color:"primary",label:`+${y.length-12} more`,sx:{fontWeight:500}})]})]}),e(n,{sx:{position:"absolute",top:-10,right:-10,width:60,height:60,borderRadius:"50%",background:`linear-gradient(45deg, ${u.palette.primary.main}15, transparent)`,opacity:.3}})]})]})]})},Bt=({validationResults:y=[],balanceImpact:C=null,isValidating:N=!1})=>{const w=ye();if(y.length===0&&!N)return null;const c=y.filter(p=>p.status==="valid").length,k=y.filter(p=>p.status==="warning").length,P=y.filter(p=>p.status==="conflict").length;y.length;const L=p=>{const E={style:{width:16,height:16}};switch(p){case"valid":return e(Ge,{...E,style:{...E.style,color:w.palette.success.main}});case"warning":return e(Ve,{...E,style:{...E.style,color:w.palette.warning.main}});case"conflict":return e(Dt,{...E,style:{...E.style,color:w.palette.error.main}});default:return e(ot,{...E,style:{...E.style,color:w.palette.text.disabled}})}},u=p=>{switch(p){case"valid":return"success";case"warning":return"warning";case"conflict":return"error";default:return"default"}},b=p=>new Date(p).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"});return r(n,{sx:{display:"flex",flexDirection:"column",gap:2},children:[r(et,{variant:"outlined",children:[e(je,{title:r(n,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e(d,{variant:"h6",children:"Validation Results"}),N&&r(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[e(ve,{size:16}),e(d,{variant:"body2",color:"text.secondary",children:"Validating..."})]})]})}),r($e,{sx:{pt:0},children:[r(n,{sx:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:2,mb:2},children:[r(n,{sx:{textAlign:"center"},children:[e(d,{variant:"h4",color:"success.main",fontWeight:"bold",children:c}),e(d,{variant:"body2",color:"success.main",children:"Valid"})]}),r(n,{sx:{textAlign:"center"},children:[e(d,{variant:"h4",color:"warning.main",fontWeight:"bold",children:k}),e(d,{variant:"body2",color:"warning.main",children:"Warnings"})]}),r(n,{sx:{textAlign:"center"},children:[e(d,{variant:"h4",color:"error.main",fontWeight:"bold",children:P}),e(d,{variant:"body2",color:"error.main",children:"Conflicts"})]})]}),C&&r(n,{sx:{p:2,borderRadius:2,background:w.palette.background.paper,border:`1px solid ${w.palette.divider}`},children:[r(d,{variant:"subtitle2",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e(ot,{style:{width:16,height:16,color:w.palette.primary.main}}),"Leave Balance Impact"]}),r(n,{sx:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:2},children:[r(n,{children:[e(d,{variant:"body2",color:"text.secondary",component:"span",children:"Leave Type:"}),e(d,{variant:"body2",fontWeight:"medium",component:"span",sx:{ml:1},children:C.leave_type})]}),r(n,{children:[e(d,{variant:"body2",color:"text.secondary",component:"span",children:"Current Balance:"}),r(d,{variant:"body2",fontWeight:"medium",component:"span",sx:{ml:1},children:[C.current_balance," days"]})]}),r(n,{children:[e(d,{variant:"body2",color:"text.secondary",component:"span",children:"Requested Days:"}),r(d,{variant:"body2",fontWeight:"medium",component:"span",sx:{ml:1},children:[C.requested_days," days"]})]}),r(n,{children:[e(d,{variant:"body2",color:"text.secondary",component:"span",children:"Remaining Balance:"}),r(d,{variant:"body2",fontWeight:"medium",component:"span",sx:{ml:1,color:C.remaining_balance<0?"error.main":"success.main"},children:[C.remaining_balance," days"]})]})]}),C.remaining_balance<0&&e(n,{sx:{mt:2,p:1.5,borderRadius:1,bgcolor:"error.light",border:1,borderColor:"error.main"},children:r(d,{variant:"body2",color:"error.main",children:["âš ï¸ This request exceeds your available leave balance by ",Math.abs(C.remaining_balance)," days."]})})]})]})]}),y.length>0&&r(et,{variant:"outlined",children:[e(je,{title:e(d,{variant:"h6",children:"Date-by-Date Results"})}),e($e,{children:e(n,{sx:{display:"flex",flexDirection:"column",gap:1,maxHeight:240,overflowY:"auto"},children:y.map((p,E)=>r(n,{sx:{display:"flex",alignItems:"flex-start",justifyContent:"space-between",p:2,borderRadius:2,border:1,borderColor:"divider","&:hover":{borderColor:"text.secondary"},transition:"border-color 0.2s"},children:[r(n,{sx:{display:"flex",alignItems:"center",gap:2},children:[L(p.status),r(n,{children:[e(d,{variant:"body2",fontWeight:"medium",children:b(p.date)}),e(d,{variant:"caption",color:"text.secondary",children:p.date})]})]}),r(n,{sx:{display:"flex",flexDirection:"column",alignItems:"flex-end",gap:.5},children:[e(le,{size:"small",variant:"outlined",color:u(p.status),label:p.status,sx:{textTransform:"capitalize"}}),p.errors&&p.errors.length>0&&e(n,{sx:{textAlign:"right"},children:p.errors.map((T,R)=>e(d,{variant:"caption",color:"error.main",children:T},R))}),p.warnings&&p.warnings.length>0&&e(n,{sx:{textAlign:"right"},children:p.warnings.map((T,R)=>e(d,{variant:"caption",color:"warning.main",children:T},R))})]})]},E))})})]})]})},Cr=({open:y,onClose:C,onSuccess:N,allUsers:w=[],leavesData:c={leaveTypes:[],leaveCountsByUser:{}},isAdmin:k=!1,existingLeaves:P=[],publicHolidays:L=[]})=>{var me,f;const{auth:u}=Ye().props,b=ye(),[p,E]=o.useState([]),[T,R]=o.useState(((me=u==null?void 0:u.user)==null?void 0:me.id)||""),[x,F]=o.useState(""),[m,_]=o.useState(""),[I,M]=o.useState(!1),[H,Y]=o.useState([]),[ee,$]=o.useState(!1),[W,K]=o.useState([]),[ne,pe]=o.useState(null),[O,l]=o.useState(!1),[v,S]=o.useState(!1),[q,V]=o.useState(!1),[B,U]=o.useState({});o.useMemo(()=>!P||P.length===0?[]:P.filter(a=>a.user_id===parseInt(T)),[P,T]);const D=o.useMemo(()=>H.length>0?H:(c==null?void 0:c.leaveTypes)||[],[H,c]),z=o.useMemo(()=>{var a;return H.length>0?H.map(h=>({leave_type:h.type,days_used:h.used,total_days:h.days,remaining_days:h.remaining})):((a=c==null?void 0:c.leaveCountsByUser)==null?void 0:a[T])||[]},[H,c,T]),Q=o.useCallback(async a=>{if(a){$(!0);try{const h=await ge.get(route("leaves.bulk.leave-types"),{params:{user_id:a,year:new Date().getFullYear()}});h.data.success&&Y(h.data.leave_types)}catch(h){console.error("Failed to fetch user leave types:",h),Y([])}finally{$(!1)}}},[]);o.useEffect(()=>{y&&T&&k&&Q(T)},[T,y,k,Q]),o.useEffect(()=>{var a;y||(E([]),R(((a=u==null?void 0:u.user)==null?void 0:a.id)||""),F(""),_(""),M(!1),K([]),pe(null),S(!1),U({}),Y([]))},[y,(f=u==null?void 0:u.user)==null?void 0:f.id]),o.useEffect(()=>{if(D.length>0&&!x&&y&&T){const a=D.find(h=>{if(H.length>0)return h.remaining>0;const t=z==null?void 0:z.find(i=>i.leave_type===h.type);return(t?h.days-t.days_used:h.days)>0});a&&F(a.type)}},[D,z,H,x,y,T]);const te=o.useCallback(async()=>{var a,h,t;if(p.length===0){const s=Promise.reject(new Error("No dates selected"));j.promise(s,{error:"Please select at least one date"});return}if(!x){const s=Promise.reject(new Error("No leave type selected"));j.promise(s,{error:"Please select a leave type"});return}if(!m.trim()||m.trim().length<5){const s=new Promise((i,g)=>{g("Please provide a reason for leave (at least 5 characters)")});j.promise(s,{error:{render({data:i}){return e(se,{children:i})},icon:"ðŸ”´",style:{backdropFilter:"blur(16px) saturate(200%)",background:b.glassCard.background,border:b.glassCard.border,color:b.palette.text.primary}}});return}l(!0),U({});try{const s=D.find(g=>g.type===x),i=await ge.post(route("leaves.bulk.validate"),{user_id:parseInt(T),dates:p,leave_type_id:s==null?void 0:s.id,reason:m.trim()});if(i.data.success){K(i.data.validation_results),pe(i.data.estimated_balance_impact),S(!0);const g=i.data.validation_results.filter(oe=>oe.status==="conflict").length,G=i.data.validation_results.filter(oe=>oe.status==="warning").length,Z=Promise.resolve();g>0?j.promise(Z,{success:`${g} date(s) have conflicts. Please review before submitting.`}):G>0?j.promise(Z,{success:`${G} date(s) have warnings. You may proceed if acceptable.`}):j.promise(Z,{success:"All dates validated successfully!"})}}catch(s){console.error("Validation error:",s),((a=s.response)==null?void 0:a.status)===422&&U(s.response.data.errors||{});const i=Promise.reject(s);j.promise(i,{error:((t=(h=s.response)==null?void 0:h.data)==null?void 0:t.message)||"Failed to validate dates"})}finally{l(!1)}},[p,x,m,T,D]),re=o.useCallback(async()=>{if(!v){const t=Promise.reject(new Error("Not validated"));j.promise(t,{error:"Please validate dates before submitting"});return}if(W.filter(t=>t.status==="conflict").length>0&&!I){const t=new Promise((s,i)=>{i("Please resolve conflicts or enable partial success mode")});j.promise(t,{error:{render({data:s}){return e(se,{children:s})},icon:"ðŸ”´",style:{backdropFilter:"blur(16px) saturate(200%)",background:b.glassCard.background,border:b.glassCard.border,color:b.palette.text.primary}}});return}V(!0);const h=new Promise(async(t,s)=>{try{const i=D.find(G=>G.type===x),g=await ge.post(route("leaves.bulk.store"),{user_id:parseInt(T),dates:p,leave_type_id:i==null?void 0:i.id,reason:m.trim(),allow_partial_success:I});g.status===200||g.status===201?(N==null||N(g.data),C(),t([g.data.message||"Bulk leave requests created successfully"])):(console.error("Unexpected response status:",g.status),s(`Unexpected response status: ${g.status}`))}catch(i){console.error("Full error object:",i),i.response?(console.error("Error response status:",i.response.status),console.error("Error response data:",i.response.data),i.response.status===422?(U(i.response.data.errors||{}),s(i.response.data.error||"Failed to submit bulk leave requests")):s(`HTTP Error ${i.response.status}: ${i.response.data.message||"An unexpected error occurred. Please try again later."}`)):i.request?(console.error("No response received:",i.request),s("No response received from the server. Please check your internet connection.")):(console.error("Request setup error:",i.message),s("An error occurred while setting up the request."))}finally{V(!1)}});j.promise(h,{pending:{render(){return r("div",{style:{display:"flex",alignItems:"center"},children:[e(ve,{}),e("span",{style:{marginLeft:"8px"},children:"Creating bulk leave requests..."})]})},icon:!1,style:{backdropFilter:"blur(16px) saturate(200%)",background:b.glassCard.background,border:b.glassCard.border,color:b.palette.text.primary}},success:{render({data:t}){return e(se,{children:t.map((s,i)=>e("div",{children:s},i))})},icon:"ðŸŸ¢",style:{backdropFilter:"blur(16px) saturate(200%)",background:b.glassCard.background,border:b.glassCard.border,color:b.palette.text.primary}},error:{render({data:t}){return e(se,{children:t})},icon:"ðŸ”´",style:{backdropFilter:"blur(16px) saturate(200%)",background:b.glassCard.background,border:b.glassCard.border,color:b.palette.text.primary}}})},[v,W,I,T,p,x,m,N,C,D,b]),A=p.length>0&&x&&m.trim().length>=5,Se=v&&(W.filter(a=>a.status==="conflict").length===0||I);return r(We,{open:y,onClose:C,fullWidth:!0,maxWidth:"lg",children:[r(Ee,{sx:{display:"flex",alignItems:"center",pb:1},children:[r(n,{sx:{display:"flex",alignItems:"center",gap:2,flex:1},children:[e(de,{style:{width:24,height:24,color:b.palette.primary.main}}),r(n,{children:[e(d,{variant:"h6",component:"h2",children:"Add Bulk Leave"}),e(d,{variant:"body2",color:"text.secondary",sx:{mt:.5},children:"Select multiple dates and create leave requests in batch"})]})]}),e(ue,{onClick:C,sx:{position:"absolute",top:8,right:16},disabled:q,children:e(Oe,{})})]}),e(Me,{sx:{py:3},children:r(ae,{container:!0,spacing:3,children:[e(ae,{item:!0,xs:12,lg:6,children:r(n,{sx:{position:"sticky",top:0},children:[r(d,{variant:"h6",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1},children:[e(de,{style:{width:20,height:20}}),"Select Dates"]}),e(Mt,{selectedDates:p,onDatesChange:a=>{E(a),S(!1)},userId:T,fetchFromAPI:!0})]})}),e(ae,{item:!0,xs:12,lg:6,children:r(n,{sx:{display:"flex",flexDirection:"column",gap:3},children:[r(n,{children:[e(d,{variant:"h6",gutterBottom:!0,children:"Leave Details"}),r(n,{sx:{display:"flex",flexDirection:"column",gap:2},children:[k&&w.length>0&&r(Fe,{fullWidth:!0,error:!!B.user_id,children:[e(Pe,{id:"bulk-employee-label",children:"Employee"}),r(Ie,{labelId:"bulk-employee-label",value:T||"",onChange:a=>{R(a.target.value),F(""),S(!1),Y([])},label:"Employee",disabled:q||O,MenuProps:{PaperProps:{sx:{backdropFilter:"blur(16px) saturate(200%)",background:b.glassCard.background,border:b.glassCard.border,borderRadius:2,boxShadow:b.glassCard.boxShadow,maxHeight:300}}},children:[e(ce,{value:"",disabled:!0,children:"Please select employee"}),w.map(a=>e(ce,{value:a.id,children:r(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[e(it,{src:a.profile_image,alt:a.name||"Not assigned",sx:{width:24,height:24}}),a.name]})},a.id))]}),e(Re,{children:B.user_id})]}),r(Fe,{fullWidth:!0,error:!!B.leave_type_id,children:[e(Pe,{id:"bulk-leave-type-label",children:"Leave Type"}),r(Ie,{labelId:"bulk-leave-type-label",value:x||"",onChange:a=>{F(a.target.value),S(!1)},label:"Leave Type",disabled:q||O||ee,MenuProps:{PaperProps:{sx:{backdropFilter:"blur(16px) saturate(200%)",background:b.glassCard.background,border:b.glassCard.border,borderRadius:2,boxShadow:b.glassCard.boxShadow,maxHeight:300}}},children:[e(ce,{value:"",disabled:!0,children:ee?"Loading leave types...":"Select Leave Type"}),D.map(a=>{let h,t;if(H.length>0)h=a.remaining,t=h<=0;else{const s=z==null?void 0:z.find(i=>i.leave_type===a.type);h=s?a.days-s.days_used:a.days,t=h<=0}return e(ce,{value:a.type,disabled:t,title:t?"No remaining leaves available":"",children:r(n,{display:"flex",justifyContent:"space-between",width:"100%",children:[e("span",{children:a.type}),r("span",{children:["(",h," remaining)"]})]})},a.id)})]}),e(Re,{children:B.leave_type_id})]}),x&&e(fe,{label:"Remaining Leaves",type:"text",fullWidth:!0,value:(()=>{const a=D.find(t=>t.type===x);let h;if(H.length>0&&a)h=a.remaining,a.days;else{const t=z==null?void 0:z.find(s=>s.leave_type===x);h=t?(a==null?void 0:a.days)-t.days_used:a==null?void 0:a.days,a==null||a.days}return`${h||0} remaining`})(),InputProps:{readOnly:!0,endAdornment:r(d,{variant:"caption",color:"textSecondary",sx:{ml:1},children:["of ",(()=>{const a=D.find(h=>h.type===x);return H.length>0,a==null?void 0:a.days})()," total"]})}}),e(fe,{label:"Reason for Leave",placeholder:"Please provide a detailed reason for your leave request...",value:m,onChange:a=>{_(a.target.value),S(!1)},multiline:!0,rows:3,fullWidth:!0,required:!0,error:!!B.reason||m.length>0&&m.length<5,helperText:B.reason||(m.length>0&&m.length<5?"Reason must be at least 5 characters":`${m.length}/500 characters`),inputProps:{maxLength:500},disabled:q||O}),e(ht,{control:e(ft,{checked:I,onChange:a=>M(a.target.checked),size:"small",disabled:q||O}),label:r(n,{children:[e(d,{variant:"body2",children:"Allow partial success"}),e(d,{variant:"caption",color:"text.secondary",children:"Valid dates will be processed even if some dates fail validation"})]})})]})]}),p.length>0&&r(n,{sx:{p:2,borderRadius:2,background:b.palette.background.paper,border:`1px solid ${b.palette.divider}`},children:[e(d,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:"Selected Dates Summary"}),r(d,{variant:"body1",children:[e("strong",{children:p.length})," date",p.length!==1?"s":""," selected"]}),x&&r(d,{variant:"body2",color:"text.secondary",children:["Leave type: ",x]})]}),e(Bt,{validationResults:W,balanceImpact:ne,isValidating:O})]})})]})}),r(Be,{sx:{padding:"16px 24px",justifyContent:"space-between",gap:2},children:[e(xe,{variant:"outlined",onClick:C,disabled:q,sx:{borderRadius:"50px"},children:"Cancel"}),r(n,{sx:{display:"flex",gap:1},children:[e(xe,{variant:"outlined",color:"primary",onClick:te,loading:O,disabled:!A||q,startIcon:!O&&e(Ve,{style:{width:16,height:16}}),sx:{borderRadius:"50px"},children:O?"Validating...":"Validate Dates"}),e(xe,{variant:"contained",color:"primary",onClick:re,loading:q,disabled:!Se||O,startIcon:!q&&e(Ge,{style:{width:16,height:16}}),sx:{borderRadius:"50px"},children:q?"Creating...":`Create ${p.length} Leave Request${p.length!==1?"s":""}`})]})]})]})},kr=({open:y,onClose:C,onSuccess:N,selectedLeaves:w=[],allUsers:c=[]})=>{const k=ye(),[P,L]=o.useState(!1),[u,b]=o.useState({}),p=o.useCallback(x=>{const F=c.find(m=>m.id===x);return(F==null?void 0:F.name)||`User ID: ${x}`},[c]),E=w.filter(x=>x.status&&x.status.toLowerCase()==="approved"),T=E.length===0,R=o.useCallback(async()=>{if(!T){const F=Promise.reject("Cannot delete approved leaves");j.promise(F,{error:"Cannot delete approved leave requests"});return}if(w.length===0){const F=Promise.reject("No leaves selected");j.promise(F,{error:"No leave requests selected for deletion"});return}L(!0);const x=new Promise(async(F,m)=>{try{const _=w.map(M=>M.id),I=await ge.delete(route("leaves.bulk.delete"),{data:{leave_ids:_}});I.status===200&&I.data.success?(N==null||N(I.data),C(),F([I.data.message||"Leave requests deleted successfully"])):(console.error("Unexpected response status:",I.status),m(`Unexpected response status: ${I.status}`))}catch(_){console.error("Full error object:",_),_.response?(console.error("Error response status:",_.response.status),console.error("Error response data:",_.response.data),_.response.status===422?(b(_.response.data.errors||{}),m(_.response.data.error||"Failed to delete leave requests")):_.response.status===403?m(_.response.data.error||"You are not authorized to delete these leave requests"):_.response.status===404?m(_.response.data.error||"Some leave requests were not found"):m(`HTTP Error ${_.response.status}: ${_.response.data.message||"An unexpected error occurred. Please try again later."}`)):_.request?(console.error("No response received:",_.request),m("No response received from the server. Please check your internet connection.")):(console.error("Request setup error:",_.message),m("An error occurred while setting up the request."))}finally{L(!1)}});j.promise(x,{pending:{render(){return r("div",{style:{display:"flex",alignItems:"center"},children:[e(ve,{}),e("span",{style:{marginLeft:"8px"},children:"Deleting leave requests..."})]})},icon:!1,style:{backdropFilter:"blur(16px) saturate(200%)",background:k.glassCard.background,border:k.glassCard.border,color:k.palette.text.primary}},success:{render({data:F}){return e(se,{children:F.map((m,_)=>e("div",{children:m},_))})},icon:"ðŸŸ¢",style:{backdropFilter:"blur(16px) saturate(200%)",background:k.glassCard.background,border:k.glassCard.border,color:k.palette.text.primary}},error:{render({data:F}){return e(se,{children:F})},icon:"ðŸ”´",style:{backdropFilter:"blur(16px) saturate(200%)",background:k.glassCard.background,border:k.glassCard.border,color:k.palette.text.primary}}})},[w,T,N,C,k]);return r(We,{open:y,onClose:C,fullWidth:!0,maxWidth:"md",children:[r(Ee,{sx:{display:"flex",alignItems:"center",pb:1},children:[r(n,{sx:{display:"flex",alignItems:"center",gap:2,flex:1},children:[e(_e,{style:{width:24,height:24,color:k.palette.error.main}}),r(n,{children:[e(d,{variant:"h6",component:"h2",children:"Delete Leave Requests"}),r(d,{variant:"body2",color:"text.secondary",sx:{mt:.5},children:["Confirm deletion of ",w.length," leave request",w.length!==1?"s":""]})]})]}),e(ue,{onClick:C,sx:{position:"absolute",top:8,right:16},disabled:P,children:e(Oe,{})})]}),r(Me,{sx:{py:3},children:[!T&&r(n,{sx:{p:2,mb:3,borderRadius:2,background:k.palette.error.main+"20",border:`1px solid ${k.palette.error.main}40`},children:[r(n,{sx:{display:"flex",alignItems:"center",gap:2,mb:1},children:[e(Ve,{style:{width:20,height:20,color:k.palette.error.main}}),e(d,{variant:"subtitle2",color:"error",children:"Cannot Delete Approved Leaves"})]}),r(d,{variant:"body2",color:"error",children:[E.length," of the selected leave requests are already approved and cannot be deleted. Only pending or rejected leaves can be deleted."]})]}),r(d,{variant:"h6",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1,mb:2},children:[e(Ge,{style:{width:20,height:20}}),"Selected Leave Requests (",w.length,")"]}),e($t,{sx:{maxHeight:300,overflow:"auto",border:`1px solid ${k.palette.divider}`,borderRadius:2,backgroundColor:k.palette.background.paper},children:w.map((x,F)=>{var _,I,M;const m=x.status&&x.status.toLowerCase()==="approved";return r(ke.Fragment,{children:[e(Nt,{sx:{py:2,opacity:m?.6:1,backgroundColor:m?k.palette.error.main+"10":"transparent"},children:e(Tt,{primary:r(n,{sx:{display:"flex",alignItems:"center",gap:2,flexWrap:"wrap"},children:[e(d,{variant:"subtitle2",children:p(x.user_id)}),e(Te,{size:"sm",variant:"flat",color:((_=x.status)==null?void 0:_.toLowerCase())==="approved"?"success":((I=x.status)==null?void 0:I.toLowerCase())==="pending"?"warning":((M=x.status)==null?void 0:M.toLowerCase())==="rejected"?"danger":"default",children:x.status||"Unknown"}),m&&e(Te,{size:"sm",variant:"flat",color:"danger",children:"Cannot Delete"})]}),secondary:r(n,{children:[r(d,{variant:"body2",color:"text.secondary",children:[x.leave_type," - ",x.from_date," to ",x.to_date]}),r(d,{variant:"body2",color:"text.secondary",children:[x.no_of_days," day",x.no_of_days!==1?"s":""," - ",x.reason]})]})})}),F<w.length-1&&e(Ft,{})]},x.id)})}),T&&e(n,{sx:{mt:3,p:2,borderRadius:2,background:k.palette.warning.main+"20",border:`1px solid ${k.palette.warning.main}40`},children:e(d,{variant:"body2",color:"warning.main",sx:{fontWeight:500},children:"âš ï¸ This action cannot be undone. The selected leave requests will be permanently deleted."})})]}),r(Be,{sx:{padding:"16px 24px",justifyContent:"space-between",gap:2},children:[e(xe,{variant:"outlined",onClick:C,disabled:P,sx:{borderRadius:"50px"},children:"Cancel"}),e(xe,{variant:"contained",color:"error",onClick:R,loading:P,disabled:!T||P||w.length===0,startIcon:!P&&e(_e,{style:{width:16,height:16}}),sx:{borderRadius:"50px"},children:P?"Deleting...":`Delete ${w.length} Request${w.length!==1?"s":""}`})]})]})};export{Cr as B,wr as D,vr as L,kr as a,Et as b};
