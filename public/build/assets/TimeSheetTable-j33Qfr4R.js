import{J as Le,r as l,a as Re,j as e,b as r,e as Ye,F as he,i as We,d as Ue,R as lt,p as it}from"./app-DrzT5PGN.js";import{u as ct,a as ze,d as c,B as s,E as je,F as oe,b as w,f as F,G as mt,H as de,i as ue,J as pe,c as ht,K as He,L as dt,M as ut}from"./App-DXysQFIl.js";import{d as E}from"./dayjs.min-k6FNNcwa.js";import{u as ne,w as pt}from"./xlsx-DbTalbU2.js";import{E as gt}from"./jspdf.es.min-lF7IfcKa.js";import{a as ft}from"./jspdf.plugin.autotable-CtA5BUKo.js";import{P as xt}from"./PageHeader-DrzpL3_x.js";import{F as O}from"./ExclamationTriangleIcon-ByvgEp5M.js";import{F as ge}from"./UserIcon-D_5akTlW.js";import{C as bt}from"./CardHeader-CmBegkC9.js";import{F as Oe}from"./DocumentArrowDownIcon-BpSJeCby.js";import{F as B}from"./CheckCircleIcon-D4FlZV2C.js";import{C as Be}from"./CardContent-CG40gJZs.js";import{B as wt}from"./Button-7nsRu6NN.js";import{F as Nt}from"./XCircleIcon-DvV2hqXB.js";import{s as Ge}from"./chunk-TLYTI3QM-DZjDvZBJ.js";import{t as Je,a as Ke,b as Ve,c as Qe,d as Xe,e as P}from"./chunk-F3UDT23P-CUUJQU_n.js";import{p as qe}from"./chunk-O5I3QTYU-BAljWov7.js";import{u as yt}from"./chunk-R6AK6OQ4-hKOrgTSc.js";import"./app-oK5kS90f.js";import"./useHasTabbableChild-BfOlYtlO.js";import"./chunk-7F3ZLNJ6-tQFOhPat.js";import"./index-CokAva9Y.js";const Vt=({handleDateChange:M,selectedDate:p,updateTimeSheet:le,externalFilterData:$,externalEmployee:I})=>{var De,Ee,Me;const{auth:y}=Le().props,{url:N}=Le();ct();const m=ze("(min-width: 1025px)"),L=ze("(min-width: 641px) and (max-width: 1024px)"),[v,Z]=l.useState([]),[h,d]=l.useState([]),[C,A]=l.useState([]),[Y,ee]=l.useState(""),[k,te]=l.useState(0),[G,re]=l.useState(0),[W,_t]=l.useState(10),[U,fe]=l.useState(1),[J,xe]=l.useState(I||""),[ae,K]=l.useState(!1),[Ze,et]=l.useState(0),[St,be]=l.useState(null),[we,Ct]=l.useState(!0),[ie,Ne]=l.useState(new Date),ye=l.useRef(null),ve=l.useRef($||{currentMonth:E().format("YYYY-MM")}),[g,_e]=l.useState($||{currentMonth:E().format("YYYY-MM")}),V=l.useCallback(async()=>{try{return K(!1),await Ce(p,U,W,J,g,!0),Ne(new Date),!0}catch(t){return console.error("Error refreshing timesheet:",t),!1}finally{K(!0)}},[p,U,W,J,g]),ce=l.useCallback(async()=>{if(console.log("Checking for timesheet updates..."),!!p)try{const t=route("check-timesheet-updates",{date:p.split("T")[0],month:g.currentMonth}),i=await fetch(t);if(!i.ok)throw new Error(`HTTP ${i.status}: Failed to check for updates`);const o=await i.json();o.success&&o.last_updated!==ye.current&&o.last_updated&&(ye.current=o.last_updated,V(),be(new Date)),Ne(new Date)}catch(t){console.error("Error checking for timesheet updates:",t)}},[p,g.currentMonth]);l.useEffect(()=>{if(!we)return;ce();const t=setInterval(ce,5e3);return()=>clearInterval(t)},[we,ce]);const Se=l.useMemo(()=>ie?ie.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!0}):null,[ie]);l.useEffect(()=>{JSON.stringify(g)!==JSON.stringify(ve.current)&&(ve.current={...g},V())},[g,V]),l.useCallback(()=>{et(t=>t+1),V()},[V]);const Ce=async(t,i,o,b,f,n=!1)=>{var _,D;const u=N!=="/attendance-employee"?route("admin.getPresentUsersForDate"):route("getCurrentUserAttendanceForDate");try{K(!1);const x=await Re.get(u,{params:{page:i,perPage:o,employee:b,date:t,currentYear:f!=null&&f.currentMonth?E(f.currentMonth).year():"",currentMonth:f!=null&&f.currentMonth?E(f.currentMonth).format("MM"):"",_t:n?Date.now():void 0}});x.status===200&&(Z(x.data.attendances||[]),te(x.data.total||0),re(x.data.last_page||1),fe(x.data.current_page||1),be(new Date),ee(""),K(!0))}catch(x){ee(((D=(_=x.response)==null?void 0:_.data)==null?void 0:D.message)||"An error occurred while retrieving present users data."),K(!0)}},tt=async(t,i)=>{if(N==="/attendance-employee"){A([]),d([]);return}try{const o=await Re.get(route("admin.getAbsentUsersForDate"),{params:{date:t}});o.status===200&&(A(o.data.absent_users||[]),d(o.data.leaves||[]))}catch(o){console.error("Error fetching absent users:",o),A([]),d([])}},rt=t=>{xe(t.target.value.toLowerCase())},ke=t=>{fe(t)};l.useCallback((t,i)=>{_e(o=>({...o,[t]:i}))},[]);const Q=t=>h.find(i=>String(i.user_id)===String(t)),T=(t,i)=>{if(!t)return null;try{let o;if(typeof t=="string")if(t.match(/^\d{2}:\d{2}:\d{2}$/)){const b=`${i}T${t}`;o=new Date(b)}else if(t.includes("T")||t.includes(" "))o=new Date(t);else if(t.match(/^\d{2}:\d{2}$/)){const b=`${i}T${t}:00`;o=new Date(b)}else o=new Date(`${i}T${t}`);else o=new Date(t);return isNaN(o.getTime())?(console.warn("Invalid time data:",t),"Invalid time"):o.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})}catch(o){return console.warn("Error formatting time:",{timeString:t,date:i,error:o}),"Invalid time"}},X=((De=y.permissions)==null?void 0:De.includes("attendance.view"))||!1,at=((Ee=y.permissions)==null?void 0:Ee.includes("attendance.manage"))||!1,st=((Me=y.permissions)==null?void 0:Me.includes("attendance.export"))||at||!1,R=l.useMemo(()=>C,[C]),Pe=[{name:"Date",uid:"date",icon:oe},...X&&N!=="/attendance-employee"?[{name:"Employee",uid:"employee",icon:ge}]:[],{name:"Clock In",uid:"clockin_time",icon:w},{name:"Clock Out",uid:"clockout_time",icon:w},{name:"Work Hours",uid:"production_time",icon:w},{name:"Punches",uid:"punch_details",icon:w}],$e=(t,i)=>{var b,f,n;const o=new Date(t.date).toDateString()===new Date().toDateString();switch(i){case"date":return e(P,{className:"text-xs sm:text-sm md:text-base",children:r(s,{className:"flex items-center gap-2",children:[e(oe,{className:"w-4 h-4 text-primary"}),e(s,{className:"flex flex-col",children:e("span",{children:new Date(t.date).toLocaleString("en-US",{month:"short",day:"numeric",year:"numeric"})})})]})});case"employee":return e(P,{className:"whitespace-nowrap text-xs sm:text-sm md:text-base",children:e(yt,{avatarProps:{radius:"lg",size:m||L?"md":"sm",src:(b=t.user)==null?void 0:b.profile_image,fallback:e(ge,{className:"w-6 h-6"})},description:(f=t.user)==null?void 0:f.phone,name:(n=t.user)==null?void 0:n.name})});case"clockin_time":return e(P,{className:"text-xs sm:text-sm md:text-base",children:r(s,{className:"flex items-center gap-2",children:[e(w,{className:"w-4 h-4 text-success"}),r(s,{className:"flex flex-col",children:[e("span",{children:t.punchin_time?T(t.punchin_time,t.date)||"Invalid time":"Not clocked in"}),t.punchin_time&&e("span",{className:"text-xs text-default-500",children:"First punch"})]})]})});case"clockout_time":return e(P,{className:"text-xs sm:text-sm md:text-base",children:r(s,{className:"flex items-center gap-2",children:[e(w,{className:"w-4 h-4 text-danger"}),r(s,{className:"flex flex-col",children:[e("span",{children:t.punchout_time?T(t.punchout_time,t.date)||"Invalid time":t.punchin_time?o?"Still working":"Not Punched Out":"Not started"}),t.punchout_time&&e("span",{className:"text-xs text-default-500",children:"Last punch"})]})]})});case"production_time":const _=t.total_work_minutes>0,D=t.has_incomplete_punch,x=t.punchin_time&&!t.punchout_time&&o;if(_){const z=Math.floor(t.total_work_minutes/60),q=Math.floor(t.total_work_minutes%60);return e(P,{className:"text-xs sm:text-sm md:text-base",children:r(s,{className:"flex items-center gap-2",children:[e(w,{className:`w-4 h-4 ${D?"text-warning":"text-primary"}`}),r(s,{className:"flex flex-col",children:[e("span",{className:"font-medium",children:`${z}h ${q}m`}),e("span",{className:"text-xs text-default-500",children:D?"Partial + In Progress":"Total worked"})]})]})})}else{if(x)return e(P,{className:"text-xs sm:text-sm md:text-base",children:r(s,{className:"flex items-center gap-2",children:[e(w,{className:"w-4 h-4 text-warning"}),r(s,{className:"flex flex-col",children:[e("span",{className:"text-warning",children:"In Progress"}),e("span",{className:"text-xs text-default-500",children:"Currently working"})]})]})});if(t.punchin_time&&!t.punchout_time&&!o)return e(P,{className:"text-xs sm:text-sm md:text-base",children:r(s,{className:"flex items-center gap-2",children:[e(O,{className:"w-4 h-4 text-danger"}),r(s,{className:"flex flex-col",children:[e("span",{className:"text-danger",children:"Incomplete punch"}),e("span",{className:"text-xs text-default-500",children:"Missing punch out"})]})]})})}return e(P,{className:"text-xs sm:text-sm md:text-base",children:r(s,{className:"flex items-center gap-2",children:[e(O,{className:"w-4 h-4 text-warning"}),r(s,{className:"flex flex-col",children:[e("span",{className:"text-warning",children:"No work time"}),e("span",{className:"text-xs text-default-500",children:"No attendance"})]})]})});case"punch_details":return e(P,{className:"text-xs sm:text-sm md:text-base",children:r(s,{className:"flex items-center gap-2",children:[e(w,{className:"w-4 h-4 text-default-400"}),r(s,{className:"flex flex-col",children:[r("span",{className:"text-xs font-medium",children:[t.punch_count||0," punch",(t.punch_count||0)!==1?"es":""]}),t.complete_punches!==t.punch_count&&r("span",{className:"text-xs text-warning",children:[t.complete_punches," complete"]}),t.complete_punches===t.punch_count&&t.punch_count>0&&e("span",{className:"text-xs text-success",children:"All complete"})]})]})});default:return e(P,{className:"text-xs sm:text-sm md:text-base",children:"N/A"})}},nt=l.useCallback(()=>{try{const t=[];v.forEach((a,S)=>{var Ae,Te,Fe,Ie;const j=Math.floor(a.total_work_minutes/60),se=Math.floor(a.total_work_minutes%60),me=a.total_work_minutes>0?`${j}h ${se}m`:a.has_incomplete_punch?"In Progress":"No work time",H=a.complete_punches===a.punch_count&&a.punch_count>0?"Complete":a.has_incomplete_punch?"In Progress":"Incomplete";t.push({"No.":t.length+1,Date:new Date(a.date).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),"Employee Name":((Ae=a.user)==null?void 0:Ae.name)||"N/A","Employee ID":((Te=a.user)==null?void 0:Te.employee_id)||"N/A",Designation:((Fe=a.user)==null?void 0:Fe.designation_name)||"N/A",Phone:((Ie=a.user)==null?void 0:Ie.phone)||"N/A","Clock In":a.punchin_time?T(a.punchin_time,a.date)||"Invalid time":"Not clocked in","Clock Out":a.punchout_time?T(a.punchout_time,a.date)||"Invalid time":a.punchin_time?new Date(a.date).toDateString()===new Date().toDateString()?"Still working":"Not Punched Out":"Not started","Work Hours":me,"Total Punches":a.punch_count||0,"Complete Punches":a.complete_punches||0,Status:H,Remarks:H==="Complete"?"Present - All punches complete":H==="In Progress"?"Present - Currently working":"Present - Incomplete punches"})}),R.forEach(a=>{const S=Q(a.id);let j="Absent without leave";if(S){const se=S.from_date===S.to_date?S.from_date:`${S.from_date} to ${S.to_date}`;j=`On ${S.leave_type} Leave (${se}) - Status: ${S.status}`}t.push({"No.":t.length+1,Date:new Date(p).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),"Employee Name":a.name||"N/A","Employee ID":a.employee_id||"N/A",Designation:a.designation_name||"N/A",Phone:a.phone||"N/A","Clock In":"Absent","Clock Out":"Absent","Work Hours":"0h 0m","Total Punches":0,"Complete Punches":0,Status:"Absent",Remarks:j})});const i=ne.book_new(),b=[[N==="/attendance-employee"?`Employee Timesheet - ${new Date(g.currentMonth).toLocaleString("en-US",{month:"long",year:"numeric"})}`:`Daily Timesheet - ${new Date(p).toLocaleString("en-US",{month:"long",day:"numeric",year:"numeric"})}`],[`Generated on: ${new Date().toLocaleString("en-US")}`],[`Total Employees: ${t.length} (Present: ${k}, Absent: ${R.length})`],[],["No.","Date","Employee Name","Employee ID","Designation","Phone","Clock In","Clock Out","Work Hours","Total Punches","Complete Punches","Status","Remarks"]],f=t.map(a=>[a["No."],a.Date,a["Employee Name"],a["Employee ID"],a.Designation,a.Phone,a["Clock In"],a["Clock Out"],a["Work Hours"],a["Total Punches"],a["Complete Punches"],a.Status,a.Remarks]),n=[...b,...f],u=ne.aoa_to_sheet(n),_=[{wch:5},{wch:12},{wch:20},{wch:12},{wch:20},{wch:15},{wch:12},{wch:12},{wch:12},{wch:12},{wch:15},{wch:12},{wch:40}];u["!cols"]=_,u["!merges"]=[{s:{r:0,c:0},e:{r:0,c:12}},{s:{r:1,c:0},e:{r:1,c:12}},{s:{r:2,c:0},e:{r:2,c:12}}];const D={font:{bold:!0,sz:16},alignment:{horizontal:"center"}};u.A1&&(u.A1.s=D);const x=["A5","B5","C5","D5","E5","F5","G5","H5","I5","J5","K5","L5","M5"];x.forEach(a=>{u[a]&&(u[a].s={font:{bold:!0},fill:{fgColor:{rgb:"E3F2FD"}},alignment:{horizontal:"center"}})});const z=6;t.forEach((a,S)=>{const j=z+S;a.Status==="Absent"&&x.forEach((se,me)=>{const H=ne.encode_cell({r:j-1,c:me});u[H]&&(u[H].s={fill:{fgColor:{rgb:"FFEBEE"}},font:{color:{rgb:"D32F2F"}}})})}),ne.book_append_sheet(i,u,"Timesheet");const q=N==="/attendance-employee"?`Employee_Timesheet_${E(g.currentMonth).format("YYYY_MM")}.xlsx`:`Daily_Timesheet_${E(p).format("YYYY_MM_DD")}.xlsx`;pt(i,q)}catch(t){console.error("Error generating Excel file:",t),alert("Error generating Excel file. Please try again.")}},[v,R,p,g,N,Q,T]),ot=l.useCallback(()=>{try{const t=new gt,i=N==="/attendance-employee"?`Employee Timesheet - ${new Date(g.currentMonth).toLocaleString("en-US",{month:"long",year:"numeric"})}`:`Daily Timesheet - ${new Date(p).toLocaleString("en-US",{month:"long",day:"numeric",year:"numeric"})}`;t.setFontSize(18),t.setFont("helvetica","bold"),t.text(i,t.internal.pageSize.getWidth()/2,20,{align:"center"}),t.setFontSize(10),t.setFont("helvetica","normal"),t.text(`Generated on: ${new Date().toLocaleString("en-US")}`,14,35),t.text(`Total Employees: ${v.length+R.length} (Present: ${k}, Absent: ${R.length})`,14,42);const o=[];v.forEach((n,u)=>{var a;const _=Math.floor(n.total_work_minutes/60),D=Math.floor(n.total_work_minutes%60),x=n.total_work_minutes>0?`${_}h ${D}m`:n.has_incomplete_punch?"In Progress":"No work time",z=n.complete_punches===n.punch_count&&n.punch_count>0?"Complete":n.has_incomplete_punch?"In Progress":"Incomplete",q=z==="Complete"?"Present - All complete":z==="In Progress"?"Present - Working":"Present - Incomplete";o.push([o.length+1,new Date(n.date).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),((a=n.user)==null?void 0:a.name)||"N/A",n.punchin_time?T(n.punchin_time,n.date)||"Invalid time":"Not clocked in",n.punchout_time?T(n.punchout_time,n.date)||"Invalid time":n.punchin_time?new Date(n.date).toDateString()===new Date().toDateString()?"Still working":"Not Punched Out":"Not started",x,`${n.complete_punches}/${n.punch_count}`,q])}),R.forEach(n=>{const u=Q(n.id);let _="Absent without leave";u&&(_=`On ${u.leave_type} Leave - ${u.status}`),o.push([o.length+1,new Date(p).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),n.name||"N/A","Absent","Absent","0h 0m","0/0",_])}),ft(t,{head:[["No.","Date","Employee","Clock In","Clock Out","Work Hours","Punches","Remarks"]],body:o,startY:50,theme:"grid",styles:{fontSize:7,cellPadding:2,lineColor:[200,200,200],lineWidth:.5},headStyles:{fillColor:[66,139,202],textColor:[255,255,255],fontStyle:"bold",fontSize:8},alternateRowStyles:{fillColor:[245,245,245]},columnStyles:{0:{cellWidth:12,halign:"center"},1:{cellWidth:20},2:{cellWidth:30},3:{cellWidth:20},4:{cellWidth:20},5:{cellWidth:18},6:{cellWidth:15,halign:"center"},7:{cellWidth:35}},margin:{top:10,left:14,right:14},didParseCell:function(n){if(n.row.index>=0){const u=o[n.row.index];u&&u[7]&&(u[7].includes("Absent")||u[7].includes("Leave"))&&(n.cell.styles.fillColor=[255,235,238],n.cell.styles.textColor=[211,47,47])}}});const b=t.internal.getNumberOfPages();for(let n=1;n<=b;n++)t.setPage(n),t.setFontSize(8),t.setFont("helvetica","normal"),t.text(`Page ${n} of ${b}`,t.internal.pageSize.getWidth()-30,t.internal.pageSize.getHeight()-10),t.text("Generated by Glass ERP System",14,t.internal.pageSize.getHeight()-10);const f=N==="/attendance-employee"?`Employee_Timesheet_${E(g.currentMonth).format("YYYY_MM")}.pdf`:`Daily_Timesheet_${E(p).format("YYYY_MM_DD")}.pdf`;t.save(f)}catch(t){console.error("Error generating PDF file:",t),alert("Error generating PDF file. Please try again.")}},[v,R,p,g,N,Q,T]);return l.useEffect(()=>{Ce(p,U,W,J,g),tt(p)},[p,U,W,J,g,le,Ze]),l.useEffect(()=>{$&&_e($)},[$]),l.useEffect(()=>{I!==void 0&&xe(I)},[I]),N==="/attendance-employee"?e(s,{role:"region","aria-label":"Attendance data table",className:"w-full",children:Y?e(Ye,{className:"p-4 bg-danger-50 border-danger-200",children:r(s,{className:"flex items-center gap-3",children:[e(O,{className:"w-5 h-5 text-danger"}),e(c,{color:"error",variant:"body1",children:Y})]})}):r(he,{children:[e(je,{orientation:"horizontal",className:"overflow-y-hidden",children:e(Ge,{className:"rounded-lg",isLoaded:ae,children:r(Je,{selectionMode:"multiple",selectionBehavior:"toggle",isCompact:!0,removeWrapper:!0,"aria-label":"Employee attendance timesheet table",isHeaderSticky:!0,classNames:{base:"max-h-[520px] overflow-scroll",table:"min-h-[200px]"},children:[e(Ke,{columns:Pe,children:t=>e(Ve,{align:"start",children:r(s,{className:"flex items-center gap-2",children:[t.icon&&e(t.icon,{className:"w-4 h-4"}),e("span",{className:"text-sm font-medium",children:t.name})]})},t.uid)}),e(Qe,{items:v,emptyContent:r(s,{className:"flex flex-col items-center justify-center py-8",children:[e(w,{className:"w-12 h-12 text-default-300 mb-4"}),e(c,{variant:"body1",color:"textSecondary",children:"No attendance records found"})]}),children:t=>e(Xe,{children:i=>$e(t,i)},t.id||t.user_id)})]})})}),k>W&&e(s,{className:"py-4 flex justify-center",children:e(qe,{initialPage:1,isCompact:!0,showControls:!0,showShadow:!0,color:"primary",variant:"bordered",page:U,total:G,onChange:ke,"aria-label":"Timesheet pagination"})})]})}):e(s,{sx:{display:"flex",justifyContent:"center",p:2},component:"main",role:"main","aria-label":"Timesheet Management",children:e(F,{container:!0,spacing:2,children:e(F,{item:!0,xs:12,children:e(mt,{in:!0,timeout:500,children:r(ht,{children:[e(bt,{className:"bg-gradient-to-br from-slate-50/50 to-white/30 backdrop-blur-sm border-b border-white/20",title:e("div",{className:`${m?"p-6":L?"p-4":"p-3"}`,children:r("div",{className:"flex flex-col space-y-4",children:[r("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4",children:[r("div",{className:"flex items-center gap-3 lg:gap-4",children:[e("div",{className:`
                                                        ${m?"p-3":L?"p-2.5":"p-2"} 
                                                        rounded-xl bg-gradient-to-br from-[rgba(var(--theme-primary-rgb),0.2)] to-[rgba(var(--theme-secondary-rgb),0.2)] border border-[rgba(var(--theme-primary-rgb),0.3)] backdrop-blur-sm
                                                    `,children:e(w,{className:`
                                                                ${m?"w-8 h-8":L?"w-6 h-6":"w-5 h-5"}
                                                            `,style:{color:"var(--theme-primary)"}})}),r("div",{className:"min-w-0 flex-1",children:[e(c,{variant:m?"h4":L?"h5":"h6",className:`
                                                                font-bold bg-gradient-to-r from-[var(--theme-primary)] to-[var(--theme-secondary)] bg-clip-text text-transparent
                                                                ${m?"":"truncate"}
                                                            `,style:{fontFamily:"var(--font-current)",transition:"all var(--transition)"},children:"Daily Timesheet"}),e(c,{variant:m?"body2":"caption",color:"textSecondary",className:m?"":"truncate",style:{fontFamily:"var(--font-current)",transition:"all var(--transition)"},children:new Date(p).toLocaleString("en-US",{month:m?"long":"short",day:"numeric",year:m?"numeric":void 0})})]})]}),"                                                ",r("div",{className:"flex items-center gap-4",children:[Se&&r(c,{variant:"caption",color:"textSecondary",sx:{fontSize:"0.75rem",display:{xs:"block",sm:"block"}},children:["Updated: ",Se]}),e("div",{className:"flex items-center gap-2",children:st&&r(he,{children:[e(We,{color:"success",variant:"flat",size:m?"md":"sm",startContent:e(Oe,{className:`
                                                                            ${m?"w-4 h-4":"w-3.5 h-3.5"}
                                                                        `}),className:"bg-gradient-to-r from-[rgba(var(--theme-success-rgb),0.1)] to-[rgba(var(--theme-success-rgb),0.2)] hover:from-[rgba(var(--theme-success-rgb),0.2)] hover:to-[rgba(var(--theme-success-rgb),0.3)] border border-[rgba(var(--theme-success-rgb),0.2)] backdrop-blur-sm",onPress:nt,isDisabled:!ae||v.length===0,style:{fontFamily:"var(--font-current)",transition:"all var(--transition)"},children:m?"Excel":"XLS"}),e(We,{color:"danger",variant:"flat",size:m?"md":"sm",startContent:e(Oe,{className:`
                                                                            ${m?"w-4 h-4":"w-3.5 h-3.5"}
                                                                        `}),className:"bg-gradient-to-r from-[rgba(var(--theme-danger-rgb),0.1)] to-[rgba(var(--theme-danger-rgb),0.2)] hover:from-[rgba(var(--theme-danger-rgb),0.2)] hover:to-[rgba(var(--theme-danger-rgb),0.3)] border border-[rgba(var(--theme-danger-rgb),0.2)] backdrop-blur-sm",onPress:ot,isDisabled:!ae||v.length===0,style:{fontFamily:"var(--font-current)",transition:"all var(--transition)"},children:"PDF"})]})})]})]}),m&&r("div",{className:"flex items-center gap-6 pt-2 border-t border-white/10",children:[r("div",{className:"flex items-center gap-2",children:[e(B,{className:"w-4 h-4 text-success"}),r(c,{variant:"caption",color:"textSecondary",children:["Present: ",k]})]}),X&&r("div",{className:"flex items-center gap-2",children:[e(O,{className:"w-4 h-4 text-warning"}),r(c,{variant:"caption",color:"textSecondary",children:["Absent: ",C.length]})]}),r("div",{className:"flex items-center gap-2",children:[e(de,{className:"w-4 h-4 text-primary"}),r(c,{variant:"caption",color:"textSecondary",children:["Total: ",k+C.length]})]})]})]})}),sx:{padding:0,"& .MuiCardHeader-content":{width:"100%",overflow:"hidden"}}}),e(Ue,{}),e(Be,{children:e(s,{component:"section",role:"search","aria-label":"Timesheet filters",children:e(F,{container:!0,spacing:3,children:X&&r(he,{children:[e(F,{item:!0,xs:12,sm:6,md:4,children:e(ue,{type:"text",label:"Search Employee",placeholder:"Enter employee name",value:J,onChange:rt,startContent:e(pe,{className:"w-4 h-4 text-default-400"}),variant:"bordered","aria-label":"Search employees",classNames:{inputWrapper:"bg-white/10 backdrop-blur-md border-white/20 hover:bg-white/15"}})}),e(F,{item:!0,xs:12,sm:6,md:4,children:e(ue,{label:"Select Date",type:"date",variant:"bordered",onChange:M,value:new Date(p).toISOString().slice(0,10)||"",startContent:e(oe,{className:"w-4 h-4 text-default-400"}),"aria-label":"Select date for timesheet",classNames:{inputWrapper:"bg-white/10 backdrop-blur-md border-white/20 hover:bg-white/15"}})})]})})})}),e(Ue,{}),e(Be,{children:r(F,{container:!0,spacing:3,children:[e(F,{item:!0,xs:12,md:X?9:12,children:Y?e(Ye,{className:"p-4 bg-danger-50 border-danger-200",children:r(s,{className:"flex items-center gap-3",children:[e(O,{className:"w-5 h-5 text-danger"}),e(c,{color:"error",variant:"body1",children:Y})]})}):r(s,{role:"region","aria-label":"Present employees attendance table",className:"border-r border-gray-200 pr-4",sx:{borderRightColor:"rgba(0, 0, 0, 0.1)"},children:[e(s,{className:"mb-4",children:r(c,{variant:"h6",className:"font-semibold text-blue-600 flex items-center gap-2",children:[e(B,{className:"w-5 h-5"}),"Present Employees (",k,")"]})}),e(je,{orientation:"horizontal",className:"overflow-y-hidden",children:e(Ge,{className:"rounded-lg",isLoaded:ae,children:r(Je,{selectionMode:"multiple",selectionBehavior:"toggle",isCompact:!0,removeWrapper:!0,"aria-label":"Employee attendance timesheet table",isHeaderSticky:!0,classNames:{base:"max-h-[520px] overflow-scroll",table:"min-h-[200px]"},children:[e(Ke,{columns:Pe,children:t=>e(Ve,{align:"start",children:r(s,{className:"flex items-center gap-2",children:[t.icon&&e(t.icon,{className:"w-4 h-4"}),e("span",{className:"text-sm font-medium",children:t.name})]})},t.uid)}),e(Qe,{items:v,emptyContent:r(s,{className:"flex flex-col items-center justify-center py-8",children:[e(w,{className:"w-12 h-12 text-default-300 mb-4"}),e(c,{variant:"body1",color:"textSecondary",children:"No attendance records found"})]}),children:t=>e(Xe,{children:i=>$e(t,i)},t.id||t.user_id)})]})})}),k>W&&e(s,{className:"py-4 flex justify-center",children:e(qe,{initialPage:1,isCompact:!0,showControls:!0,showShadow:!0,color:"primary",variant:"bordered",page:U,total:G,onChange:ke,"aria-label":"Timesheet pagination"})})]})}),X&&e(F,{item:!0,xs:12,md:3,children:e(vt,{absentUsers:C,selectedDate:p,getUserLeave:Q})})]})})]})})})})})},vt=lt.memo(({absentUsers:M,selectedDate:p,getUserLeave:le})=>{const[$,I]=l.useState(5),[y,N]=l.useState(""),m=l.useMemo(()=>{if(!y.trim())return M;const h=y.toLowerCase();return M.filter(d=>{var k,te,G,re;const C=((k=d.name)==null?void 0:k.toLowerCase())||"",A=((te=d.employee_id)==null?void 0:te.toString().toLowerCase())||"",Y=((G=d.email)==null?void 0:G.toLowerCase())||"",ee=((re=d.phone)==null?void 0:re.toString().toLowerCase())||"";return C.includes(h)||A.includes(h)||Y.includes(h)||ee.includes(h)})},[M,y]),L=()=>{I(h=>h+5)},v=h=>{N(h.target.value),I(5)},Z=h=>{switch(h==null?void 0:h.toLowerCase()){case"approved":return e(B,{className:"w-4 h-4 text-success"});case"rejected":return e(Nt,{className:"w-4 h-4 text-danger"});default:return e(w,{className:"w-4 h-4 text-warning"})}};return M.length===0?r(s,{className:"h-full",children:[e(xt,{title:"Perfect Attendance!",subtitle:`No employees are absent on ${E(p).format("MMMM D, YYYY")}`,icon:e(B,{className:"w-6 h-6"}),variant:"gradient",actionButtons:[{label:"0",variant:"flat",color:"success",icon:e(B,{className:"w-4 h-4"}),className:"bg-green-500/10 text-green-500 border-green-500/20"}]}),r(s,{role:"region","aria-label":"No absent employees today",className:"text-center py-12 bg-white/10 backdrop-blur-md border border-white/20 rounded-lg h-96 flex flex-col items-center justify-center",children:[e(B,{className:"w-12 h-12 text-success mx-auto mb-4"}),e(c,{variant:"body2",color:"success",className:"mb-2 text-sm font-medium",children:"Perfect Attendance!"}),e(c,{variant:"caption",color:"textSecondary",className:"text-xs",children:"No employees are absent today."}),e(c,{variant:"caption",color:"textSecondary",className:"mt-1 block text-xs",children:"All employees are either present or on approved leave."})]})]}):r(s,{className:"h-full",children:[r(s,{className:"mb-4 flex items-center justify-between",children:[r(c,{variant:"h6",className:"font-semibold text-orange-600 flex items-center gap-2 text-sm",children:[e(de,{className:"w-4 h-4"}),"Absent Today"]}),e(dt,{label:M.length,variant:"outlined",color:"warning",size:"small",className:"font-semibold",avatar:e(He,{sx:{width:18,height:18,bgcolor:"warning.main",color:"warning.contrastText",fontSize:"0.75rem",marginRight:"-4px"},children:e(de,{style:{width:12,height:12}})})})]}),e(s,{className:"mb-3 m-2",children:e(ue,{type:"text",placeholder:"Search absent employees...",value:y,onChange:v,startContent:e(pe,{className:"w-4 h-4 text-default-400"}),variant:"bordered","aria-label":"Search absent employees",classNames:{inputWrapper:"bg-white/10 backdrop-blur-md border-white/20 hover:bg-white/15 h-10",input:"text-sm"}})}),y&&e(s,{className:"mb-2 ",children:r(c,{variant:"caption",color:"textSecondary",className:"text-xs",children:[m.length," of ",M.length," employees found"]})}),y&&m.length===0&&r(s,{className:"text-center py-8 bg-white/10 backdrop-blur-md border border-white/20 rounded-lg",children:[e(pe,{className:"w-8 h-8 text-default-300 mx-auto mb-2"}),r(c,{variant:"body2",color:"textSecondary",className:"text-sm",children:['No employees found matching "',y,'"']})]}),r(s,{role:"region","aria-label":"Absent employees list",className:"overflow-y-auto max-h-[520px]",children:[m.slice(0,$).map(h=>{var C,A;const d=le(h.id);return e(ut,{in:!0,timeout:"auto",children:e("div",{className:"p-3 m-2 bg-white/10 backdrop-blur-md border border-white/20 hover:bg-white/15 transition-all duration-200 rounded-lg",children:r(s,{className:"flex items-start justify-between",children:[r(s,{className:"flex items-center gap-2 flex-1",children:[e(He,{src:h.profile_image,alt:h.name,size:"sm",fallback:e(ge,{className:"w-4 h-4"})}),r(s,{className:"flex-1 min-w-0",children:["                                            ",e(c,{variant:"body2",fontWeight:"medium",className:"truncate text-sm",children:h.name}),h.employee_id&&r(c,{variant:"caption",color:"textSecondary",className:"block text-xs",children:["ID: ",h.employee_id]}),d?r(s,{className:"flex flex-col gap-1 mt-1",children:[r(c,{variant:"caption",color:"textSecondary",className:"flex items-center gap-1 text-xs",children:[e(oe,{className:"w-3 h-3"}),d.from_date===d.to_date?d.from_date:`${d.from_date} - ${d.to_date}`]}),r(c,{variant:"caption",color:"primary",className:"flex items-center gap-1 text-xs",children:[Z(d.status),d.leave_type," Leave"]})]}):r(c,{variant:"caption",color:"error",className:"flex items-center gap-1 mt-1 text-xs",children:[e(O,{className:"w-3 h-3"}),"Absent without leave"]})]})]}),d&&e("div",{className:"bg-white/20 backdrop-blur-md border border-white/30 rounded-md px-1.5 py-0.5 ml-2",children:r("div",{className:"flex items-center gap-1",children:[Z(d.status),e(c,{variant:"caption",className:`font-semibold text-xs ${((C=d.status)==null?void 0:C.toLowerCase())==="approved"?"text-green-600":((A=d.status)==null?void 0:A.toLowerCase())==="rejected"?"text-red-600":"text-orange-600"}`,children:d.status})]})})]})})},h.id)}),$<m.length&&e(s,{className:"text-center mt-4 pb-4",children:r(wt,{variant:"outlined",onClick:L,startIcon:e(it,{className:"w-4 h-4"}),size:"small",color:"warning",fullWidth:!0,children:["Show More (",m.length-$," remaining)"]})})]})]})});export{Vt as default};
