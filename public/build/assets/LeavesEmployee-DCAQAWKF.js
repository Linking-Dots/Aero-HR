import{r as ee,a as e,j as l,B as $,F as T,q as ae,Y as te,G as O}from"./app-HL7awkdu.js";import{i as re,j as le,v as q,A as oe,E as H,H as d,J as se,f as B,T as _,R as ne,V as ie,c as j,z as de,U as ce,r as s,D as Y,G as g,F as pe,P as ue,S as he,Q as z,W as me,b as S,K as J,L as K,t as Q,X as ye,e as xe,O as fe,B as A,a as W}from"./vendor-CS-pJSya.js";import{A as ge}from"./App-CGZDkcf7.js";import{d as be}from"./Edit-C0v8L0NL.js";import{d as ve}from"./Delete-ORGwSyrT.js";import{d as Ce,G as U}from"./GlassDialog-LQLjKUeX.js";import{L as we}from"./LoadingButton-0IeeBtOT.js";import{A as De}from"./Add-Dj2ts4TL.js";var G={},Se=re;Object.defineProperty(G,"__esModule",{value:!0});var V=G.default=void 0,Te=Se(ee()),_e=le;V=G.default=(0,Te.default)((0,_e.jsx)("path",{d:"M12 7c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5m0-5C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8"}),"RadioButtonChecked");const ke=({allLeaves:y,allUsers:c,handleClickOpen:u,setCurrentLeave:m,openModal:r})=>{const t=q();return e(ce,{style:{maxHeight:"84vh",overflowY:"auto"},children:l(de,{"aria-label":"leave employee table",children:[e(oe,{children:l(H,{children:[e(d,{sx:{whiteSpace:"nowrap"},children:"Leave Type"}),e(d,{sx:{whiteSpace:"nowrap"},children:"From"}),e(d,{sx:{whiteSpace:"nowrap"},children:"To"}),e(d,{sx:{whiteSpace:"nowrap"},children:"No of Days"}),e(d,{sx:{whiteSpace:"nowrap"},children:"Reason"}),e(d,{sx:{whiteSpace:"nowrap"},children:"Status"}),e(d,{sx:{whiteSpace:"nowrap"},children:"Approved by"}),e(d,{sx:{whiteSpace:"nowrap"},align:"center",children:"Actions"})]})}),e(se,{children:y.map(a=>l(H,{children:[e(d,{sx:{whiteSpace:"nowrap"},children:a.leave_type}),e(d,{sx:{whiteSpace:"nowrap"},children:new Date(a.from_date).toLocaleDateString("en-US",{day:"numeric",month:"short",year:"numeric"})}),e(d,{sx:{whiteSpace:"nowrap"},children:new Date(a.to_date).toLocaleDateString("en-US",{day:"numeric",month:"short",year:"numeric"})}),e(d,{sx:{whiteSpace:"nowrap"},children:a.no_of_days}),e(d,{sx:{whiteSpace:"nowrap"},children:a.reason}),e(d,{sx:{whiteSpace:"nowrap"},children:l(B,{variant:"outlined",color:"primary",sx:{borderRadius:"50px"},children:[e(V,{})," ",a.status]})}),e(d,{sx:{whiteSpace:"nowrap"},children:a.approved_by?l(_,{sx:{display:"flex",alignItems:"center",whiteSpace:"nowrap"},children:[e(ne,{src:c.find(o=>o.id===a.approved_by).avatar,alt:c.find(o=>o.id===a.approved_by).name}),e(_,{sx:{marginLeft:"10px"},children:e(ie,{href:"#",sx:{textDecoration:"none",color:t.palette.text.primary,fontWeight:"bold"},children:c.find(o=>o.id===a.approved_by).name})})]}):null}),l(d,{sx:{whiteSpace:"nowrap"},align:"center",children:[e(j,{sx:{m:1},variant:"outlined",color:"success",size:"small",onClick:()=>{m(a),r("edit_leave")},children:e(be,{})}),e(j,{sx:{m:1},variant:"outlined",color:"error",size:"small",onClick:()=>u(a.id,"delete_leave"),children:e(ve,{})})]})]},a.id))})]})})},N=({open:y,closeModal:c,leaveTypes:u,leaveCounts:m,setLeavesData:r,currentLeave:t})=>{const a=q(),[o,w]=s.useState((t==null?void 0:t.leave_type)||"Casual"),[p,L]=s.useState((t==null?void 0:t.from_date)||""),[v,k]=s.useState((t==null?void 0:t.to_date)||""),[F,E]=s.useState((t==null?void 0:t.no_of_days)||""),[I,x]=s.useState(""),[R,X]=s.useState((t==null?void 0:t.reason)||""),[h,Z]=s.useState({}),[M,P]=s.useState(!1);return s.useEffect(()=>{const n=m.find(C=>C.leave_type===o);x(n.remaining_days)},[o]),s.useEffect(()=>{E(((C,b)=>{if(!C||!b)return"";const f=new Date(C),i=new Date(b);if(f>i)return"";const D=i.getTime()-f.getTime();return Math.ceil(D/(1e3*3600*24))+1})(p,v))},[p,v]),l(U,{open:y,onClose:c,fullWidth:!0,maxWidth:"sm",children:[l(Y,{sx:{display:"flex",alignItems:"center"},children:[e(_,{variant:"h6",children:"Add Leave"}),e(j,{onClick:c,sx:{position:"absolute",top:8,right:16},children:e(Ce,{})})]}),l("form",{onSubmit:async n=>{n.preventDefault(),P(!0);const C=new Promise(async(b,f)=>{try{const i={leaveType:o,fromDate:p,toDate:v,daysCount:F,leaveReason:R};t&&(i.id=t.id);const D=await axios.post(route("leave-add"),i);D.status===200&&(r(D.data.leavesData),b([D.data.messages||"Leave application submitted successfully"]),c())}catch(i){P(!1),i.response?(i.response.status===422?(Z(i.response.data.errors||{}),f(i.response.statusText||"Failed to submit leave application")):f("An unexpected error occurred. Please try again later."),console.error(i.response)):i.request?(f("No response received from the server. Please check your internet connection."),console.error(i.request)):(f("An error occurred while setting up the request."),console.error("Error",i.message))}finally{P(!1)}});$.promise(C,{pending:{render(){return l("div",{style:{display:"flex",alignItems:"center"},children:[e(Q,{}),e("span",{style:{marginLeft:"8px"},children:"Submitting leave application..."})]})},icon:!1,style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:a.glassCard.backgroundColor,border:a.glassCard.border,color:a.palette.text.primary}},success:{render({data:b}){return e(T,{children:b.map((f,i)=>e("div",{children:f},i))})},icon:"ðŸŸ¢",style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:a.glassCard.backgroundColor,border:a.glassCard.border,color:a.palette.text.primary}},error:{render({data:b}){return e(T,{children:b})},icon:"ðŸ”´",style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:a.glassCard.backgroundColor,border:a.glassCard.border,color:a.palette.text.primary}}})},children:[e(J,{children:l(g,{container:!0,spacing:2,children:[e(g,{item:!0,xs:12,md:6,children:l(pe,{fullWidth:!0,children:[e(ue,{id:"leave-type-label",children:"Leave Type"}),l(he,{labelId:"leave-type-label",value:o,onChange:n=>w(n.target.value),label:"Leave Type",error:!!h.leaveType,children:[e(z,{value:"",disabled:!0,children:"Select Leave Type"}),u.map(n=>l(z,{value:n.type,children:[n.type," ",n.days," Days"]},n.id))]}),e(me,{children:h.leaveType})]})}),e(g,{item:!0,xs:12,md:6,children:e(S,{label:"From",type:"date",fullWidth:!0,value:p,onChange:n=>L(n.target.value),InputLabelProps:{shrink:!0},error:!!h.fromDate,helperText:h.fromDate})}),e(g,{item:!0,xs:12,md:6,children:e(S,{label:"To",type:"date",fullWidth:!0,value:v,onChange:n=>k(n.target.value),InputLabelProps:{shrink:!0},error:!!h.toDate,helperText:h.toDate})}),e(g,{item:!0,xs:12,md:6,children:e(S,{label:"Number of days",type:"text",fullWidth:!0,value:F,InputProps:{readOnly:!0},error:!!h.daysCount,helperText:h.daysCount})}),e(g,{item:!0,xs:12,md:6,children:e(S,{label:"Remaining Leaves",type:"text",fullWidth:!0,value:I,InputProps:{readOnly:!0},error:!!h.remainingLeaves,helperText:h.remainingLeaves})}),e(g,{item:!0,xs:12,children:e(S,{label:"Leave Reason",multiline:!0,rows:4,fullWidth:!0,value:R,onChange:n=>X(n.target.value),error:!!h.leaveReason,helperText:h.leaveReason})})]})}),e(K,{sx:{padding:"16px",justifyContent:"center"},children:e(we,{type:"submit",variant:"outlined",color:"primary",loading:M,disabled:M,sx:{borderRadius:"50px"},children:"Submit"})})]})]})},Fe=({open:y,handleClose:c,leaveIdToDelete:u,setLeavesData:m})=>{const r=q();return l(U,{open:y,onClose:c,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e(Y,{id:"alert-dialog-title",children:"Confirm Deletion"}),e(J,{children:e(ye,{id:"alert-dialog-description",children:"Are you sure you want to delete this leave? This action cannot be undone."})}),l(K,{children:[e(B,{onClick:c,color:"primary",children:"Cancel"}),e(B,{onClick:()=>{const a=new Promise(async(o,w)=>{try{const p=await axios.delete(route("leave-delete",{id:u}));p.status===200&&(m(p.data.leavesData),o("Leave application deleted successfully"))}catch(p){console.error("Error deleting task:",p),w(p.response.data.error||"Failed to delete leave application")}finally{c()}});$.promise(a,{pending:{render(){return l("div",{style:{display:"flex",alignItems:"center"},children:[e(Q,{}),e("span",{style:{marginLeft:"8px"},children:"Deleting leave application..."})]})},icon:!1,style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:r.glassCard.backgroundColor,border:r.glassCard.border,color:r.palette.text.primary}},success:{render({data:o}){return e(T,{children:o})},icon:"ðŸŸ¢",style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:r.glassCard.backgroundColor,border:r.glassCard.border,color:r.palette.text.primary}},error:{render({data:o}){return e(T,{children:o})},icon:"ðŸ”´",style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:r.glassCard.backgroundColor,border:r.glassCard.border,color:r.palette.text.primary}}})},color:"error",autoFocus:!0,children:"Delete"})]})]})},Ie=({title:y,allUsers:c})=>{const[u,m]=s.useState(null),[r,t]=s.useState(ae().props.leavesData),[a,o]=s.useState(r.allLeaves),[w,p]=s.useState(null),[L,v]=s.useState();s.useEffect(()=>{o(r.allLeaves)},[r]);const k=x=>{m(x)},F=s.useCallback((x,R)=>{p(x),m(R)},[]),E=s.useCallback(()=>{m(null),p(null)},[]),I=()=>{m(null)};return l(T,{children:[e(te,{title:y}),u==="add_leave"&&e(N,{open:u==="add_leave",setLeavesData:t,closeModal:I,leaveTypes:r.leaveTypes,leaveCounts:r.leaveCounts}),u==="edit_leave"&&e(N,{open:u==="edit_leave",setLeavesData:t,closeModal:I,leaveTypes:r.leaveTypes,leaveCounts:r.leaveCounts,currentLeave:L}),u==="delete_leave"&&e(Fe,{open:u==="delete_leave",handleClose:E,leaveIdToDelete:w,setLeavesData:t}),e(A,{sx:{display:"flex",justifyContent:"center",p:2},children:e(xe,{in:!0,children:l(O,{children:[e(fe,{title:"Leaves",sx:{padding:"24px"},action:e(A,{display:"flex",gap:2,children:e(B,{title:"Add Leave",variant:"outlined",color:"success",startIcon:e(De,{}),onClick:()=>k("add_leave"),children:"Add Leave"})})}),e(W,{children:e(g,{container:!0,spacing:2,children:r.leaveCounts.map(x=>e(g,{item:!0,xs:12,sm:6,md:3,children:e(O,{children:e(W,{children:e(A,{display:"flex",justifyContent:"center",alignItems:"center",height:"100%",textAlign:"center",children:l(A,{children:[e(_,{variant:"h6",children:x.leave_type}),e(_,{variant:"h4",children:x.days_used})]})})})})},x.leave_type))})}),e(W,{children:e(ke,{handleClickOpen:F,setCurrentLeave:v,openModal:k,allLeaves:a,allUsers:c})})]})})})]})};Ie.layout=y=>e(ge,{children:y});export{Ie as default};
