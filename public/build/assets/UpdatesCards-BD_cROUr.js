import{u as oe,r as y,l as V,a4 as ie,i as le,m as z,A as ce,J as de,j as e,b as r,c as J,a as me,R as ue}from"./app-CEzniZE0.js";import{aU as pe,aV as he,aW as fe,a9 as Z,f as P,B as s,T as m,F as T,c as M,m as ee,G as O,e as te,aH as ge,u as xe,d as Y,k as K,h as ve}from"./App-BDoHcQM2.js";import{d as _}from"./dayjs.min-DqKbmimS.js";import{F as ye}from"./ExclamationTriangleIcon-HFSGj02l.js";import{C as ae}from"./CardHeader-Da7U1Srw.js";import{D as q}from"./Divider-D_bvpplV.js";import{C as re}from"./CardContent-Bri4IZ89.js";import{P as we}from"./Popover-BWInbS9g.js";import{F as be}from"./XCircleIcon-CL455mkE.js";import{F as Ne}from"./CheckCircleIcon-DM5o0-iI.js";import{s as Q}from"./chunk-TLYTI3QM-CII-PgM5.js";import"./app-CENRN2EE.js";import"./dividerClasses-4vJzVDP3.js";function Se(b={}){const{as:L,ref:w,max:l=5,total:p,size:h,color:g,radius:o,children:n,isBordered:c,isDisabled:x,isGrid:d,renderCount:N,className:D,classNames:B,...R}=b,U=oe(w),j=L||"div",k=y.useMemo(()=>({size:h,color:g,radius:o,isGrid:d,isBordered:c,isDisabled:x}),[h,g,o,d,c,x]),G=y.useMemo(()=>pe({className:D,isGrid:d}),[D,d]),t=he(n),v=l?t.slice(0,l):t,F=p||(l!=null?t.length-l:-1),A=v.map((S,f)=>{const E=f===0,I=f===v.length-1,H={className:V(E?"ms-0":d?"":"-ms-2",I&&F<1?"hover:-translate-x-0":"")};return y.cloneElement(S,ie(H))});return{Component:j,context:k,remainingCount:F,clones:A,renderCount:N,getAvatarGroupProps:()=>({ref:U,className:G.base({class:V(B==null?void 0:B.base,D)}),role:"group",...R}),getAvatarGroupCountProps:()=>({className:G.count({class:B==null?void 0:B.count})})}}var se=le((b,L)=>{const{Component:w,clones:l,context:p,remainingCount:h,getAvatarGroupCountProps:g,getAvatarGroupProps:o,renderCount:n=c=>z.jsx(Z,{...g(),name:`+${c}`})}=Se({...b,ref:L});return z.jsx(w,{...o(),children:z.jsxs(fe,{value:p,children:[l,h>0&&n(h)]})})});se.displayName="HeroUI.AvatarGroup";var Ce=se,W={exports:{}},_e=W.exports,X;function Le(){return X||(X=1,function(b,L){(function(w,l){b.exports=l()})(_e,function(){return function(w,l,p){l.prototype.isBetween=function(h,g,o,n){var c=p(h),x=p(g),d=(n=n||"()")[0]==="(",N=n[1]===")";return(d?this.isAfter(c,o):!this.isBefore(c,o))&&(N?this.isBefore(x,o):!this.isAfter(x,o))||(d?this.isBefore(c,o):!this.isAfter(c,o))&&(N?this.isAfter(x,o):!this.isBefore(x,o))}}})}(W)),W.exports}var De=Le();const Be=ce(De);_.extend(Be);const Fe=({title:b,items:L,users:w,icon:l,color:p})=>{var U,j,k,G;const h=xe(),[g,o]=y.useState(null),[n,c]=y.useState(null),x=(t,v)=>{o(t.currentTarget),c(v)},d=()=>{o(null),c(null)},N=!!g,D=N?"leave-details-popover":void 0,B=t=>{switch(t==null?void 0:t.toLowerCase()){case"approved":return e(Ne,{className:"w-4 h-4 text-success"});case"rejected":return e(be,{className:"w-4 h-4 text-danger"});default:return e(M,{className:"w-4 h-4 text-warning"})}},R=t=>{switch(t==null?void 0:t.toLowerCase()){case"approved":return"success";case"rejected":return"danger";default:return"warning"}};return r(te,{sx:{height:"100%",display:"flex",flexDirection:"column"},children:[e(ae,{title:r(s,{className:"flex items-center gap-3",children:[e(s,{sx:{bgcolor:`${p}20`,borderRadius:"12px",p:1,display:"flex",alignItems:"center",justifyContent:"center",minWidth:40,minHeight:40},children:e(l,{style:{width:"20px",height:"20px",color:p,strokeWidth:2},"aria-hidden":"true"})}),e(m,{variant:"h6",component:"h2",sx:{fontSize:{xs:"1rem",sm:"1.1rem",md:"1.2rem"},fontWeight:600},children:b})]}),sx:{pb:1}}),e(q,{}),e(s,{sx:{flex:1,overflow:"auto"},children:L.map((t,v)=>r(ue.Fragment,{children:[e(O,{in:!0,timeout:300+v*100,children:r(re,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",py:2},children:[r(s,{sx:{display:"flex",flexDirection:"column",flex:1,mr:2},children:[e(m,{variant:"body2",color:"text.primary",sx:{fontSize:{xs:"0.875rem",sm:"1rem"},lineHeight:1.4},children:t.text}),t.leaves&&t.leaves.length>0&&r(m,{variant:"caption",color:"text.secondary",className:"flex items-center gap-1 mt-1",children:[e(ee,{className:"w-3 h-3"}),t.leaves.length," employee",t.leaves.length>1?"s":""]})]}),t.leaves&&(()=>{const F=t.leaves.filter(A=>A.leave_type===t.type);return F.length>0&&e(s,{sx:{display:"flex",gap:1,flexShrink:0},children:e(Ce,{max:4,isBordered:!0,size:"sm",children:F.map((A,a)=>{const i=w.find(S=>String(S.id)===String(A.user_id));return i&&e(Z,{src:i.profile_image,alt:`${i.name} - on leave`,onClick:S=>x(S,A),className:"cursor-pointer hover:scale-110 transition-transform",fallback:e(Y,{className:"w-4 h-4"})},a)})})})})()]})}),v<L.length-1&&e(q,{})]},v))}),e(we,{id:D,open:N,anchorEl:g,onClose:d,PaperProps:{sx:{backdropFilter:"blur(16px) saturate(200%)",background:((U=h.glassCard)==null?void 0:U.background)||"rgba(255, 255, 255, 0.9)",border:((j=h.glassCard)==null?void 0:j.border)||"1px solid rgba(255, 255, 255, 0.2)",borderRadius:2,boxShadow:((k=h.glassCard)==null?void 0:k.boxShadow)||"0 8px 32px 0 rgba(31, 38, 135, 0.37)",padding:2,minWidth:"300px"}},anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},role:"dialog","aria-labelledby":"leave-details-title","aria-describedby":"leave-details-content",children:n&&r(s,{component:"section","aria-labelledby":"leave-details-title",children:[r(m,{id:"leave-details-title",variant:"subtitle1",fontWeight:"600",className:"flex items-center gap-2 mb-3",children:[e(K,{className:"w-5 h-5 text-primary"}),"Leave Details"]}),r(s,{id:"leave-details-content",className:"space-y-2",children:[r(s,{className:"flex items-start gap-2",children:[e(Y,{className:"w-4 h-4 text-default-500 mt-0.5 flex-shrink-0"}),r(s,{children:[e(m,{variant:"caption",color:"text.secondary",component:"span",children:"Employee:"}),e(m,{variant:"body2",component:"div",fontWeight:"500",children:((G=w.find(t=>String(t.id)===String(n.user_id)))==null?void 0:G.name)||"Unknown"})]})]}),r(s,{className:"flex items-start gap-2",children:[e(T,{className:"w-4 h-4 text-default-500 mt-0.5 flex-shrink-0"}),r(s,{children:[e(m,{variant:"caption",color:"text.secondary",component:"span",children:"Duration:"}),e(m,{variant:"body2",component:"div",fontWeight:"500",children:n.from_date!==n.to_date?`${new Date(n.from_date).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})} - ${new Date(n.to_date).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}`:new Date(n.from_date).toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})})]})]}),r(s,{className:"flex items-start gap-2",children:[e(K,{className:"w-4 h-4 text-default-500 mt-0.5 flex-shrink-0"}),r(s,{children:[e(m,{variant:"caption",color:"text.secondary",component:"span",children:"Reason:"}),e(m,{variant:"body2",component:"div",fontWeight:"500",children:n.reason||"No reason provided"})]})]}),r(s,{className:"flex items-center gap-2",children:[B(n.status),r(s,{children:[e(m,{variant:"caption",color:"text.secondary",component:"span",children:"Status:"}),e(ve,{label:n.status||"Pending",variant:"flat",color:R(n.status),size:"sm",className:"ml-2"})]})]})]})]})})]})},Te=()=>{const{auth:b}=de().props,[L,w]=y.useState(!0),[l,p]=y.useState(null),[h,g]=y.useState([]),[o,n]=y.useState([]),[c,x]=y.useState([]),[d,N]=y.useState(null);y.useEffect(()=>{let a=!0;const i=new AbortController;return(async()=>{try{w(!0),p(null);const f=await me.get(route("updates"),{signal:i.signal,timeout:1e4});a&&f.data&&(g(f.data.users||[]),n(f.data.todayLeaves||[]),x(f.data.upcomingLeaves||[]),N(f.data.upcomingHoliday||null))}catch(f){a&&!i.signal.aborted&&(console.error("Failed to fetch updates:",f),p(f.message),g([]),n([]),x([]),N(null))}finally{a&&w(!1)}})(),()=>{a=!1,i.abort()}},[]);const D=(a,i)=>{let S=i;const f=u=>i.some($=>String($.user_id)===String(b.user.id)&&$.leave_type===u)?(S=i.filter($=>String($.user_id)!==String(b.user.id)),`You ${a==="today"?"are":"will be"} on ${u} leave.`):null,E=i.reduce((u,C)=>{const $=f(C.leave_type);return $&&!u.some(ne=>ne.type===C.leave_type)&&u.push({text:$,type:C.leave_type}),u},[]),I=S.reduce((u,C)=>(u[C.leave_type]=(u[C.leave_type]||0)+1,u),{}),H=Object.entries(I).map(([u,C])=>({text:`${C} person${C>1?"s":""} ${a==="today"?"is":"will be"} on ${u} leave`,type:u,leaves:S.filter($=>$.leave_type===u)}));return[...E,...H]},B=_(),R=B.add(1,"day"),U=R.add(7,"day"),j=o.filter(a=>_(B).isBetween(_(a.from_date),_(a.to_date),"day","[]")),k=c.filter(a=>_(R).isBetween(_(a.from_date),_(a.to_date),"day","[]")),G=c.filter(a=>(_(a.from_date).isBetween(R,U,"day","[]")||_(a.to_date).isBetween(R,U,"day","[]"))&&!/week/i.test(a.leave_type)),t=D("today",j),v=D("tomorrow",k),F=D("nextSevenDays",G);t.length===0&&t.push({text:"No one is away today."}),v.length===0&&v.push({text:"No one is away tomorrow."}),F.length===0&&F.push({text:"No one is going to be away in the next seven days."});const A=[{title:"Today",items:t,icon:T,color:"#3b82f6"},{title:"Tomorrow",items:v,icon:M,color:"#10b981"},{title:"Next Seven Days",items:F,icon:ee,color:"#f59e0b"}];return L?e(s,{sx:{p:2},component:"section","aria-label":"Employee updates loading",children:e(P,{container:!0,spacing:3,children:[1,2,3].map((a,i)=>e(P,{item:!0,xs:12,sm:6,md:4,children:r(J,{className:"w-full h-full p-4",radius:"lg",children:[e(Q,{className:"rounded-lg mb-2",isLoaded:!1,children:e("div",{className:"h-6 w-2/3 rounded-lg bg-secondary"})}),e(Q,{className:"rounded-lg",isLoaded:!1,children:e("div",{className:"h-32 w-full rounded-lg bg-secondary-200"})})]})},i))})}):l?e(s,{sx:{p:2,display:"flex",alignItems:"center",justifyContent:"center",minHeight:"200px"},children:e(J,{className:"p-4 bg-danger-50 border-danger-200",children:r(s,{className:"flex items-center gap-3",children:[e(ye,{className:"w-5 h-5 text-danger"}),r(m,{color:"error",variant:"body1",children:["Failed to load updates: ",l]})]})})}):r(s,{sx:{p:2},component:"section","aria-label":"Employee Updates Dashboard",children:[e(P,{container:!0,spacing:3,sx:{alignItems:"stretch"},children:A.map((a,i)=>e(P,{item:!0,xs:12,sm:6,md:4,sx:{display:"flex"},children:e(O,{in:!0,timeout:300+i*100,style:{width:"100%"},children:e(s,{sx:{display:"flex",flexDirection:"column",flexGrow:1,width:"100%"},children:e(Fe,{title:a.title,items:a.items,users:h,icon:a.icon,color:a.color})})})},a.title))}),d&&e(O,{in:!0,timeout:800,children:e(s,{sx:{mt:3},children:r(te,{children:[e(ae,{title:r(s,{className:"flex items-center gap-3",children:[e(s,{sx:{bgcolor:"#f59e0b20",borderRadius:"12px",p:1,display:"flex",alignItems:"center",justifyContent:"center",minWidth:40,minHeight:40},children:e(ge,{style:{width:"20px",height:"20px",color:"#f59e0b",strokeWidth:2},"aria-hidden":"true"})}),e(m,{variant:"h6",component:"h2",sx:{fontSize:{xs:"1rem",sm:"1.1rem",md:"1.2rem"},fontWeight:600},children:"Upcoming Holiday"})]})}),e(q,{}),e(re,{children:r(s,{className:"flex items-center gap-3",children:[e(T,{className:"w-5 h-5 text-primary"}),r(s,{children:[e(m,{variant:"body1",fontWeight:"600",color:"text.primary",children:d.name}),r(m,{variant:"body2",color:"text.secondary",className:"flex items-center gap-1 mt-1",children:[e(M,{className:"w-4 h-4"}),new Date(d.from_date).toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})," - ",new Date(d.to_date).toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})]})]})]})})]})})})]})};export{Te as default};
