import{V as G,a as e,j as a,F as Se,c as Ce}from"./app-BDL2Y3Ac.js";import{r,t as Y,G as b,e as V,g as Q,B as n,T as h,a as R,x as Z,a5 as ke,f as Me}from"./vendor-DhsbrqqY.js";import{d as S,F as u,G as q,e as J,f as Le}from"./App-BAl9-fyJ.js";import{d as j}from"./dayjs.min-BnBCbp-R.js";import{F as U,a as $,b as $e}from"./XCircleIcon-BHLaV7sA.js";import{c as K,s as Ae,F as Ee}from"./CheckCircleIcon-BouyP4Yu.js";import{s as Te}from"./chunk-4EXC76WE-BbmWI7ow.js";import{a as Fe}from"./chunk-A6PX3NG3-B1_1_emB.js";import{i as P}from"./chunk-HJTJQZF3-KpnUfdqE.js";import{t as De,a as Re,b as je,c as Ue,d as Pe,e as p}from"./chunk-F3UDT23P-DUMxki6N.js";import{p as ze}from"./chunk-YHY32LNM-CTtTOVnb.js";import{u as We}from"./chunk-R6AK6OQ4-YfMKL-bA.js";import"./chunk-2BFF5KFD-CY6UALKj.js";import"./chunk-SLABUSGS-CPDwsMNJ.js";import"./chunk-M3MASYO7-COGiOE1Q.js";import"./chunk-MZRCPRP2-BIsogASO.js";import"./chunk-7F3ZLNJ6-Dd5bsoxT.js";function He({title:x,titleId:d,...N},f){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:f,"aria-labelledby":d},N),x?r.createElement("title",{id:d},x):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m19.5 8.25-7.5 7.5-7.5-7.5"}))}const Ie=r.forwardRef(He);function Oe({title:x,titleId:d,...N},f){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:f,"aria-labelledby":d},N),x?r.createElement("title",{id:d},x):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"}))}const Be=r.forwardRef(Oe),ct=({handleDateChange:x,selectedDate:d,updateTimeSheet:N})=>{const{auth:f}=G().props,{url:w}=G(),X=Y("(min-width: 1025px)"),ee=Y("(min-width: 641px) and (max-width: 1024px)"),[te,ae]=r.useState([]),[re,se]=r.useState([]),[y,z]=r.useState([]),[W,H]=r.useState(""),[ne,le]=r.useState(0),[oe,ie]=r.useState(0),[I,Ge]=r.useState(10),[A,ce]=r.useState(1),[E,me]=r.useState(""),[ue,O]=r.useState(!1),[k,de]=r.useState({currentMonth:j().format("YYYY-MM")}),[M,T]=r.useState(2),F=r.useRef(null),D=r.useRef(null),he=t=>{if(!Array.isArray(t))return[];const i=t.reduce((s,o)=>{const g=`${o.user_id}_${o.date}`;return s[g]||(s[g]={id:o.id,user_id:o.user_id,user:o.user,date:o.date,punches:[],first_punch_in:null,last_punch_out:null,total_work_hours:0}),o.punchin_time&&s[g].punches.push({punch_in:o.punchin_time,punch_out:o.punchout_time||null}),s},{});return Object.values(i).map(s=>{if(s.punches.length===0)return{...s,punchin_time:null,punchout_time:null,total_work_hours:0};s.punches.sort((c,v)=>{const C=new Date(`2024-01-01T${c.punch_in}`),m=new Date(`2024-01-01T${v.punch_in}`);return C-m});const o=s.punches[0],g=s.punches[s.punches.length-1];let _=0;return s.punches.forEach(c=>{if(c.punch_in&&c.punch_out){const v=new Date(`2024-01-01T${c.punch_in}`),m=new Date(`2024-01-01T${c.punch_out}`)-v;_+=Math.max(0,m/(1e3*60))}}),{...s,punchin_time:o.punch_in,punchout_time:g.punch_out,total_work_minutes:_,punch_count:s.punches.length,complete_punches:s.punches.filter(c=>c.punch_in&&c.punch_out).length}})},pe=async(t,i,l,s,o)=>{var _,c,v,C;const g=w!=="/attendance-employee"?route("getAllUsersAttendanceForDate"):route("getCurrentUserAttendanceForDate");try{const m=await Ce.get(g,{params:{page:i,perPage:l,employee:s,date:t,currentYear:o.currentMonth?j(o.currentMonth).year():"",currentMonth:o.currentMonth?j(o.currentMonth).format("MM"):""}});if(m.status===200){const ve=he(m.data.attendances);ae(ve),se(m.data.leaves),z(m.data.absent_users),le(m.data.total),ie(m.data.last_page),H(""),O(!0)}}catch(m){H(((c=(_=m.response)==null?void 0:_.data)==null?void 0:c.message)||"An error occurred while retrieving attendance data."),z(((C=(v=m.response)==null?void 0:v.data)==null?void 0:C.absent_users)||[]),O(!0)}},L=r.useCallback(()=>{if(F.current&&D.current){const t=F.current.clientHeight,i=D.current.clientHeight,l=t-150,s=Math.max(1,Math.floor(l/i));T(s)}},[]);r.useEffect(()=>{T(2);const t=setTimeout(()=>{L()},100);return window.addEventListener("resize",L),()=>{clearTimeout(t),window.removeEventListener("resize",L)}},[y,N,L]),r.useEffect(()=>{pe(d,A,I,E,k)},[d,A,I,E,k,N]);const fe=t=>{me(t.target.value.toLowerCase())},ge=t=>{ce(t)},xe=r.useCallback((t,i)=>{de(l=>({...l,[t]:i}))},[]),we=()=>{T(t=>t+2)},_e=t=>re.find(i=>String(i.user_id)===String(t)),B=t=>{switch(t==null?void 0:t.toLowerCase()){case"approved":return e(Ee,{className:"w-4 h-4 text-success"});case"rejected":return e($e,{className:"w-4 h-4 text-danger"});default:return e(u,{className:"w-4 h-4 text-warning"})}},be=t=>{switch(t==null?void 0:t.toLowerCase()){case"approved":return"success";case"rejected":return"danger";default:return"warning"}},Ne=[{name:"Date",uid:"date",icon:S},...f.roles.includes("Administrator")&&w!=="/attendance-employee"?[{name:"Employee",uid:"employee",icon:U}]:[],{name:"Clock In",uid:"clockin_time",icon:u},{name:"Clock Out",uid:"clockout_time",icon:u},{name:"Work Hours",uid:"production_time",icon:u},{name:"Punches",uid:"punch_details",icon:u}],ye=(t,i)=>{var l,s,o;switch(i){case"date":return e(p,{className:"text-xs sm:text-sm md:text-base",children:a(n,{className:"flex items-center gap-2",children:[e(S,{className:"w-4 h-4 text-primary"}),e("span",{children:new Date(t.date).toLocaleString("en-US",{month:"short",day:"numeric",year:"numeric"})})]})});case"employee":return e(p,{className:"whitespace-nowrap text-xs sm:text-sm md:text-base",children:e(We,{avatarProps:{radius:"lg",size:X||ee?"md":"sm",src:(l=t.user)==null?void 0:l.profile_image,fallback:e(U,{className:"w-6 h-6"})},description:(s=t.user)==null?void 0:s.phone,name:(o=t.user)==null?void 0:o.name})});case"clockin_time":return e(p,{className:"text-xs sm:text-sm md:text-base",children:a(n,{className:"flex items-center gap-2",children:[e(u,{className:"w-4 h-4 text-success"}),e("span",{children:t.punchin_time?new Date(`2024-06-04T${t.punchin_time}`).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}):"Not clocked in"})]})});case"clockout_time":return e(p,{className:"text-xs sm:text-sm md:text-base",children:a(n,{className:"flex items-center gap-2",children:[e(u,{className:"w-4 h-4 text-danger"}),e("span",{children:t.punchout_time?new Date(`2024-06-04T${t.punchout_time}`).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}):"Still working"})]})});case"production_time":if(t.total_work_minutes>0){const _=Math.floor(t.total_work_minutes/60),c=Math.floor(t.total_work_minutes%60);return e(p,{className:"text-xs sm:text-sm md:text-base",children:a(n,{className:"flex items-center gap-2",children:[e(u,{className:"w-4 h-4 text-primary"}),e("span",{className:"font-medium",children:`${_}h ${c}m`})]})})}else if(t.punchin_time&&!t.punchout_time)return e(p,{className:"text-xs sm:text-sm md:text-base",children:a(n,{className:"flex items-center gap-2",children:[e(u,{className:"w-4 h-4 text-warning"}),e("span",{className:"text-warning",children:"In Progress"})]})});return e(p,{className:"text-xs sm:text-sm md:text-base",children:a(n,{className:"flex items-center gap-2",children:[e($,{className:"w-4 h-4 text-warning"}),e("span",{className:"text-warning",children:"No punches"})]})});case"punch_details":return e(p,{className:"text-xs sm:text-sm md:text-base",children:a(n,{className:"flex items-center gap-2",children:[e(u,{className:"w-4 h-4 text-default-400"}),a(n,{className:"flex flex-col",children:[a("span",{className:"text-xs font-medium",children:[t.punch_count||0," punch",(t.punch_count||0)!==1?"es":""]}),t.complete_punches!==t.punch_count&&a("span",{className:"text-xs text-warning",children:[t.complete_punches," complete"]})]})]})});default:return e(p,{className:"text-xs sm:text-sm md:text-base",children:"N/A"})}};return e(n,{sx:{display:"flex",justifyContent:"center",p:2},component:"main",role:"main","aria-label":"Timesheet Management",children:a(b,{container:!0,spacing:2,children:[e(b,{item:!0,xs:12,md:w!=="/attendance-employee"?9:12,children:e(V,{in:!0,timeout:500,children:a(q,{children:[e(Q,{title:a(n,{className:"flex items-center gap-3",children:[e(u,{className:"w-6 h-6 text-primary"}),e(h,{variant:"h5",component:"h1",sx:{fontSize:{xs:"1.25rem",sm:"1.5rem",md:"1.75rem"},fontWeight:600},children:w==="/attendance-employee"?`Timesheet - ${new Date(k.currentMonth).toLocaleString("en-US",{month:"long",year:"numeric"})}`:`Daily Timesheet - ${new Date(d).toLocaleString("en-US",{month:"long",day:"numeric",year:"numeric"})}`})]}),sx:{padding:"24px"}}),e(J,{}),e(R,{children:e(n,{component:"section",role:"search","aria-label":"Timesheet filters",children:a(b,{container:!0,spacing:3,children:[f.roles.includes("Administrator")&&w!=="/attendance-employee"&&a(Se,{children:[e(b,{item:!0,xs:12,sm:6,md:4,children:e(P,{label:"Search Employee",type:"text",fullWidth:!0,variant:"bordered",placeholder:"Enter employee name...",value:E,onChange:fe,startContent:e(Be,{className:"w-4 h-4 text-default-400"}),"aria-label":"Search employees"})}),e(b,{item:!0,xs:12,sm:6,md:4,children:e(P,{label:"Select Date",type:"date",variant:"bordered",onChange:x,value:new Date(d).toISOString().slice(0,10)||"",startContent:e(S,{className:"w-4 h-4 text-default-400"}),"aria-label":"Select date for timesheet"})})]}),f.roles.includes("Employee")&&w==="/attendance-employee"&&e(b,{item:!0,xs:12,sm:6,md:4,children:e(P,{label:"Select Month",type:"month",fullWidth:!0,variant:"bordered",placeholder:"Select month...",value:k.currentMonth,onChange:t=>xe("currentMonth",t.target.value),startContent:e(S,{className:"w-4 h-4 text-default-400"}),"aria-label":"Select month for timesheet"})})]})})}),e(R,{children:W?e(K,{className:"p-4 bg-danger-50 border-danger-200",children:a(n,{className:"flex items-center gap-3",children:[e($,{className:"w-5 h-5 text-danger"}),e(h,{color:"error",variant:"body1",children:W})]})}):a(n,{sx:{maxHeight:"70vh"},role:"region","aria-label":"Attendance data table",children:[e(Te,{orientation:"horizontal",className:"overflow-y-hidden",children:e(Ae,{className:"rounded-lg",isLoaded:ue,children:a(De,{isStriped:!0,selectionMode:"multiple",selectionBehavior:"toggle",isCompact:!0,removeWrapper:!0,"aria-label":"Employee attendance timesheet table",isHeaderSticky:!0,children:[e(Re,{columns:Ne,children:t=>e(je,{align:"start",children:a(n,{className:"flex items-center gap-2",children:[t.icon&&e(t.icon,{className:"w-4 h-4"}),e("span",{children:t.name})]})},t.uid)}),e(Ue,{items:te,emptyContent:a(n,{className:"flex flex-col items-center justify-center py-8",children:[e(u,{className:"w-12 h-12 text-default-300 mb-4"}),e(h,{variant:"body1",color:"textSecondary",children:"No attendance records found"})]}),children:t=>e(Pe,{children:i=>ye(t,i)},`${t.user_id}_${t.date}`)})]})})}),ne>10&&e(n,{className:"py-4 flex justify-center",children:e(ze,{initialPage:1,isCompact:!0,showControls:!0,showShadow:!0,color:"primary",variant:"bordered",page:A,total:oe,onChange:ge,"aria-label":"Timesheet pagination"})})]})})]})})}),f.roles.includes("Administrator")&&w!=="/attendance-employee"&&y.length>0&&e(b,{item:!0,xs:12,md:3,children:e(V,{in:!0,timeout:700,children:a(q,{ref:F,children:[e(Q,{title:a(n,{className:"flex items-center justify-between",children:[a(n,{className:"flex items-center gap-2",children:[e(Le,{className:"w-5 h-5 text-warning"}),e(h,{variant:"h6",component:"h2",sx:{fontSize:{xs:"1rem",sm:"1.1rem",md:"1.2rem"},fontWeight:600},children:"Absent Today"})]}),e(Z,{label:y.length,variant:"flat",color:"warning",size:"sm",startContent:e($,{className:"w-3 h-3"})})]}),subheader:a(h,{variant:"body2",color:"textSecondary",className:"flex items-center gap-1",children:[e(S,{className:"w-4 h-4"}),new Date(d).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})]})}),e(J,{}),e(R,{children:a(n,{role:"region","aria-label":"Absent employees list",children:[y.slice(0,M).map((t,i)=>{const l=_e(t.id),s=i===0?D:null;return e(ke,{in:i<M,timeout:"auto",unmountOnExit:!0,children:e(K,{ref:s,className:"mb-3 p-3 bg-default-50 border-default-200",shadow:"sm",children:a(n,{className:"flex items-start justify-between",children:[a(n,{className:"flex items-center gap-3 flex-1",children:[e(Fe,{src:t.profile_image,alt:t.name,size:"sm",fallback:e(U,{className:"w-4 h-4"})}),a(n,{children:[e(h,{variant:"body2",fontWeight:"medium",sx:{fontSize:{xs:"0.875rem",sm:"1rem"}},children:t.name}),l?a(n,{className:"flex flex-col gap-1 mt-1",children:[a(h,{variant:"caption",color:"textSecondary",className:"flex items-center gap-1",children:[e(S,{className:"w-3 h-3"}),l.from_date===l.to_date?l.from_date:`${l.from_date} - ${l.to_date}`]}),a(h,{variant:"caption",color:"primary",className:"flex items-center gap-1",children:[B(l.status),l.leave_type," Leave"]})]}):a(h,{variant:"caption",color:"error",className:"flex items-center gap-1 mt-1",children:[e($,{className:"w-3 h-3"}),"Absent without leave"]})]})]}),l&&e(Z,{label:l.status,variant:"flat",color:be(l.status),size:"sm",startContent:B(l.status)})]})})},t.id)}),M<y.length&&e(n,{className:"text-center mt-3",children:a(Me,{variant:"outlined",onClick:we,startIcon:e(Ie,{className:"w-4 h-4"}),size:"small",children:["Show More (",y.length-M," remaining)"]})})]})})]})})})]})})};export{ct as default};
