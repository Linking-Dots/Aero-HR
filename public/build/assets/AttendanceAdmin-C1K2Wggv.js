import{a as e,j as h,V as ne,M as oe,F as b,c as se}from"./app-Db54vL82.js";import{t as z,B as E,R as le,u as ce,r as a,g as de,e as ie,h as ue,c as pe,f as he,a as K,G as T}from"./vendor-B2Sl_-DV.js";import{G as me,A as ye,B as q}from"./App-p2y7j0bb.js";import{d as m}from"./dayjs.min-CXVojvhV.js";import{a as ge,b as be,c as fe,d as xe,e as Y,t as Ce}from"./chunk-YRZGWF2W-DUv6HfmP.js";import{u as ke}from"./chunk-TLBGAR4N-lYZzFSDm.js";import{d as _e,p as Me}from"./Search-BH9T7I7p.js";import{u as $,w as ve}from"./xlsx-DjuO7_Ju.js";import{D as Q}from"./Download-C5ps4L_W.js";import{i as V}from"./chunk-IR2E3HZF-HHsAOiDt.js";import"./DOMLayoutDelegate-BqAyZ_ZQ.js";import"./chunk-KBN3H6OQ-C8wmKkJM.js";import"./useFormValidationState-DtR5Qyxs.js";import"./useLabel-COgrARAU.js";var we={name:"1a5nq0o",styles:"width:100%;border-collapse:collapse;& td{border:1px solid #ddd;}& th{background-color:#f4f4f4;}"};const Ae=({loading:f,attendanceData:v,currentYear:r,currentMonth:w,leaveTypes:x,leaveCounts:P})=>{const C=m(`${r}-${w}-01`).daysInMonth(),D=[{label:"Sl",key:"sl"},{label:"Name",key:"name"},...Array.from({length:C},(t,n)=>{const d=n+1;return{label:`${d}`,key:`day-${d}`}}),...x.map(t=>({label:t.type,key:t.type}))],A=t=>x.map(n=>{var y;const d=((y=P[t])==null?void 0:y[n.type])||0;return e(Y,{align:"center",children:d},`${t+n.type}`)}),F=t=>{const n=v.find(d=>d.user_id===t);return Array.from({length:C},(d,y)=>{const S=y+1,j=m(`${r}-${w}-${S}`).format("YYYY-MM-DD"),k=n?n[j]:"â–¼";return e(Y,{align:"center",children:k},`day-${S}`)})};return e("div",{style:{maxHeight:"84vh",overflowY:"auto"},children:f?h(E,{display:"flex",justifyContent:"center",alignItems:"center",height:"100%",children:[e(z,{})," "]}):h(Ce,{isStriped:!0,selectionMode:"multiple",selectionBehavior:"toggle",isCompact:!0,isHeaderSticky:!0,removeWrapper:!0,"aria-label":"Attendance Table",css:we,children:[e(ge,{columns:D,children:t=>e(be,{align:"center",children:t.label},t.key)}),e(fe,{children:v.map((t,n)=>h(xe,{children:[e(Y,{children:n+1}),e(Y,{style:{whiteSpace:"nowrap",textAlign:"start"},children:e(ke,{avatarProps:{radius:"lg",src:t.profile_image},name:t.name})}),F(t.user_id),A(t.user_id)]},t.user_id))})]})})},Se=le.memo(({title:f,allUsers:v})=>{const r=ce(),[w,x]=a.useState(!1),{auth:P}=ne().props,[C,D]=a.useState([]),[A,F]=a.useState([]),[t,n]=a.useState([]),[d,y]=a.useState(0),[S,j]=a.useState(0),[k,J]=a.useState(""),O=de(r.breakpoints.down("md")),[B,Ye]=a.useState(30),[I,U]=a.useState(1),[i,X]=a.useState({currentMonth:m().format("YYYY-MM")}),G=m(`${i.currentYear}-${i.currentMonth}-01`).daysInMonth(),Z=a.useCallback((o,s)=>{X(u=>({...u,[o]:s}))},[]),ee=async(o,s,u)=>{x(!0);try{const l=await se.get(route("attendancesAdmin.paginate"),{params:{page:o,perPage:s,employee:k,currentYear:u.currentMonth?m(u.currentMonth).year():"",currentMonth:u.currentMonth?m(u.currentMonth).format("MM"):""}});D(l.data.data),y(l.data.total),j(l.data.last_page),n(l.data.leaveTypes),F(l.data.leaveCounts)}catch(l){console.log(l),q.error("Failed to fetch data.",{icon:"ðŸ”´",style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:r.glassCard.backgroundColor,border:r.glassCard.border,color:r.palette.text.primary}})}finally{x(!1)}},te=o=>{const s=o.target.value.toLowerCase();J(s)};a.useEffect(()=>{ee(I,B,i)},[I,B,i,k]);const re=o=>{U(o)},R=async()=>{const o=new Promise((s,u)=>{try{const l=v.map((c,_)=>{const g=C.find(p=>p.user_id===c.id)||{},L={sl:_+1,name:c.name};for(let p=0;p<G;p++){const M=p+1,ae=m(`${i.currentYear}-${i.currentMonth}-${M}`).format("YYYY-MM-DD");L[`day-${M}`]=g[ae]||"â–¼"}return t.forEach(p=>{var M;L[p.type]=((M=A[c.id])==null?void 0:M[p.type])||0}),L}),W=[{label:"Sl",key:"sl"},{label:"Name",key:"name"},...Array.from({length:G},(c,_)=>{const g=_+1;return{label:`${g}`,key:`day-${g}`}}),...t.map(c=>({label:c.type,key:c.type}))],H=$.json_to_sheet(l,{header:W.map(c=>c.key)});W.forEach((c,_)=>{const g=$.encode_cell({c:_,r:0});H[g].v=c.label});const N=$.book_new();$.book_append_sheet(N,H,"Attendance"),ve(N,"AttendanceData.xlsx"),s("Export successful!")}catch(l){u("Failed to export data. Please try again."),console.error("Error exporting data to Excel:",l)}});q.promise(o,{pending:{render(){return h("div",{style:{display:"flex",alignItems:"center"},children:[e(z,{}),e("span",{style:{marginLeft:"8px"},children:"Exporting data to Excel ..."})]})},icon:!1,style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:r.glassCard.backgroundColor,border:r.glassCard.border,color:r.palette.text.primary}},success:{render({data:s}){return e(b,{children:s})},icon:"ðŸŸ¢",style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:r.glassCard.backgroundColor,border:r.glassCard.border,color:r.palette.text.primary}},error:{render({data:s}){return e(b,{children:s})},icon:"ðŸ”´",style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:r.glassCard.backgroundColor,border:r.glassCard.border,color:r.palette.text.primary}}})};return h(b,{children:[e(oe,{title:f}),e(E,{sx:{display:"flex",justifyContent:"center",p:2},children:e(ie,{in:!0,children:h(me,{children:[e(ue,{title:"Attendances",sx:{padding:"24px"},action:e(E,{display:"flex",gap:2,children:P.roles.includes("Administrator")&&e(b,{children:O?e(b,{children:e(pe,{title:"Export Daily Works",color:"success",onClick:R,children:e(Q,{})})}):e(b,{children:e(he,{title:"Export Daily Works",variant:"outlined",color:"success",startIcon:e(Q,{}),onClick:R,children:"Export"})})})})}),e(K,{children:e(E,{children:h(T,{container:!0,spacing:2,children:[e(T,{item:!0,xs:12,sm:6,md:4,children:e(V,{label:"Search",type:"text",fullWidth:!0,variant:"bordered",placeholder:"Employee...",value:k,onChange:te,endContent:e(_e,{})})}),e(T,{item:!0,xs:12,sm:6,md:4,children:e(V,{label:"Current Month",type:"month",fullWidth:!0,variant:"bordered",placeholder:"Month...",value:i.currentMonth,onChange:o=>Z("currentMonth",o.target.value)})})]})})}),h(K,{children:[e(Ae,{attendanceData:C,currentYear:i.currentYear,currentMonth:i.currentMonth,leaveTypes:t,leaveCounts:A,loading:w}),d>=30&&e("div",{className:"py-2 px-2 flex justify-center items-center",children:e(Me,{initialPage:1,isCompact:!0,showControls:!0,showShadow:!0,color:"primary",variant:"bordered",page:I,total:S,onChange:re})})]})]})})})]})});Se.layout=f=>e(ye,{children:f});export{Se as default};
