import{a as e,j as h,q as ae,Y as ne,G as oe,F as b,c as se,B as q}from"./app-Dl05hPVL.js";import{t as z,B as D,R as le,j as ce,r as a,u as de,e as ie,g as ue,c as pe,f as he,a as K,G as T}from"./vendor-CLmvDlKR.js";import{A as me}from"./App-DbKLIXm4.js";import{d as m}from"./dayjs.min-CLcGouLw.js";import{a as ye,b as ge,c as be,d as fe,e as E,t as xe}from"./chunk-YRZGWF2W-CEyd-Xa4.js";import{u as Ce}from"./chunk-TLBGAR4N-Cm-qSlgO.js";import{d as ke,p as _e}from"./Search-Hx-N-xAK.js";import{D as Q,u as P,w as Me}from"./xlsx-CFoWJp9M.js";import{i as U}from"./chunk-IR2E3HZF-DhOQwH-C.js";import"./useFormValidationState-BkMPC0CQ.js";import"./useLabel-DJOw9D8i.js";var ve={name:"1a5nq0o",styles:"width:100%;border-collapse:collapse;& td{border:1px solid #ddd;}& th{background-color:#f4f4f4;}"};const we=({loading:f,attendanceData:r,currentYear:v,currentMonth:x,leaveTypes:w,leaveCounts:A})=>{const S=m(`${v}-${x}-01`).daysInMonth(),Y=[{label:"Sl",key:"sl"},{label:"Name",key:"name"},...Array.from({length:S},(t,n)=>{const d=n+1;return{label:`${d}`,key:`day-${d}`}}),...w.map(t=>({label:t.type,key:t.type}))],F=t=>w.map(n=>{var y;const d=((y=A[t])==null?void 0:y[n.type])||0;return e(E,{align:"center",children:d},`${t+n.type}`)}),C=t=>{const n=r.find(d=>d.user_id===t);return Array.from({length:S},(d,y)=>{const $=y+1,k=m(`${v}-${x}-${$}`).format("YYYY-MM-DD"),j=n?n[k]:"â–¼";return e(E,{align:"center",children:j},`day-${$}`)})};return e("div",{style:{maxHeight:"84vh",overflowY:"auto"},children:f?h(D,{display:"flex",justifyContent:"center",alignItems:"center",height:"100%",children:[e(z,{})," "]}):h(xe,{isStriped:!0,selectionMode:"multiple",selectionBehavior:"toggle",isCompact:!0,isHeaderSticky:!0,removeWrapper:!0,"aria-label":"Attendance Table",css:ve,children:[e(ye,{columns:Y,children:t=>e(ge,{align:"center",children:t.label},t.key)}),e(be,{children:r.map((t,n)=>h(fe,{children:[e(E,{children:n+1}),e(E,{style:{whiteSpace:"nowrap",textAlign:"start"},children:e(Ce,{avatarProps:{radius:"lg",src:t.profile_image},name:t.name})}),C(t.user_id),F(t.user_id)]},t.user_id))})]})})},Ae=le.memo(({title:f})=>{const r=ce(),[v,x]=a.useState(!1),{auth:w}=ae().props,[A,S]=a.useState([]),[Y,F]=a.useState([]),[C,t]=a.useState([]),[n,d]=a.useState(0),[y,$]=a.useState(0),[k,j]=a.useState(""),J=de(r.breakpoints.down("md")),[B,Se]=a.useState(30),[I,O]=a.useState(1),[i,V]=a.useState({currentMonth:m().format("YYYY-MM")}),G=m(`${i.currentYear}-${i.currentMonth}-01`).daysInMonth(),X=a.useCallback((o,s)=>{V(u=>({...u,[o]:s}))},[]),Z=async(o,s,u)=>{x(!0);try{const l=await se.get(route("attendancesAdmin.paginate"),{params:{page:o,perPage:s,employee:k,currentYear:u.currentMonth?m(u.currentMonth).year():"",currentMonth:u.currentMonth?m(u.currentMonth).format("MM"):""}});S(l.data.data),d(l.data.total),$(l.data.last_page),t(l.data.leaveTypes),F(l.data.leaveCounts)}catch(l){console.log(l),q.error("Failed to fetch data.",{icon:"ðŸ”´",style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:r.glassCard.backgroundColor,border:r.glassCard.border,color:r.palette.text.primary}})}finally{x(!1)}},ee=o=>{const s=o.target.value.toLowerCase();j(s)};a.useEffect(()=>{Z(I,B,i)},[I,B,i,k]);const te=o=>{O(o)},R=async()=>{const o=new Promise((s,u)=>{try{const l=allUsers.map((c,_)=>{const g=A.find(p=>p.user_id===c.id)||{},L={sl:_+1,name:c.name};for(let p=0;p<G;p++){const M=p+1,re=m(`${i.currentYear}-${i.currentMonth}-${M}`).format("YYYY-MM-DD");L[`day-${M}`]=g[re]||"â–¼"}return C.forEach(p=>{var M;L[p.type]=((M=Y[c.id])==null?void 0:M[p.type])||0}),L}),W=[{label:"Sl",key:"sl"},{label:"Name",key:"name"},...Array.from({length:G},(c,_)=>{const g=_+1;return{label:`${g}`,key:`day-${g}`}}),...C.map(c=>({label:c.type,key:c.type}))],H=P.json_to_sheet(l,{header:W.map(c=>c.key)});W.forEach((c,_)=>{const g=P.encode_cell({c:_,r:0});H[g].v=c.label});const N=P.book_new();P.book_append_sheet(N,H,"Attendance"),Me(N,"AttendanceData.xlsx"),s("Export successful!")}catch(l){u("Failed to export data. Please try again."),console.error("Error exporting data to Excel:",l)}});q.promise(o,{pending:{render(){return h("div",{style:{display:"flex",alignItems:"center"},children:[e(z,{}),e("span",{style:{marginLeft:"8px"},children:"Exporting data to Excel ..."})]})},icon:!1,style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:r.glassCard.backgroundColor,border:r.glassCard.border,color:r.palette.text.primary}},success:{render({data:s}){return e(b,{children:s})},icon:"ðŸŸ¢",style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:r.glassCard.backgroundColor,border:r.glassCard.border,color:r.palette.text.primary}},error:{render({data:s}){return e(b,{children:s})},icon:"ðŸ”´",style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:r.glassCard.backgroundColor,border:r.glassCard.border,color:r.palette.text.primary}}})};return h(b,{children:[e(ne,{title:f}),e(D,{sx:{display:"flex",justifyContent:"center",p:2},children:e(ie,{in:!0,children:h(oe,{children:[e(ue,{title:"Attendances",sx:{padding:"24px"},action:e(D,{display:"flex",gap:2,children:w.roles.includes("Administrator")&&e(b,{children:J?e(b,{children:e(pe,{title:"Export Daily Works",color:"success",onClick:R,children:e(Q,{})})}):e(b,{children:e(he,{title:"Export Daily Works",variant:"outlined",color:"success",startIcon:e(Q,{}),onClick:R,children:"Export"})})})})}),e(K,{children:e(D,{children:h(T,{container:!0,spacing:2,children:[e(T,{item:!0,xs:12,sm:6,md:4,children:e(U,{label:"Search",type:"text",fullWidth:!0,variant:"bordered",placeholder:"Employee...",value:k,onChange:ee,endContent:e(ke,{})})}),e(T,{item:!0,xs:12,sm:6,md:4,children:e(U,{label:"Current Month",type:"month",fullWidth:!0,variant:"bordered",placeholder:"Month...",value:i.currentMonth,onChange:o=>X("currentMonth",o.target.value)})})]})})}),h(K,{children:[e(we,{attendanceData:A,currentYear:i.currentYear,currentMonth:i.currentMonth,leaveTypes:C,leaveCounts:Y,loading:v}),n>=30&&e("div",{className:"py-2 px-2 flex justify-center items-center",children:e(_e,{initialPage:1,isCompact:!0,showControls:!0,showShadow:!0,color:"primary",variant:"bordered",page:I,total:y,onChange:te})})]})]})})})]})});Ae.layout=f=>e(me,{children:f});export{Ae as default};
