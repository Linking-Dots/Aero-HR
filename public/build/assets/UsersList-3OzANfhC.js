import{a as e,j as p,U as O,F as _,V as re,M as ae}from"./app-C-Xv1CoC.js";import{r as y,u as q,c as B,a1 as te,k as oe,M as le,a2 as ne,S as se,F as de,t as L,X as ie,T as ce,G as f,B as T,Y as pe,Z as me,$ as ue,g as ge,e as he,h as be,a as fe}from"./vendor-DrHmFQFl.js";import{B as S,A as ye,G as Ce,b as H}from"./App-NuA52Q31.js";import{E as xe,D as ve}from"./Edit-CtMoSlB4.js";import{a as ke,b as _e,c as we,d as Se,e as Pe,t as De}from"./chunk-YRZGWF2W-BufU_Gd4.js";import{t as G}from"./chunk-KQ7OR4H5-jJsijhp0.js";import{u as Fe}from"./chunk-TLBGAR4N-Cc42Vorl.js";import{d as Ie,G as Me}from"./GlassDialog-FIrQhwbS.js";import{d as Ae,a as Ee}from"./VisibilityOff-DBUyKnNd.js";import{P as Ue}from"./PhotoCamera-DwD9tUub.js";import{L as Be}from"./LoadingButton-CUeR6bzk.js";import{i as k}from"./chunk-IR2E3HZF-CTrufAY4.js";import{s as j,l as w}from"./chunk-QEQ4EHOG-CXkc-MAn.js";import{A as J}from"./Add-id6j6Uy5.js";import"./DOMLayoutDelegate-BSYbvl-u.js";import"./chunk-KBN3H6OQ-BQoqaRBZ.js";import"./useFormValidationState-B3J-Fzn9.js";import"./useLabel-BXpZpHIl.js";import"./chunk-NCVCYSZZ-B_HDsYdH.js";const Te=({allUsers:a,roles:I})=>{const[M,P]=y.useState(a),l=q(),[N,D]=y.useState({});async function F(t,b,o){const d=new Promise(async(i,s)=>{try{const m=await axios.post(route("user.updateRole",{id:b}),{[t]:o});m.status===200&&(P(v=>v.map(U=>U.id===b?{...U,[t]:o}:U)),i([m.data.messages||"Role updated successfully"]))}catch(m){m.response?(m.response.status===422?s(m.response.data.errors||["Failed to update user role."]):s("An unexpected error occurred. Please try again later."),console.error(m.response)):m.request?(s("No response received from the server. Please check your internet connection."),console.error(m.request)):(s("An error occurred while setting up the request."),console.error("Error",m.message))}});S.promise(d,{pending:{render(){return p("div",{style:{display:"flex",alignItems:"center"},children:[e(L,{}),p("span",{style:{marginLeft:"8px"},children:["Updating employee ",t,"..."]})]})},icon:!1,style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:l.glassCard.backgroundColor,border:l.glassCard.border,color:l.palette.text.primary}},success:{render({data:i}){return e(_,{children:i.map((s,m)=>e("div",{children:s},m))})},icon:"游릭",style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:l.glassCard.backgroundColor,border:l.glassCard.border,color:l.palette.text.primary}},error:{render({data:i}){return e(_,{children:i})},icon:"游댮",style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:l.glassCard.backgroundColor,border:l.glassCard.border,color:l.palette.text.primary}}})}const A=async(t,b)=>{const o=new Promise(async(d,i)=>{try{const s=await axios.put(route("user.toggleStatus",{id:t}),{active:b});s.status===200&&(P(m=>m.map(v=>v.id===t?{...v,active:b}:v)),d([s.data.message||"User status updated successfully"]))}catch(s){s.response?(s.response.status===422?i(s.response.data.errors||["Failed to update user status."]):i("An unexpected error occurred. Please try again later."),console.error(s.response)):s.request?(i("No response received from the server. Please check your internet connection."),console.error(s.request)):(i("An error occurred while setting up the request."),console.error("Error",s.message))}});S.promise(o,{pending:{render(){return p("div",{style:{display:"flex",alignItems:"center"},children:[e(L,{}),e("span",{style:{marginLeft:"8px"},children:"Updating user status..."})]})},icon:!1,style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:l.glassCard.backgroundColor,border:l.glassCard.border,color:l.palette.text.primary}},success:{render({data:d}){return e(_,{children:d.map((i,s)=>e("div",{children:i},s))})},icon:"游릭",style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:l.glassCard.backgroundColor,border:l.glassCard.border,color:l.palette.text.primary}},error:{render({data:d}){return e(_,{children:d})},icon:"游댮",style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:l.glassCard.backgroundColor,border:l.glassCard.border,color:l.palette.text.primary}}})},n=async t=>{const b=new Promise(async(o,d)=>{try{const i=await fetch(route("profile.delete"),{method:"DELETE",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.head.querySelector('meta[name="csrf-token"]').content},body:JSON.stringify({user_id:t})}),s=await i.json();i.ok?(P(m=>m.filter(v=>v.id!==t)),o([s.message])):d([s.message])}catch(i){console.error("Error deleting user:",i),d(["An error occurred while deleting user. Please try again."])}});S.promise(b,{pending:{render(){return p("div",{style:{display:"flex",alignItems:"center"},children:[e(L,{}),e("span",{style:{marginLeft:"8px"},children:"Deleting user..."})]})},icon:!1,style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:l.glassCard.backgroundColor,border:l.glassCard.border,color:l.palette.text.primary}},success:{render({data:o}){return e(_,{children:o.map((d,i)=>e("div",{children:d},i))})},icon:"游릭",style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:l.glassCard.backgroundColor,border:l.glassCard.border,color:l.palette.text.primary}},error:{render({data:o}){return e(_,{children:o.map((d,i)=>e("div",{children:d},i))})},icon:"游댮",style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:l.glassCard.backgroundColor,border:l.glassCard.border,color:l.palette.text.primary}}})},E=t=>{D(b=>({...b,[t]:null}))},c=(t,b)=>{const o=t[b];switch(b){case"name":return e(Fe,{avatarProps:{radius:"lg",src:t==null?void 0:t.profile_image},name:t==null?void 0:t.name,children:t==null?void 0:t.email});case"email":return o;case"phone":return o;case"created_at":return o||"N/A";case"role":return p(de,{size:"small",fullWidth:!0,children:[e(oe,{id:"role",children:"Role"}),e(se,{disabled:!t.active,labelId:"role",id:"role",multiple:!0,value:t.roles,onChange:d=>F("roles",t.id,d.target.value),label:"Role",variant:"outlined",renderValue:d=>d.join(", "),MenuProps:{PaperProps:{sx:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:l.glassCard.backgroundColor,border:l.glassCard.border,borderRadius:2,boxShadow:"rgb(255, 255, 255) 0px 0px 0px 0px, rgba(0, 0, 0, 0.05) 0px 0px 0px 1px, rgba(0, 0, 0, 0.1) 0px 10px 15px -3px, rgba(0, 0, 0, 0.05) 0px 4px 6px -2px"}}},children:I.map(d=>p(le,{value:d.name,children:[e(ne,{size:"small",checked:t.roles.includes(d.name)}),d.name]},d.name))})]});case"actions":return p("div",{className:"relative flex items-center gap-2",children:[e(G,{content:"Edit Leave",children:e(B,{className:"text-lg text-default-400 cursor-pointer active:opacity-50",component:O,href:route("profile",{user:t.id}),onClick:()=>{E(t.id)},children:e(xe,{})})}),e(G,{content:"Delete Leave",color:"danger",children:p(B,{className:"text-lg text-danger cursor-pointer active:opacity-50",component:O,href:route("profile",{user:t.id}),onClick:()=>{n(t.id)},children:[e(ve,{})," "]})}),e(G,{content:"Set Active Status",color:"danger",children:e(te,{checked:t.active,onChange:()=>A(t.id,!t.active)})})]});default:return"N/A"}};return e("div",{style:{maxHeight:"84vh",overflowY:"auto"},children:p(De,{fullWidth:!0,isStriped:!0,isCompact:!0,isHeaderSticky:!0,removeWrapper:!0,"aria-label":"Employees Table",children:[e(ke,{columns:[{name:"Name",uid:"name"},{name:"Email",uid:"email"},{name:"Phone",uid:"phone"},{name:"Created At",uid:"created_at"},{name:"Role",uid:"role"},{name:"Action",uid:"actions"}],children:t=>e(_e,{align:t.uid==="actions"?"center":"start",children:t.name},t.uid)}),e(we,{items:M,children:t=>e(Se,{children:b=>e(Pe,{style:{whiteSpace:"nowrap"},children:c(t,b)})},t.id)})]},M)})},Ne=({user:a,allUsers:I,departments:M,designations:P,setUser:l,open:N,closeModal:D})=>{const[F,A]=y.useState(!1),[n,E]=y.useState({id:a==null?void 0:a.id,name:(a==null?void 0:a.name)||"",user_name:(a==null?void 0:a.user_name)||"",gender:(a==null?void 0:a.gender)||"",birthday:(a==null?void 0:a.birthday)||"",date_of_joining:(a==null?void 0:a.date_of_joining)||"",address:(a==null?void 0:a.address)||"",employee_id:(a==null?void 0:a.employee_id)||"",phone:(a==null?void 0:a.phone)||"",email:(a==null?void 0:a.email)||"",department:(a==null?void 0:a.department)||"",designation:(a==null?void 0:a.designation)||"",report_to:(a==null?void 0:a.report_to)||"",password:"",confirmPassword:""}),[c,R]=y.useState({id:a==null?void 0:a.id}),[t,b]=y.useState(!1),[o,d]=y.useState({}),[i,s]=y.useState(!1),[m,v]=y.useState(!1),[U,V]=y.useState(null),[W,$]=y.useState(null),[z,X]=y.useState(P),[Y,Q]=y.useState(I),u=q(),Z=async r=>{var g;r.preventDefault(),s(!0);const C=new FormData;if(Object.keys(n).forEach(h=>{C.append(h,n[h])}),W){const h=W.type;if(["image/jpeg","image/jpg","image/png"].includes(h))C.append("profile_image",W);else{S.error("Invalid file type. Only JPEG and PNG are allowed.",{icon:"游댮",style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:u.glassCard.backgroundColor,border:u.glassCard.border,color:u.palette.text.primary}}),s(!1);return}}try{const h=await axios.post(route("addUser"),C);h.status===200&&(l(h.data.user),S.success(((g=h.data.messages)==null?void 0:g.length)>0?h.data.messages.join(" "):"Profile information updated successfully",{icon:"游릭",style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:u.glassCard.backgroundColor,border:u.glassCard.border,color:u.palette.text.primary}}),D())}catch(h){s(!1),K(h)}finally{s(!1)}},K=r=>{r.response?r.response.status===422?(d(r.response.data.errors||{}),S.error(r.response.data.error||"Failed to update profile information.",{icon:"游댮",style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:u.glassCard.backgroundColor,border:u.glassCard.border,color:u.palette.text.primary}})):S.error("An unexpected error occurred. Please try again later.",{icon:"游댮",style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:u.glassCard.backgroundColor,border:u.glassCard.border,color:u.palette.text.primary}}):r.request?S.error("No response received from the server. Please check your internet connection.",{icon:"游댮",style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:u.glassCard.backgroundColor,border:u.glassCard.border,color:u.palette.text.primary}}):S.error("An error occurred while setting up the request.",{icon:"游댮",style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:u.glassCard.backgroundColor,border:u.glassCard.border,color:u.palette.text.primary}})},ee=r=>{const C=r.target.files[0];if(C){const g=URL.createObjectURL(C);V(g),$(C)}},x=(r,C)=>{console.log(r,C),E(g=>{const h={...g,[r]:C};return C===""&&delete h[r],h}),R(g=>{const h={...g,[r]:C};return C===""&&delete h[r],h})};return y.useEffect(()=>{(a==null?void 0:a.department)!==n.department&&(n.designation=null,n.report_to=null),X(P.filter(g=>g.department_id===(c.department||n.department))),Q(I.filter(g=>g.department===(c.department||n.department)));const r={...c};for(const g in r)a&&g!=="id"&&r[g]===a[g]&&delete r[g];const C=Object.keys(r).length>1;b(C)},[n,c]),console.log(n),p(Me,{open:N,onClose:D,children:[p(ie,{style:{cursor:"move"},id:"draggable-dialog-title",children:[e(ce,{children:"Profile Information"}),e(B,{variant:"outlined",color:"primary",onClick:D,sx:{position:"absolute",top:8,right:16},children:e(Ie,{})})]}),p("form",{onSubmit:Z,children:[e(me,{children:p(f,{container:!0,spacing:2,children:[e(f,{item:!0,xs:12,display:"flex",alignItems:"center",justifyContent:"center",children:p(T,{position:"relative",display:"inline-block",onMouseEnter:()=>v(!0),onMouseLeave:()=>v(!1),children:[e(pe,{alt:c.name||n.name,src:U||(a==null?void 0:a.profile_image),sx:{width:100,height:100}}),m&&e(_,{children:e(T,{sx:{position:"absolute",top:0,left:0,width:"100%",height:"100%",bgcolor:"rgba(0, 0, 0, 0.5)",borderRadius:"50%",display:"flex",justifyContent:"center",alignItems:"center"},children:e(B,{color:"primary",component:"span",children:e(Ue,{})})})}),e("input",{accept:"image/*",style:{display:"none"},id:"upload-button",type:"file",onChange:ee}),e("label",{htmlFor:"upload-button",children:e(T,{sx:{position:"absolute",width:"100%",height:"100%",top:0,left:0,borderRadius:"50%",cursor:"pointer"}})})]})}),e(f,{item:!0,xs:12,md:6,children:e(k,{type:"text",label:"Name",variant:"bordered",isInvalid:!!o.name,errorMessage:o.name,fullWidth:!0,value:c.name||n.name||"",onChange:r=>x("name",r.target.value)})}),e(f,{item:!0,xs:12,md:6,children:e(k,{label:"Username",fullWidth:!0,value:c.user_name||n.user_name||"",onChange:r=>x("user_name",r.target.value),type:"text",variant:"bordered",isInvalid:!!o.user_name,errorMessage:o.user_name})}),e(f,{item:!0,xs:12,md:6,children:e(k,{label:"Email Adress",fullWidth:!0,value:c.email||n.email,onChange:r=>x("email",r.target.value),type:"email",variant:"bordered",isInvalid:!!o.email,errorMessage:o.email})}),e(f,{item:!0,xs:12,md:6,children:e(k,{label:"Phone Number",fullWidth:!0,value:c.phone||n.phone,onChange:r=>x("phone",r.target.value),type:"tel",variant:"bordered",isInvalid:!!o.phone,errorMessage:o.phone})}),e(f,{item:!0,xs:12,md:6,children:e(k,{variant:"bordered",errorMessage:o.password,isInvalid:!!o.password,label:"Password",type:F?"text":"password",value:c.password||n.password,onChange:r=>x("password",r.target.value),fullWidth:!0,endContent:e(B,{onClick:()=>A(!F),edge:"end",children:F?e(Ae,{}):e(Ee,{})})})}),e(f,{item:!0,xs:12,md:6,children:e(k,{label:"Confirm Password",type:"password",variant:"bordered",errorMessage:o.confirmPassword,isInvalid:!!o.confirmPassword,value:c.confirmPassword||n.confirmPassword,onChange:r=>x("confirmPassword",r.target.value),fullWidth:!0})}),e(f,{item:!0,xs:12,md:6,children:p(j,{variant:"bordered",fullWidth:!0,label:"Gender",placeholder:"Select Gender",value:c.gender||n.gender||"na",onChange:r=>{console.log(r),x("gender",r.target?r.target.value:r)},errorMessage:!!o.gender,popoverProps:{classNames:{content:"bg-transparent backdrop-blur-lg border-inherit"}},children:[e(w,{value:"na",disabled:!0,children:"Select Gender"}),e(w,{value:"Male",children:"Male"}),e(w,{value:"Female",children:"Female"})]})}),e(f,{item:!0,xs:12,md:6,children:e(k,{label:"Birth Date",type:"date",fullWidth:!0,variant:"bordered",value:c.birthday||n.birthday||"",onChange:r=>x("birthday",r.target.value),isInvalid:!!o.birthday,errorMessage:o.birthday})}),e(f,{item:!0,xs:12,md:6,children:e(k,{label:"Joining Date",type:"date",variant:"bordered",fullWidth:!0,value:c.date_of_joining||n.date_of_joining||"",onChange:r=>x("date_of_joining",r.target.value),isInvalid:!!o.date_of_joining,errorMessage:o.date_of_joining})}),e(f,{item:!0,xs:12,children:e(k,{label:"Address",fullWidth:!0,type:"text",variant:"bordered",value:c.address||n.address,onChange:r=>x("address",r.target.value),isInvalid:!!o.address,errorMessage:o.address})}),e(f,{item:!0,xs:12,md:6,children:e(k,{label:"Employee ID",type:"text",variant:"bordered",fullWidth:!0,value:c.employee_id||n.employee_id||"",onChange:r=>x("employee_id",r.target.value),isInvalid:!!o.employee_id,errorMessage:o.employee_id})}),e(f,{item:!0,xs:12,md:6,children:p(j,{variant:"bordered",fullWidth:!0,label:"Department",placeholder:"Select Department",value:c.department||n.department||"na",onChange:r=>{console.log(r),x("department",r.target?r.target.value:r)},errorMessage:!!o.department,popoverProps:{classNames:{content:"bg-transparent backdrop-blur-lg"}},children:[e(w,{value:"na",disabled:!0,children:"Select Department"}),M.map(r=>e(w,{value:r.id,children:r.name},r.id))]})}),e(f,{item:!0,xs:12,md:6,children:p(j,{variant:"bordered",fullWidth:!0,label:"Designation",placeholder:"Select Designation",value:c.designation||n.designation||"na",onChange:r=>{console.log(r),x("designation",r.target?r.target.value:r)},errorMessage:o.designation?"This field is required":"",disabled:!(a!=null&&a.department),popoverProps:{classNames:{content:"bg-transparent backdrop-blur-lg"}},children:[e(w,{value:"na",disabled:!0,children:"Select Designation"}),z.map(r=>e(w,{value:r.id,children:r.title},r.id))]})}),e(f,{item:!0,xs:12,md:6,children:p(j,{variant:"bordered",fullWidth:!0,label:"Reports To",placeholder:"Select Reports To",value:c.report_to||n.report_to,onChange:r=>{console.log(r),x("report_to",r.target?r.target.value:r)},errorMessage:o.report_to?"This field is required":"",disabled:(a==null?void 0:a.report_to)==="na",popoverProps:{classNames:{content:"bg-transparent backdrop-blur-lg"}},children:[e(w,{value:"na",disabled:!0,children:"--"}),Y.map(r=>e(w,{value:r.id,children:r.name},r.id))]})})]})}),e(ue,{sx:{display:"flex",alignItems:"center",justifyContent:"center",padding:"16px"},children:e(Be,{disabled:!t,sx:{borderRadius:"50px",padding:"6px 16px"},variant:"outlined",color:"primary",type:"submit",loading:i,children:"Submit"})})]})]})},Re=({title:a,roles:I,departments:M,designations:P})=>{const l=q(),N=ge(l.breakpoints.down("md")),[D,F]=y.useState(null),[A,n]=y.useState(re().props.allUsers),E=R=>{F(R)};return p(_,{children:[e(ae,{title:a}),D==="add"&&e(Ne,{allUsers:A,departments:M,designations:P,open:D==="add",setUsers:n,closeModal:()=>{F(null)}}),e(T,{sx:{display:"flex",justifyContent:"center",p:2},children:e(he,{in:!0,children:p(Ce,{children:[e(be,{title:"Employees",sx:{padding:"24px"},action:e(T,{display:"flex",gap:2,children:N?e(_,{children:e(H,{isIconOnly:!0,title:"Add Employee",variant:"bordered",color:"success",onClick:()=>E("add"),children:e(J,{})})}):e(_,{children:e(H,{title:"Add Employee",variant:"bordered",color:"success",startContent:e(J,{}),onClick:()=>E("add"),children:"Add Employee"})})})}),e(fe,{children:e(Te,{allUsers:A,roles:I})})]})})})]})};Re.layout=a=>e(ye,{children:a});export{Re as default};
