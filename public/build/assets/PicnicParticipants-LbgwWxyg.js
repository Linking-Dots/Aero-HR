import{V as se,j as l,a as e,F as G,M as he}from"./app-B0EkXB6P.js";import{u as le,r as a,W as oe,T as me,c as ge,G as u,F as Q,k as L,S as ee,M as Y,U as te,b as W,B as ne,X as be,Y as ie,Z as de,t as ce,$ as ye,f as z,e as fe,h as Ce,a as ae}from"./vendor-DG6x5ItM.js";import{d as xe}from"./Search-C09yah2e.js";import{B as ue,G as ve,A as Pe}from"./App-Lcca0Ucc.js";import{d as Se,G as pe}from"./GlassDialog-CUJi_Q68.js";import{L as De}from"./LoadingButton-D7xyitX5.js";import{d as ke}from"./dayjs.min-DoTx5zCQ.js";import{A as _e}from"./Add-BAkyKogE.js";import{i as re}from"./chunk-HJTJQZF3-fM_PQaBX.js";import{t as Te,a as we,b as Fe,c as Be,d as Ee,e as Ie}from"./chunk-F3UDT23P-DfbpX8wK.js";import{p as Me}from"./chunk-YHY32LNM-CCJ1ikQC.js";import"./chunk-2BFF5KFD-BBpGbtWI.js";import"./chunk-SLABUSGS-B6gW2mYM.js";import"./chunk-MZRCPRP2-C0G3_1Rf.js";import"./chunk-7F3ZLNJ6-DcgTPguD.js";const Re=({open:C,closeModal:b,leavesData:y,setLeavesData:B,currentLeave:t,allUsers:x,setTotalRows:E,setLastPage:p,setLeaves:I,handleMonthChange:h,employee:j})=>{const{auth:M}=se().props,o=le(),[v,H]=a.useState((t==null?void 0:t.user_id)||M.user.id),[m,D]=a.useState(y.leaveTypes||[]),[k,_]=a.useState(y.leaveCounts||[]),[P,R]=a.useState((t==null?void 0:t.leave_type)||(m.length>0?m[0].type:"")),[T,w]=a.useState((t==null?void 0:t.from_date)||""),[A,N]=a.useState((t==null?void 0:t.to_date)||""),[q,J]=a.useState((t==null?void 0:t.no_of_days)||""),[O,$]=a.useState(""),[U,V]=a.useState((t==null?void 0:t.reason)||""),[n,X]=a.useState({}),[s,g]=a.useState(!1),[F,Z]=a.useState("");return a.useEffect(()=>{y&&(D(y.leaveTypes||[]),_(y.leaveCountsByUser[v]||[]))},[y,v]),a.useEffect(()=>{var c;const r=((c=k==null?void 0:k.find(d=>d.leave_type===P))==null?void 0:c.days_used)||0;Z(r);const S=m==null?void 0:m.find(d=>d.type===P);S&&$(S.days-r)},[P,k,m]),a.useEffect(()=>{J(((S,c)=>{if(!S||!c)return"";const d=new Date(S),i=new Date(c);if(d>i)return"";const f=i.getTime()-d.getTime();return Math.ceil(f/(1e3*3600*24))+1})(T,A))},[T,A]),l(pe,{open:C,onClose:b,fullWidth:!0,maxWidth:"sm",children:[l(oe,{sx:{display:"flex",alignItems:"center"},children:[e(me,{variant:"h6",children:"Add Leave"}),e(ge,{onClick:b,sx:{position:"absolute",top:8,right:16},children:e(Se,{})})]}),l("form",{onSubmit:async r=>{r.preventDefault(),g(!0);const S=new Promise(async(c,d)=>{try{const i={route:route().current(),user_id:v,leaveType:P,fromDate:T,toDate:A,daysCount:q,leaveReason:U,employee:j};t&&(i.id=t.id);const f=await axios.post(route("leave-add"),i);f.status===200&&(B(f.data.leavesData),E(f.data.leavesData.leaveRecords.total),p(f.data.leavesData.leaveRecords.last_page),I(f.data.leavesData.leaveRecords.data),h({target:{value:T.slice(0,7)}}),b(),c([f.data.message||"Leave application submitted successfully"]))}catch(i){console.error(i),g(!1),i.response?(i.response.status===422?(X(i.response.data.errors||{}),d(i.response.data.error||"Failed to submit leave application")):d("An unexpected error occurred. Please try again later."),console.error(i.response.data.error)):i.request?(d("No response received from the server. Please check your internet connection."),console.error(i.request)):(d("An error occurred while setting up the request."),console.error("Error",i.message))}finally{g(!1)}});ue.promise(S,{pending:{render(){return l("div",{style:{display:"flex",alignItems:"center"},children:[e(ce,{}),e("span",{style:{marginLeft:"8px"},children:"Submitting leave application..."})]})},icon:!1,style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:o.glassCard.backgroundColor,border:o.glassCard.border,color:o.palette.text.primary}},success:{render({data:c}){return e(G,{children:c.map((d,i)=>e("div",{children:d},i))})},icon:"ðŸŸ¢",style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:o.glassCard.backgroundColor,border:o.glassCard.border,color:o.palette.text.primary}},error:{render({data:c}){return e(G,{children:c})},icon:"ðŸ”´",style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:o.glassCard.backgroundColor,border:o.glassCard.border,color:o.palette.text.primary}}})},children:[e(ie,{children:l(u,{container:!0,spacing:2,children:[e(u,{item:!0,xs:12,md:6,children:l(Q,{fullWidth:!0,children:[e(L,{id:"leave-type-label",children:"Leave Type"}),l(ee,{labelId:"leave-type-label",value:P,onChange:r=>R(r.target.value),label:"Leave Type",error:!!n.leaveType,MenuProps:{PaperProps:{sx:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:o.glassCard.backgroundColor,border:o.glassCard.border,borderRadius:2,boxShadow:o.glassCard.boxShadow}}},children:[e(Y,{value:"",disabled:!0,children:"Select Leave Type"}),m.map(r=>l(Y,{value:r.type,children:[r.type," ",r.days," Days"]},r.id))]}),e(te,{children:n.leaveType})]})}),e(u,{item:!0,xs:12,md:6,children:e(W,{label:"From",type:"date",fullWidth:!0,value:T,onChange:r=>w(r.target.value),InputLabelProps:{shrink:!0},error:!!n.fromDate,helperText:n.fromDate})}),e(u,{item:!0,xs:12,md:6,children:e(W,{label:"To",type:"date",fullWidth:!0,value:A,onChange:r=>N(r.target.value),InputLabelProps:{shrink:!0},error:!!n.toDate,helperText:n.toDate})}),e(u,{item:!0,xs:12,md:6,children:e(W,{label:"Number of days",type:"text",fullWidth:!0,value:q,InputProps:{readOnly:!0},error:!!n.daysCount,helperText:n.daysCount})}),e(u,{item:!0,xs:12,md:6,children:e(W,{label:"Remaining Leaves",type:"text",fullWidth:!0,value:O,InputProps:{readOnly:!0},error:!!n.remainingLeaves,helperText:n.remainingLeaves})}),M.roles.includes("Administrator")&&route().current()==="leaves"&&e(u,{item:!0,xs:12,md:6,children:l(Q,{fullWidth:!0,children:[e(L,{id:"leave-employee-label",children:"Employee"}),l(ee,{variant:"outlined",fullWidth:!0,labelId:"leave-employee-label",value:v||"na",error:!!n.user_id,onChange:r=>H(r.target.value),label:"Employee",MenuProps:{PaperProps:{sx:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:o.glassCard.backgroundColor,border:o.glassCard.border,borderRadius:2,boxShadow:o.glassCard.boxShadow}}},children:[e(Y,{value:"na",disabled:!0,children:"Please select"}),x.map(r=>e(Y,{value:r.id,children:l(ne,{sx:{display:"flex"},children:[e(be,{src:r.profile_image,alt:r.name||"Not assigned",sx:{borderRadius:"50%",width:23,height:23,display:"flex",mr:1}}),r.name]})},r.id))]}),e(te,{children:n.user_id})]})}),e(u,{item:!0,xs:12,children:e(W,{label:"Leave Reason",multiline:!0,rows:4,fullWidth:!0,value:U,onChange:r=>V(r.target.value),error:!!n.leaveReason,helperText:n.leaveReason})})]})}),e(de,{sx:{padding:"16px",justifyContent:"center"},children:e(De,{type:"submit",variant:"outlined",color:"primary",loading:s,disabled:s,sx:{borderRadius:"50px"},children:"Submit"})})]})]})},Ae=({open:C,handleClose:b,leaveIdToDelete:y,setLeavesData:B})=>{const t=le();return l(pe,{open:C,onClose:b,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e(oe,{id:"alert-dialog-title",children:"Confirm Deletion"}),e(ie,{children:e(ye,{id:"alert-dialog-description",children:"Are you sure you want to delete this leave? This action cannot be undone."})}),l(de,{children:[e(z,{onClick:b,color:"primary",children:"Cancel"}),e(z,{onClick:()=>{const E=new Promise(async(p,I)=>{try{const h=await axios.delete(route("leave-delete",{id:y,route:route().current()}));h.status===200&&(B(h.data.leavesData),p("Leave application deleted successfully"))}catch(h){console.error("Error deleting task:",h),I(h.response.data.error||"Failed to delete leave application")}finally{b()}});ue.promise(E,{pending:{render(){return l("div",{style:{display:"flex",alignItems:"center"},children:[e(ce,{}),e("span",{style:{marginLeft:"8px"},children:"Deleting leave application..."})]})},icon:!1,style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:t.glassCard.backgroundColor,border:t.glassCard.border,color:t.palette.text.primary}},success:{render({data:p}){return e(G,{children:p})},icon:"ðŸŸ¢",style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:t.glassCard.backgroundColor,border:t.glassCard.border,color:t.palette.text.primary}},error:{render({data:p}){return e(G,{children:p})},icon:"ðŸ”´",style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:t.glassCard.backgroundColor,border:t.glassCard.border,color:t.palette.text.primary}}})},color:"error",autoFocus:!0,children:"Delete"})]})]})},We=({title:C,allUsers:b})=>{const{auth:y,props:B}=se(),[t,x]=a.useState(null),[E,p]=a.useState(B.leavesData),[I,h]=a.useState(),[j,M]=a.useState(0),[o,v]=a.useState(0),[H,m]=a.useState(null),[D,k]=a.useState(""),[_,P]=a.useState(ke().format("YYYY-MM")),[R,T]=a.useState(30),[w,A]=a.useState(1),[N,q]=a.useState(),[J,O]=a.useState(""),$=s=>x(s);a.useCallback((s,g)=>{m(s),x(g)},[]);const U=a.useCallback(()=>{x(null),m(null)},[]),V=s=>k(s.target.value.toLowerCase()),n=s=>{P(s.target.value)},X=async()=>{var s,g;try{const F=await axios.get(route("leaves.paginate"),{params:{page:w,perPage:R,employee:D,month:_}});if(F.status===200){const{data:Z,total:K,last_page:r}=F.data.leaves;h(Z),M(K),v(r)}}catch(F){console.error("Error fetching leaves data:",F),O(((g=(s=F.response)==null?void 0:s.data)==null?void 0:g.message)||"Error retrieving data.")}};return a.useEffect(()=>{X()},[_,w,R,D]),l(G,{children:[e(he,{title:C}),["add_leave","edit_leave"].includes(t)&&e(Re,{setTotalRows:M,setLastPage:v,setPicnicParticipants:h,perPage:R,employee:D,currentPage:w,selectedMonth:_,allUsers:b,open:!0,setPicnicParticipantsData:p,closeModal:()=>x(null),leavesData:E,currentPicnicParticipant:t==="edit_leave"?N:null,handleMonthChange:n}),t==="delete_leave"&&e(Ae,{open:!0,handleClose:U,leaveIdToDelete:H,setPicnicParticipantsData:p}),e(ne,{sx:{display:"flex",justifyContent:"center",p:2},children:e(fe,{in:!0,children:l(ve,{children:[e(Ce,{title:"Picnic Participants",sx:{padding:"24px"},action:e(z,{title:"Add Picnic Participant",variant:"outlined",color:"success",startIcon:e(_e,{}),onClick:()=>$("add_leave"),children:"Add Picnic Participant"})}),e(ae,{children:l(u,{container:!0,spacing:2,children:[e(u,{item:!0,xs:12,sm:6,md:4,children:e(re,{label:"Search",fullWidth:!0,variant:"bordered",placeholder:"Employee...",value:D,onChange:V,endContent:e(xe,{})})}),e(u,{item:!0,xs:12,sm:6,md:4,children:e(re,{label:"Select Month",type:"month",variant:"bordered",onChange:n,value:_})})]})}),e(ae,{children:l("div",{style:{maxHeight:"84vh",overflowY:"auto"},children:[l(Te,{isStriped:!0,selectionMode:"multiple",selectionBehavior:"toggle",isCompact:!0,isHeaderSticky:!0,removeWrapper:!0,"aria-label":"Picnic Participant Employee Table",children:[e(we,{columns,children:s=>e(Fe,{align:s.uid==="actions"?"center":"start",children:s.name},s.uid)}),e(Be,{items:I,children:s=>e(Ee,{children:g=>e(Ie,{style:{whiteSpace:"nowrap"},children:renderCell(s,g)})},s.id)})]}),j>10&&e("div",{className:"py-2 px-2 flex justify-center items-end",style:{height:"100%"},children:e(Me,{initialPage:1,isCompact:!0,showControls:!0,showShadow:!0,color:"primary",variant:"bordered",page:w,total:o,onChange:handlePageChange})})]})})]})})})]})};We.layout=C=>e(Pe,{children:C});export{We as default};
