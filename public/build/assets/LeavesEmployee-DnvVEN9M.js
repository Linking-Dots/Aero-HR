import{J as _e,r as l,a as X,j as a,b as m,Q as we,f as Ne,h as Z,c as F,e as B,F as Ce,d as ke}from"./app-_fBEAKGv.js";import{d as K}from"./dayjs.min-CEpEuDpB.js";import{u as xe,B as Le,G as Se,T as g}from"./logo-Doov_oAp.js";import{P as Pe}from"./PageHeader-DQbVe1Ha.js";import{u as U,B as G,b as Y,G as Me,A as Fe}from"./App-D7mnl0rW.js";import{L as ee,D as Be,B as Ye,a as Te,b as De}from"./BulkDeleteModal-2G3y9UXD.js";import{F as ae}from"./ChartBarIcon-BZQWy-ZV.js";import{C as Re}from"./CircularProgress-C4tAYJkY.js";import{F as Ae}from"./XCircleIcon-C78QXoz9.js";import{F as Ee}from"./PlusIcon-B93dmN1o.js";import{F as Ie}from"./PresentationChartLineIcon-DnlYMu2g.js";import{s as ze,l as je}from"./chunk-2GIFKCNQ-CtLgxA1F.js";import{c as Oe}from"./chunk-D5XJWRAV-CKiICMNA.js";import"./app-CX8GSXRI.js";import"./create-visual-element-COMdWoDg.js";import"motion-dom";import"./EnvelopeIcon-Bzg3iM2a.js";import"./UserIcon-zPmqLCda.js";import"./ShieldCheckIcon-CFNet5UT.js";import"./chunk-6MDMHKHV-DPPAXvv7.js";import"./TrashIcon-87edl8fu.js";import"./PencilIcon-CBHFuzMe.js";import"./EllipsisVerticalIcon-DyXenDSg.js";import"./CheckCircleIcon-BBYS3oJu.js";import"./ClockIcon-DXiz9gfz.js";import"./ExclamationTriangleIcon-Cs3Z4zDH.js";import"./CardContent-Cgmaqpts.js";import"./colorManipulator-D0SwyKok.js";import"./chunk-F3UDT23P-BTULbAsi.js";import"./chunk-MZRCPRP2-2mfEZoxY.js";import"./useHasTabbableChild-WSNeSo8t.js";import"./chunk-7F3ZLNJ6-fcDdTbkF.js";import"./chunk-7ZZXWEXF-Dd_2ES6i.js";import"./chunk-R6AK6OQ4-BdPXzNvl.js";import"./chunk-O5I3QTYU-xPbw-PaW.js";import"./index-CokAva9Y.js";import"./Clear-CYfXmgbF.js";import"./GlassDialog-3ukC7agG.js";import"./Dialog-g9X2aT8y.js";import"./DialogTitle-Bgoxt4Wz.js";import"./DialogContent-CN9m-QLp.js";import"./TextField-DtCy84kv.js";import"./Select-CovYC41-.js";import"./Popover-QXU3_HMD.js";import"./Avatar-BP97WDXp.js";import"./useSlot-cZeDc8qW.js";import"./LoadingButton-C_o6DdHk.js";import"./Button-D-EfDwIb.js";import"./DialogContentText-D1W5680b.js";import"./CardHeader-C0sjRh_R.js";import"./InformationCircleIcon-CGF2jvuV.js";import"./XCircleIcon-D7m7Nibs.js";import"./ExclamationTriangleIcon-jnGiZYOV.js";import"./CheckCircleIcon-Lv7LzbCy.js";import"./ListItemText-CivQVqMk.js";import"./Divider-CYpvgi-B.js";const $e=({title:z,allUsers:h})=>{const{auth:L}=_e().props,H=xe(),S=U(H.breakpoints.down("sm")),te=U(H.breakpoints.down("md")),[f,T]=l.useState(0),[j,D]=l.useState(0),[Q,Ge]=l.useState(!1),[C,p]=l.useState([]),[w,k]=l.useState({leaveTypes:[],leaveCountsByUser:{}}),[q,v]=l.useState(!1),[J,O]=l.useState(""),[o,$]=l.useState({page:1,perPage:30,total:0,lastPage:0}),[n,re]=l.useState({employee:"",selectedMonth:K().format("YYYY-MM"),year:new Date().getFullYear()}),u=l.useCallback(e=>{e&&(T(e.total||0),D(e.last_page||1),$(r=>({...r,total:e.total||0,lastPage:e.last_page||1})))},[]),b=l.useCallback(async()=>{var e,r,t;v(!0);try{const{page:s,perPage:i}=o,{year:c}=n,_=await X.get(route("leaves.paginate"),{params:{page:s,perPage:i,year:c,user_id:L.user.id},timeout:1e4});if(_.status===200){const{leaves:y,leavesData:ye}=_.data;y.data&&Array.isArray(y.data)?(p(y.data),u({total:y.total||y.data.length,last_page:y.last_page||1,current_page:y.current_page||1,per_page:y.per_page||o.perPage})):Array.isArray(y)?(p(y),u({total:y.length,last_page:1,current_page:1,per_page:o.perPage})):(console.error("Unexpected leaves data format:",y),p([]),u({total:0,last_page:1,current_page:1,per_page:o.perPage})),k(ye),O("")}}catch(s){if(console.error("Error fetching leaves:",s),((e=s.response)==null?void 0:e.status)===404){const{leavesData:i}=s.response.data;k(i),O(((t=(r=s.response)==null?void 0:r.data)==null?void 0:t.message)||"No leaves found for the selected criteria.")}else{O("Error retrieving leaves data. Please try again.");const i=Promise.reject("Failed to load leave data. Please try again.");G.promise(i,{error:{render(){return a("div",{children:"Failed to load leave data. Please try again."})},icon:"❌"}})}p([]),u({total:0,last_page:1,current_page:1,per_page:o.perPage})}finally{v(!1)}},[o.page,o.perPage,n,L.user.id,u]),R=l.useCallback((e,r,t)=>{const{page:s,perPage:i}=o;e.length>=i||s<j||b()},[o,j,b]),se=l.useMemo(()=>{const e=new Date().getFullYear();return Array.from({length:e-1900+1},(r,t)=>{const s=1900+t;return{key:s.toString(),label:s.toString(),value:s}}).reverse()},[]),V=l.useCallback((e,r)=>{if(e==="year"){const t=Number(r);if(t<1900||t>new Date().getFullYear()){console.warn("Invalid year selected. Must be between 1900 and current year.");return}}re(t=>({...t,[e]:r})),e==="year"&&$(t=>({...t,page:1}))},[]),[N,A]=l.useState({add_leave:!1,edit_leave:!1,delete_leave:!1,bulk_leave:!1,bulk_delete:!1});l.useCallback((e,r=null)=>{A(t=>({...t,[e]:!0}))},[]);const M=l.useCallback(()=>{A({add_leave:!1,edit_leave:!1,delete_leave:!1,bulk_leave:!1,bulk_delete:!1})},[]),E=l.useCallback(e=>{A(r=>({...r,[e]:!0}))},[]),le=l.useCallback((e,r)=>{W({id:e}),A(t=>({...t,[r]:!0}))},[]),[I,W]=l.useState(null),[oe,ne]=l.useState([]),ie=l.useCallback(e=>{W(e)},[]),ce=l.useCallback(e=>{ne(e),E("bulk_delete")},[E]),d=l.useCallback(async()=>{try{const e=await X.get(route("leaves.stats"),{params:{year:n.year}});if(e.status===200){const{stats:r,leaveCounts:t}=e.data;t&&k(s=>({...s,leaveCountsByUser:{...s.leaveCountsByUser,[L.user.id]:t}}))}}catch(e){console.error("Error fetching leaves stats:",e.response)}},[n.year,L.user.id]),de=l.useCallback(e=>{e!==o.page&&$(r=>({...r,page:e}))},[o.page]);l.useEffect(()=>{b()},[b]),l.useEffect(()=>{d()},[d]);const me=l.useMemo(()=>w.leaveCountsByUser[L.user.id]||[],[w.leaveCountsByUser,L.user.id]),P=l.useCallback(e=>[...e].sort((r,t)=>new Date(r.from_date)-new Date(t.from_date)),[]),x=l.useCallback(e=>{const r=new Date(e.from_date).getFullYear();if(n.year&&r!==n.year)return!1;if(n.employee){const t=h==null?void 0:h.find(i=>String(i.id)===String(e.user_id)),s=n.employee.trim().toLowerCase();if(t){if(String(t.id)!==s&&!(t.name&&t.name.trim().toLowerCase().includes(s)))return!1}else if(String(n.employee)!==String(e.user_id))return!1}if(n.selectedMonth&&K(e.from_date).format("YYYY-MM")!==n.selectedMonth||n.status&&n.status!=="all"&&String(e.status).toLowerCase()!==String(n.status).toLowerCase()||n.leaveType&&n.leaveType!=="all"&&String(e.leave_type).toLowerCase()!==String(n.leaveType).toLowerCase())return!1;if(n.department&&n.department!=="all"){const t=h==null?void 0:h.find(s=>String(s.id)===String(e.user_id));if(!t||String(t.department).toLowerCase()!==String(n.department).toLowerCase())return!1}return!0},[n,h]);l.useMemo(()=>C||[],[C]);const ue=l.useCallback(e=>{x(e)&&(v(!0),p(r=>{const t=[...r,e];return P(t).slice(0,o.perPage)}),u({total:f+1,last_page:Math.ceil((f+1)/o.perPage),current_page:o.page,per_page:o.perPage}),v(!1),o.page!==1&&b(),d())},[x,P,o,f,u,b,d]),pe=l.useCallback(e=>{var i;if(!e||!e.success){console.error("Invalid bulk response data:",e);return}e.leavesData&&k(e.leavesData);const r=e.created_leaves||[];if(r.length===0){d();return}const t=r.filter(c=>x(c));if(t.length===0){d();return}v(!0),p(c=>{const _=[...c,...t];return P(_).slice(0,o.perPage)});const s=((i=e.summary)==null?void 0:i.successful)||r.length;u({total:f+s,last_page:Math.ceil((f+s)/o.perPage),current_page:o.page,per_page:o.perPage}),v(!1),o.page!==1&&b(),d()},[x,P,o,f,u,b,d]),ge=l.useCallback(e=>{const r=C.some(s=>s.id===e.id);if(v(!0),!x(e)&&r){p(i=>i.filter(c=>c.id!==e.id));const s=Promise.resolve();G.promise(s,{success:{render(){return a("div",{children:"Leave removed from filtered view."})},icon:"ℹ️"}}),v(!1);return}if(!r&&!x(e)){v(!1);return}p(s=>{const i=s.some(_=>_.id===e.id);let c;return i?c=s.map(_=>_.id===e.id?e:_):c=[...s,e],P(c).slice(0,o.perPage)});const t=Promise.resolve();G.promise(t,{success:{render(){return a("div",{children:"Leave updated!"})},icon:"✅"}}),v(!1),o.page!==1&&b(),d()},[x,P,C,o,b,d]),he=l.useCallback(e=>{p(t=>{const s=t.filter(c=>c.id!==e),i=Math.max(0,f-1);return R(s,i,"delete"),s});const r=Math.max(0,f-1);u({total:r,last_page:Math.max(1,Math.ceil(r/o.perPage)),current_page:o.page,per_page:o.perPage}),d()},[d,f,o,u,R]),fe=l.useCallback(e=>{if(!e||!e.success){console.error("Invalid bulk delete response data:",e);return}e.leavesData&&k(e.leavesData);const r=e.deleted_leaves||[],t=r.map(c=>c.id);if(t.length===0){d();return}v(!0),p(c=>c.filter(_=>!t.includes(_.id)));const s=e.deleted_count||r.length,i=Math.max(0,f-s);u({total:i,last_page:Math.max(1,Math.ceil(i/o.perPage)),current_page:o.page,per_page:o.perPage}),v(!1),R(C.filter(c=>!t.includes(c.id)),i,"delete"),d()},[u,o,f,C,R,d]),ve=()=>w.leaveTypes.length?a("div",{className:`grid gap-4 ${S?"grid-cols-1":te?"grid-cols-2":"grid-cols-4"}`,children:w.leaveTypes.map(({type:e})=>{const r=me.find(c=>c.leave_type===e)||{},t=r.days_used||0,s=r.remaining_days||0,i=t+s;return m(F,{className:"bg-white/10 backdrop-blur-md border-white/20 hover:bg-white/15 transition-all duration-200",children:[a(Oe,{className:"pb-2",children:m("div",{className:"flex items-center gap-2",children:[a(Y,{className:"w-5 h-5"}),a(g,{variant:S?"subtitle1":"h6",className:"font-semibold truncate",children:e})]})}),a(B,{className:"pt-0",children:m("div",{className:"space-y-3",children:[m("div",{className:"flex justify-between items-center",children:[m("div",{className:"text-center",children:[a(g,{variant:"caption",color:"textSecondary",children:"Used"}),a(g,{variant:S?"h6":"h5",className:"font-bold text-red-400",children:t})]}),a(ke,{orientation:"vertical",className:"h-8"}),m("div",{className:"text-center",children:[a(g,{variant:"caption",color:"textSecondary",children:"Remaining"}),a(g,{variant:S?"h6":"h5",className:"font-bold text-green-400",children:s})]})]}),i>0&&a("div",{className:"w-full bg-gray-200 rounded-full h-2",children:a("div",{className:"bg-gradient-to-r from-red-400 to-orange-400 h-2 rounded-full transition-all duration-300",style:{width:`${t/i*100}%`}})})]})})]},e)})}):a(F,{className:"bg-white/10 backdrop-blur-md border-white/20",children:m(B,{className:"text-center py-8",children:[a(ae,{className:"w-12 h-12 mx-auto mb-4 text-gray-400"}),a(g,{variant:"body1",color:"textSecondary",children:"No leave types available"})]})}),be=l.useRef(null);return m(Ce,{children:[a(we,{title:z}),N.add_leave&&a(ee,{open:N.add_leave,closeModal:()=>M(),leavesData:w,setLeavesData:k,currentLeave:null,allUsers:h,setTotalRows:T,setLastPage:D,setLeaves:p,employee:"",selectedMonth:n.selectedMonth,addLeaveOptimized:ue,updatePaginationMetadata:u,fetchLeavesStats:d}),N.edit_leave&&a(ee,{open:N.edit_leave,closeModal:()=>M(),leavesData:w,setLeavesData:k,currentLeave:I,allUsers:h,setTotalRows:T,setLastPage:D,setLeaves:p,employee:"",selectedMonth:n.selectedMonth,updateLeaveOptimized:ge,updatePaginationMetadata:u,fetchLeavesStats:d}),N.delete_leave&&a(Be,{open:N.delete_leave,closeModal:()=>M(),leaveId:I==null?void 0:I.id,setLeaves:p,setTotalRows:T,setLastPage:D,deleteLeaveOptimized:he,updatePaginationMetadata:u,fetchLeavesStats:d}),N.bulk_leave&&a(Ye,{open:N.bulk_leave,onClose:()=>M(),onSuccess:e=>{pe(e)},allUsers:h,leavesData:w,isAdmin:!1,existingLeaves:C||[],publicHolidays:(w==null?void 0:w.publicHolidays)||[]}),N.bulk_delete&&a(Te,{open:N.bulk_delete,onClose:()=>M(),onSuccess:e=>{fe(e)},selectedLeaves:oe,allUsers:h}),m(Le,{sx:{display:"flex",justifyContent:"center",p:2},children:["        ",a(Me,{in:!0,children:a(Se,{children:a(Pe,{title:"My Leaves",subtitle:"Your leave requests and balances",icon:a(Ie,{className:"w-8 h-8"}),variant:"gradient",actionButtons:[{label:"Add Leave",icon:a(Ee,{className:"w-4 h-4"}),onPress:()=>E("add_leave"),className:"bg-gradient-to-r from-[var(--theme-primary)] to-[var(--theme-secondary)] text-white font-medium hover:opacity-90"},{label:"Current Year",icon:a(Y,{className:"w-4 h-4"}),onPress:()=>V("year",new Date().getFullYear()),className:"bg-gradient-to-r from-[var(--theme-primary)] to-[var(--theme-secondary)] text-white font-medium hover:opacity-90"},{label:"Refresh",icon:a(Z,{className:"w-4 h-4"}),onPress:b,className:"bg-gradient-to-r from-[rgba(var(--theme-success-rgb),0.8)] to-[rgba(var(--theme-success-rgb),1)] text-white font-medium hover:opacity-90"}],children:m("div",{className:"p-6",children:[a("div",{className:"mb-6",children:m("div",{className:"flex flex-col sm:flex-row gap-4 items-start sm:items-end",children:[a("div",{className:"w-full sm:w-auto sm:min-w-[200px]",children:a(ze,{label:"Select Year",variant:"bordered",selectedKeys:[String(n.year)],onSelectionChange:e=>{const r=Array.from(e)[0];r&&V("year",Number(r))},startContent:a(Y,{className:"w-4 h-4"}),classNames:{trigger:"bg-white/10 backdrop-blur-md border-white/20 hover:bg-white/15",popoverContent:"bg-white/10 backdrop-blur-lg border-white/20"},size:S?"sm":"md",children:se.map(e=>a(je,{value:e.value,children:e.label},e.key))})}),a("div",{className:"flex gap-2",children:a(Ne,{variant:"flat",color:"primary",size:S?"sm":"md",onPress:b,isLoading:Q,startContent:!Q&&!q&&a(Z,{className:"w-4 h-4"}),children:"Refresh"})})]})}),m("div",{className:"mb-6",children:[m(g,{variant:"h6",className:"mb-4 flex items-center gap-2",children:[a(ae,{className:"w-5 h-5"}),"Leave Balance Summary"]}),ve()]}),m("div",{className:"min-h-96",children:[m(g,{variant:"h6",className:"mb-4 flex items-center gap-2",children:[a(Y,{className:"w-5 h-5"}),"Leave History"]}),q?a(F,{className:"bg-white/10 backdrop-blur-md border-white/20",children:m(B,{className:"text-center py-12",children:[a(Re,{size:40}),a(g,{className:"mt-4",color:"textSecondary",children:"Loading leave data..."})]})}):J?a(F,{className:"bg-white/10 backdrop-blur-md border-white/20",children:m(B,{className:"text-center py-12",children:[a(Ae,{className:"w-16 h-16 mx-auto mb-4 text-red-400"}),a(g,{variant:"h6",className:"mb-2",children:"Error Loading Data"}),a(g,{color:"textSecondary",children:J})]})}):C.length>0?a("div",{className:"overflow-hidden rounded-lg",children:a(De,{ref:be,leaves:C,allUsers:h||[],handleClickOpen:le,setCurrentLeave:ie,openModal:E,setLeaves:p,setCurrentPage:de,currentPage:o.page,totalRows:f,lastPage:j,perPage:o.perPage,selectedMonth:n.selectedMonth,employee:"",isAdminView:!1,fetchLeavesStats:d,updatePaginationMetadata:u,onBulkDelete:ce,canDeleteLeaves:!0})}):a(F,{className:"bg-white/10 backdrop-blur-md border-white/20",children:m(B,{className:"text-center py-12",children:[a(Y,{className:"w-16 h-16 mx-auto mb-4 text-gray-400"}),a(g,{variant:"h6",className:"mb-2",children:"No Leave Records Found"}),m(g,{color:"textSecondary",children:["You haven't submitted any leave requests for ",n.year,"."]}),"                      "]})})]})]})})})})]})]})};$e.layout=z=>a(Fe,{children:z});export{$e as default};
