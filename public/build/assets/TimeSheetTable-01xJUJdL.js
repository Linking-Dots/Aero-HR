import{V as R,a as e,j as s,F as $}from"./app-B-96MSI7.js";import{t as F,r as n,G as i,e as j,g as G,T as d,a as U,B as u,v as O,w as ge,f as xe}from"./vendor-CHZiis0L.js";import{G as Y}from"./App-BawXaExW.js";import{d as z}from"./dayjs.min-CCrDcysA.js";import{d as fe}from"./Search-SmPfgKDK.js";import{s as ye}from"./chunk-4EXC76WE-DSQULJqO.js";import{s as Se}from"./chunk-TLYTI3QM-CrwizQk9.js";import{a as _e}from"./chunk-A6PX3NG3-CO3C8B3S.js";import{i as N}from"./chunk-HJTJQZF3-Xa39JUKo.js";import{t as be,a as ve,b as we,c as Ce,d as Me,e as h}from"./chunk-F3UDT23P-DHuKeak2.js";import{p as Ae}from"./chunk-YHY32LNM-C3UrEQQe.js";import{u as Le}from"./chunk-R6AK6OQ4-QpFZKXco.js";import"./chunk-2BFF5KFD-CYl7CauU.js";import"./chunk-SLABUSGS-pZnQ-Trq.js";import"./chunk-MZRCPRP2-Csj6uIAD.js";import"./chunk-7F3ZLNJ6-ByWLZVvg.js";const Be=({handleDateChange:B,selectedDate:p,updateTimeSheet:P})=>{const{auth:f}=R().props,{url:c}=R(),V=F("(min-width: 1025px)"),W=F("(min-width: 641px) and (max-width: 1024px)"),[Q,q]=n.useState([]),[J,K]=n.useState([]),[g,k]=n.useState([]),[E,D]=n.useState(""),[X,Z]=n.useState(0),[ee,te]=n.useState(0),[H,Te]=n.useState(10),[v,re]=n.useState(1),[w,ne]=n.useState(""),[ae,se]=n.useState(!1),[y,oe]=n.useState({currentMonth:z().format("YYYY-MM")}),[C,M]=n.useState(2),A=n.useRef(null),L=n.useRef(null),ie=async(t,a,r,l,m)=>{var _,T,x,b;const I=c!=="/attendance-employee"?route("getAllUsersAttendanceForDate"):route("getCurrentUserAttendanceForDate");try{const o=await axios.get(I,{params:{page:a,perPage:r,employee:l,date:t,currentYear:m.currentMonth?z(m.currentMonth).year():"",currentMonth:m.currentMonth?z(m.currentMonth).format("MM"):""}});o.status===200&&(console.log(o.data),q(o.data.attendances),K(o.data.leaves),k(o.data.absent_users),Z(o.data.total),te(o.data.last_page),D(""),se(!0))}catch(o){D(((T=(_=o.response)==null?void 0:_.data)==null?void 0:T.message)||"An error occurred while retrieving attendance data."),k(((b=(x=o.response)==null?void 0:x.data)==null?void 0:b.absent_users)||[])}},S=n.useCallback(()=>{if(A.current&&L.current){const t=A.current.clientHeight,a=L.current.clientHeight,r=t-150,l=Math.max(1,Math.floor(r/a));M(l)}},[]);n.useEffect(()=>{M(2);const t=setTimeout(()=>{S()},100);return window.addEventListener("resize",S),()=>{clearTimeout(t),window.removeEventListener("resize",S)}},[g,P,S]),n.useEffect(()=>{ie(p,v,H,w,y)},[p,v,H,w,y,P]);const le=t=>{ne(t.target.value.toLowerCase())},ce=t=>{re(t)},me=n.useCallback((t,a)=>{oe(r=>({...r,[t]:a}))},[]),de=()=>{M(t=>t+2)},ue=t=>J.find(a=>String(a.user_id)===String(t)),he=[{name:"Date",uid:"date"},...f.roles.includes("Administrator")&&c!=="/attendance-employee"?[{name:"Employee",uid:"employee"}]:[],{name:"Clockin Time",uid:"clockin_time"},{name:"Clockout Time",uid:"clockout_time"},{name:"Production Time",uid:"production_time"}],pe=(t,a)=>{var r,l,m;switch(a){case"date":return e(h,{className:"text-xs sm:text-sm md:text-base lg:text-lg",children:new Date(t.date).toLocaleString("en-US",{month:"long",day:"numeric",year:"numeric"})});case"employee":return e(h,{className:"whitespace-nowrap text-xs sm:text-sm md:text-base lg:text-lg",children:e(Le,{avatarProps:{radius:"lg",size:V||W?"md":"sm",src:(r=t.user)==null?void 0:r.profile_image},description:(l=t.user)==null?void 0:l.phone,name:(m=t.user)==null?void 0:m.name})});case"clockin_time":return e(h,{className:"text-xs sm:text-sm md:text-base lg:text-lg",children:t.punchin_time?new Date(`2024-06-04T${t.punchin_time}`).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}):"N/A"});case"clockout_time":return e(h,{className:"text-xs sm:text-sm md:text-base lg:text-lg",children:t.punchout_time?new Date(`2024-06-04T${t.punchout_time}`).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}):"N/A"});case"production_time":if(t.punchin_time&&t.punchout_time){const _=new Date(`2024-06-04T${t.punchin_time}`),x=new Date(`2024-06-04T${t.punchout_time}`)-_,b=Math.floor(x/(1e3*60*60)),o=Math.floor(x%(1e3*60*60)/(1e3*60));return e(h,{className:"text-xs sm:text-sm md:text-base lg:text-lg",children:`${b}h ${o}m`})}return e(h,{className:"text-xs sm:text-sm md:text-base lg:text-lg",children:"N/A"});default:return e(h,{className:"text-xs sm:text-sm md:text-base lg:text-lg",children:"N/A"})}};return e(u,{sx:{display:"flex",justifyContent:"center",p:2},children:s(i,{container:!0,spacing:2,children:[e(i,{item:!0,xs:12,md:c!=="/attendance-employee"?9:12,children:e(j,{in:!0,children:s(Y,{children:[e(G,{title:e(d,{sx:{fontSize:{xs:"1.0rem",sm:"1.4rem",md:"1.8rem"}},children:c==="/attendance-employee"?"Timesheet for the month of "+new Date(y.currentMonth).toLocaleString("en-US",{month:"long",year:"numeric"}):"Timesheet of "+new Date(p).toLocaleString("en-US",{month:"long",day:"numeric",year:"numeric"})}),sx:{padding:"24px"}}),e(U,{children:e(u,{children:s(i,{container:!0,spacing:2,children:[f.roles.includes("Administrator")&&c!=="/attendance-employee"&&s($,{children:[e(i,{item:!0,xs:12,sm:6,md:4,children:e(N,{label:"Search",type:"text",fullWidth:!0,variant:"bordered",placeholder:"Employee...",value:w,onChange:le,endContent:e(fe,{})})}),e(i,{item:!0,xs:12,sm:6,md:4,children:e(N,{label:"Select Date",type:"date",variant:"bordered",onChange:B,value:new Date(p).toISOString().slice(0,10)||""})})]}),f.roles.includes("Employee")&&c==="/attendance-employee"&&e(i,{item:!0,xs:12,sm:6,md:4,children:e(N,{label:"Current Month",type:"month",fullWidth:!0,variant:"bordered",placeholder:"Month...",value:y.currentMonth,onChange:t=>me("currentMonth",t.target.value)})})]})})}),e(U,{children:E?e(d,{color:"error",children:E}):s("div",{style:{maxHeight:"84vh"},children:[e(ye,{orientation:"horizontal",className:"overflow-y-hidden",children:e(Se,{className:"rounded-lg",isLoaded:ae,children:s(be,{isStriped:!0,selectionMode:"multiple",selectionBehavior:"toggle",isCompact:!0,removeWrapper:!0,"aria-label":"Attendance Table",isHeaderSticky:!0,children:[e(ve,{columns:he,children:t=>e(we,{align:"start",children:t.name},t.uid)}),e(Ce,{items:Q,children:t=>e(Me,{children:a=>pe(t,a)},t.id)})]})})}),X>10&&e("div",{className:"py-2 px-2 flex justify-center items-end",style:{height:"100%"},children:e(Ae,{initialPage:1,isCompact:!0,showControls:!0,showShadow:!0,color:"primary",variant:"bordered",page:v,total:ee,onChange:ce})})]})})]})})}),f.roles.includes("Administrator")&&c!=="/attendance-employee"&&g.length>0&&e(i,{item:!0,xs:12,md:3,children:e(j,{in:!0,children:s(Y,{ref:A,children:[e(G,{title:s(u,{sx:{display:"flex",alignItems:"center"},children:[e(d,{sx:{fontSize:{xs:"1.0rem",sm:"1.4rem",md:"1.8rem"}},children:"Absent on "+new Date(p).toLocaleString("en-US",{month:"long",day:"numeric",year:"numeric"})}),e(O,{sx:{ml:1,fontSize:{xs:"0.8rem",sm:"1.1rem",md:"1.4rem"}},label:g.length,variant:"outlined",color:"error",size:"small"})]})}),e(U,{children:s(u,{children:[g.slice(0,C).map((t,a)=>{const r=ue(t.id),l=a===0?L:null;return e(ge,{in:a<C,timeout:"auto",unmountOnExit:!0,children:e(u,{ref:l,sx:{mb:2,p:2,border:"1px solid #e0e0e0",borderRadius:2},children:s(i,{container:!0,alignItems:"center",children:[e(i,{item:!0,xs:12,children:s(u,{sx:{display:"flex",alignItems:"center"},children:[e(_e,{src:t.profile_image,alt:t.name}),e(d,{sx:{m:2,fontSize:{xs:"1.0rem",sm:"1.2rem",md:"1.4rem"}},children:t.name})]})}),r?s($,{children:[s(i,{item:!0,xs:6,children:[e(d,{sx:{fontSize:{xs:"1.0rem",sm:"1.2rem",md:"1.4rem"}},children:r.from_date===r.to_date?r.from_date:`${r.from_date} to ${r.to_date}`}),e(d,{sx:{fontSize:{xs:"0.8rem",sm:"1.0rem",md:"1.2rem"}},color:"textSecondary",children:"On "+r.leave_type+" Leave"})]}),e(i,{item:!0,xs:6,sx:{textAlign:"right"},children:e(O,{label:r.status,variant:"outlined",color:r.status==="Pending"?"error":"success",size:"small"})})]}):e(i,{item:!0,xs:12,children:e(d,{color:"error",sx:{fontSize:{xs:"1.0rem",sm:"1.2rem",md:"1.4rem"}},children:"Absent without Leave"})})]})},t.id)},t.id)}),C<g.length&&e(u,{textAlign:"center",children:e(xe,{variant:"outlined",onClick:de,children:"Load More"})})]})})]})})})]})})};export{Be as default};
